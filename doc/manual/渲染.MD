## [<返回目录](./Manual.md)
---
# 渲染
- 渲染管线
- 摄像机
- 光照
- 网格
- 纹理
- 材质系统
- 着色器
- 渲染排序
- 天空盒
- HDR
- 屏幕后处理
- PBR工作流
- 半透明物体渲染 // TODO
- 阴影 // TODO
- ...
## 渲染管线
- 前向渲染管线 (Forward Rendering)
- 延迟渲染管线 (Deferred Rendering) // TODO

目前使用的是前向渲染管线，暂时未实现对延迟渲染管线的支持<br>
前向渲染管线主要包括两个阶段：Shadow -> Forward
- Shadow 对需要投射阴影的物体进行阴影贴图绘制（由于目前没实现阴影，这个阶段暂时跳过）
- Forward 对场景中的物体按照 不透明（按前->后排序）-> 半透明（按后->前排序）进行光照渲染，前向渲染中每个片元都会与所有的光照进行计算，所以灯光越多就越吃性能
## 摄像机
摄像机是场景中的必备组件，可以通过附加Camera组件到GameObject上来实现摄像机的功能<br>
摄像机的功能是捕获三维的场景并转化为二维显示到屏幕上<br>
摄像机的可视范围由其视锥体（Frustum）决定，视锥体（Frustum）由上、下、左、右、前、后6个平面组成<br>

主要有以下两种摄像机：<br>
- 透视摄像机 -> 有近大远小的透视效果（相当于人眼）
- 正交摄像机 -> 没有近大远小的效果（内容不随距离变远而缩小），一般用于建筑等特殊领域

Camera组件的一些参数：<br>
| 属性字段 | 属性说明 |
| ---------------- | ---- |
| ClearFlags       | 指定摄像机在渲染前需要清除的标志位（如何对空白区域进行填充），包含:<br>SKYBOX：清除所有缓冲区，使用天空盒对空白区域进行填充<br>SOLID_COLOR：清除所有缓冲区，使用背景色对空白区域进行填充<br>DEPTH_ONLY：只清除颜色缓冲区<br>DONT_CLEAR：不清除 |
| Background       | 在ClearFlags选项使用SOLID_COLOR进行清除时指定的填充颜色 |
| CullingLayers    | 指定摄像机在渲染时需要剔除的层级 |
| Projection       | 指定投影方式：<br>Perspective：透视投影<br>Orthographic：正交投影 |
| Fov              | 垂直方向的视角范围，透视投影时生效 |
| Size             | 垂直方向的高度大小，正交投影时生效 |
| NearPlane        | 近平面 |
| FarPlane         | 远平面 |
| Viewport         | 指定渲染到屏幕上时的视口位置和大小 |
| Depth            | 摄像机的渲染顺序，值越小越早渲染 |
| OcclusionCulling | 是否进行视锥剔除 |
| EnabledHDR       | 是否开启HDR |
| EnabledSMAA      | 是否开启抗锯齿 |
| ToneMapping      | 色调映射方式，只有在开启HDR时才生效：<br>LINEAR<br>REINHARD<br>OPTIMIZED_CINEON<br>ACES_FILMIC |
| RenderTarget     | 渲染目标，当指定了渲染目标则会把内容渲染到指定的渲染目标上，一般用于离屏渲染 |
## 光照
- 光源类型
- IBL
- 阴影 // TODO
- 光照贴图 // TODO

光照用于模拟现实生活中光对真实世界的影响
### 光源类型
- 平行光
- 点光源
- 聚光灯
- 环境光
- 区域光 // TODO

目前对各种光源支持的数量：平行光 -> 1， 点光源 -> 8， 聚光灯 -> 8 <br>
可以通过附加Light组件到GameObject上来实现光源的功能<br>

Light组件的一些参数：<br>
| 属性字段 | 属性说明 |
| ---------- | ---- |
| Type       | 光源类型：<br>Parallel：平行光<br>Point：点光源<br>Spot：聚光灯 |
| Color      | 光源颜色 |
| Intensity  | 光源强度 |
| ShadowType | 阴影类型：<br>No：不投射阴影<br>Hard：硬阴影<br>Soft：软阴影 |
| Range      | 光源辐射范围，光源类型为点光源、聚光灯时才生效 |
| SpotAngle  | 光源辐射角度范围，光源类型为聚光灯时才生效 |
#### 平行光
一束不会衰弱且方向固定的光源，Transform组件的Z轴方向为光源的方向，如：太阳光可以看作是平行光（距离足够远）
#### 点光源
点光源会向四面八方所有方向均匀的辐射，并且光照强度会随距离衰减，如：蜡烛、灯泡之类可以看作是点光源
#### 聚光灯
与点光源类似，比点光源多了个SpotAngle属性（多了辐射角度限制），如：手电筒可以看作是聚光灯
#### 环境光
在生活中，错综复杂的光线与凹凸不平的物体表面相互反射，使得整个环境都被照亮，仿佛被一层光均匀笼罩，这个光一般称为环境光，也称为漫射环境光。<br>

因为环境光可以均匀地照亮场景中的所有物体，常用于解决模型背光面全黑的问题，一般需要配合其他类型的光源一起使用。例如场景中只有一个平行光，那么在模型的背光源处会显得非常暗，加入环境光则可以提升模型背部的亮度，显得更加美观。

环境光由场景（Scene）提供，可以通过Scene.env.envLight进行设置<br>
### IBL
[基于图像的照明技术（Image Based Lighting）](https://chetanjags.wordpress.com/2015/08/26/image-based-lighting/)是全局光照的一部分<br>
环境光除了可以用一种固有色外，也能使用IBL技术提供更加逼真的环境照明效果<br>
## 网格

## 纹理
## 材质系统
## 着色器
## 渲染排序
## 天空盒
## HDR
## 屏幕后处理
## PBR工作流