/*! For license information please see Apex.min.js.LICENSE.txt */
var Apex;(()=>{var e={"./src/config/Config.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{static get aspect(){return this.width/this.height}static set(e){e&&(e.width&&(this.width=e.width),e.height&&(this.height=e.height),e.antiAliasing&&(this.antiAliasing=e.antiAliasing),e.isFPS&&(this.isFPS=e.isFPS))}}},"./src/core/Apex.ts":function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r("./src/core/asset/Asset.ts"),t),a(r("./src/core/asset/material/BRDFLUTMaterial.ts"),t),a(r("./src/core/asset/material/BlinnPhongMaterial.ts"),t),a(r("./src/core/asset/material/IrradianceMaterial.ts"),t),a(r("./src/core/asset/material/MapToCubeMaterial.ts"),t),a(r("./src/core/asset/material/Material.ts"),t),a(r("./src/core/asset/material/PBRMaterial.ts"),t),a(r("./src/core/asset/material/PrefilteringMaterial.ts"),t),a(r("./src/core/asset/material/SkyBoxMaterial.ts"),t),a(r("./src/core/asset/material/SkySphereMaterial.ts"),t),a(r("./src/core/asset/material/UnlitMaterial.ts"),t),a(r("./src/core/asset/material/postprocessing/BloomPass.ts"),t),a(r("./src/core/asset/material/postprocessing/BlurPass.ts"),t),a(r("./src/core/asset/material/postprocessing/EffectPass.ts"),t),a(r("./src/core/asset/material/postprocessing/NormalPass.ts"),t),a(r("./src/core/asset/material/postprocessing/Postprocessor.ts"),t),a(r("./src/core/asset/primitive/Mesh.ts"),t),a(r("./src/core/asset/primitive/SubMesh.ts"),t),a(r("./src/core/asset/shader/BlockUniform.ts"),t),a(r("./src/core/asset/shader/Define.ts"),t),a(r("./src/core/asset/shader/DefineGroup.ts"),t),a(r("./src/core/asset/shader/Shader.ts"),t),a(r("./src/core/asset/shader/ShaderData.ts"),t),a(r("./src/core/asset/shader/ShaderEctype.ts"),t),a(r("./src/core/asset/shader/ShaderPass.ts"),t),a(r("./src/core/asset/shader/Uniform.ts"),t),a(r("./src/core/asset/shader/UniformBlock.ts"),t),a(r("./src/core/asset/shader/UniformBlockGroup.ts"),t),a(r("./src/core/asset/shader/UniformGroup.ts"),t),a(r("./src/core/asset/shader/blockuniform/BlockGroup.ts"),t),a(r("./src/core/asset/shader/blockuniform/BlockItem.ts"),t),a(r("./src/core/asset/shader/blockuniform/BlockStruct.ts"),t),a(r("./src/core/asset/shader/blockuniform/ParallelLightStruct.ts"),t),a(r("./src/core/asset/shader/blockuniform/PointLightStruct.ts"),t),a(r("./src/core/asset/shader/blockuniform/SpotLightStruct.ts"),t),a(r("./src/core/asset/texture/BaseRenderTarget.ts"),t),a(r("./src/core/asset/texture/BaseTexture.ts"),t),a(r("./src/core/asset/texture/BitMap.ts"),t),a(r("./src/core/asset/texture/CubeRenderTarget.ts"),t),a(r("./src/core/asset/texture/CubeTexture.ts"),t),a(r("./src/core/asset/texture/RenderTarget.ts"),t),a(r("./src/core/asset/texture/RenderTexture.ts"),t),a(r("./src/core/asset/texture/Texture.ts"),t),a(r("./src/core/asset/texture/Texture3D.ts"),t),a(r("./src/core/common/BitOp.ts"),t),a(r("./src/core/common/Const.ts"),t),a(r("./src/core/common/Handler.ts"),t),a(r("./src/core/common/Timer.ts"),t),a(r("./src/core/common/container/TBuffer.ts"),t),a(r("./src/core/common/container/VertexBuffer.ts"),t),a(r("./src/core/component/BaseCamera.ts"),t),a(r("./src/core/component/Behaviour.ts"),t),a(r("./src/core/component/Camera.ts"),t),a(r("./src/core/component/Component.ts"),t),a(r("./src/core/component/CubeCamera.ts"),t),a(r("./src/core/component/Light.ts"),t),a(r("./src/core/component/LineRenderer.ts"),t),a(r("./src/core/component/MeshFilter.ts"),t),a(r("./src/core/component/MeshRenderer.ts"),t),a(r("./src/core/component/RigidBody.ts"),t),a(r("./src/core/component/SkinnedMeshRenderer.ts"),t),a(r("./src/core/component/Transform.ts"),t),a(r("./src/core/component/Wander.ts"),t),a(r("./src/core/debug/Stats.ts"),t),a(r("./src/core/event/Event.ts"),t),a(r("./src/core/event/EventDispatcher.ts"),t),a(r("./src/core/gameobject/EnvSetting.ts"),t),a(r("./src/core/gameobject/GameObject.ts"),t),a(r("./src/core/gameobject/Scene.ts"),t),a(r("./src/core/gameobject/setting/EnvLight.ts"),t),a(r("./src/core/gameobject/setting/EnvReflection.ts"),t),a(r("./src/core/gameobject/setting/Fog.ts"),t),a(r("./src/core/gameobject/setting/GI.ts"),t),a(r("./src/core/gameobject/setting/SkyBox.ts"),t),a(r("./src/core/manager/Managers.ts"),t),a(r("./src/core/manager/loader/BitMapLoader.ts"),t),a(r("./src/core/manager/loader/CubeTextureLoader.ts"),t),a(r("./src/core/manager/loader/FileLoader.ts"),t),a(r("./src/core/manager/loader/GLTFLoader.ts"),t),a(r("./src/core/manager/loader/Loader.ts"),t),a(r("./src/core/manager/loader/TextureLoader.ts"),t),a(r("./src/core/manager/loader/parser/GLBParser.ts"),t),a(r("./src/core/manager/loader/parser/RGBEParser.ts"),t),a(r("./src/core/manager/pool/Pool.ts"),t),a(r("./src/core/math/Color.ts"),t),a(r("./src/core/math/Euler.ts"),t),a(r("./src/core/math/Matrix3.ts"),t),a(r("./src/core/math/Matrix4.ts"),t),a(r("./src/core/math/Quaternion.ts"),t),a(r("./src/core/math/Rect.ts"),t),a(r("./src/core/math/Vector2.ts"),t),a(r("./src/core/math/Vector3.ts"),t),a(r("./src/core/math/Vector4.ts"),t),a(r("./src/core/util/Utils.ts"),t),a(r("./src/core/Engine.ts"),t)},"./src/core/Engine.ts":function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;const a=s(r("./src/config/Config.ts")),n=r("./src/core/Apex.ts"),i=r("./src/core/manager/SceneManager.ts"),o=r("./src/core/manager/TimerManager.ts"),l=r("./src/core/system/InputSystem.ts"),u=r("./src/core/system/PerformanceSystem.ts"),_=r("./src/core/system/PhysicsSystem.ts"),h=r("./src/core/system/RendererSystem.ts"),c=r("./src/core/system/ScriptSystem.ts");t.Engine=class{constructor(e){a.default.set(e),n.Managers.init(),o.TimerManager.ins().registerTimer(0,1,this,this._logicalUpdate,[],!0,!1),o.TimerManager.ins().registerTimer(0,1,this,this._renderUpdate,[],!0,!1),this._inputSystem=new l.InputSystem,this._scriptSystem=new c.ScriptSystem,this._physicsSystem=new _.PhysicsSystem,this._rendererSystem=new h.RendererSystem,this._performanceSystem=new u.PerformanceSystem,this._inputSystem.start(),this._scriptSystem.start(),this._physicsSystem.start(),this._rendererSystem.start(),this._performanceSystem.start(),o.TimerManager.ins().start()}get output(){return this._rendererSystem.canvas}stop(){this._inputSystem.stop(),this._scriptSystem.stop(),this._physicsSystem.stop(),this._rendererSystem.stop(),this._performanceSystem.stop()}continue(){this._inputSystem.continue(),this._scriptSystem.continue(),this._physicsSystem.continue(),this._rendererSystem.continue(),this._performanceSystem.continue()}destroy(){this._inputSystem.destroy(),this._scriptSystem.destroy(),this._physicsSystem.destroy(),this._rendererSystem.destroy(),this._performanceSystem.destroy()}_logicalUpdate(e){this._inputSystem.update(e),this._scriptSystem.scriptEnable(),this._scriptSystem.scriptStart(),this._scriptSystem.fixedUpdate(e),this._scriptSystem.update(e),this._scriptSystem.lateUpdate(e),this._physicsSystem.update(e),this._performanceSystem.update(e)}_renderUpdate(e){i.SceneManager.ins().updateScene(),this._scriptSystem.renderBefore(e),this._rendererSystem.renderUpdate(e),this._scriptSystem.renderAfter(e)}launchScene(e){i.SceneManager.ins().launchScene(e)}}},"./src/core/asset/Asset.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Asset=void 0;const s=r("./src/core/util/Utils.ts");t.Asset=class{constructor(){this._uuid=s.Utils.String.generateUUID(),this._referenceList=new Set,this._beReferenceList=new Set}get uuid(){return this._uuid}_addRef(e){this._referenceList.add(e)}_decRef(e){this._referenceList.delete(e)}_addBeRef(e){this._beReferenceList.add(e)}_decBeRef(e){this._beReferenceList.delete(e)}}},"./src/core/asset/material/BRDFLUTMaterial.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BRDFLUTMaterial=void 0;const s=r("./src/core/manager/ShaderManager.ts"),a=r("./src/core/asset/material/Material.ts");class n extends a.Material{_initShader(){this._shader=s.ShaderManager.ins().findShader("BRDFLUTShader")}}t.BRDFLUTMaterial=n},"./src/core/asset/material/BlinnPhongMaterial.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlinnPhongMaterial=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/math/Color.ts"),i=r("./src/core/math/Vector4.ts"),o=r("./src/core/asset/shader/Uniform.ts"),l=r("./src/core/asset/material/Material.ts");class u extends l.Material{get mainColor(){return this._shaderData.getColor(u._mainColor).data}set mainColor(e){let t=this._shaderData.getColor(u._mainColor).data;t!==e&&t.copyFrom(e)}get diffuse(){return this._shaderData.getTexture(u._diffuse).data||null}set diffuse(e){this._shaderData.getTexture(u._diffuse).data=e,e?this._shaderData.addDefine(u._useDiffuseTextureDefine):this._shaderData.removeDefine(u._useDiffuseTextureDefine.id)}get specular(){return this._shaderData.getTexture(u._specular).data||null}set specular(e){this._shaderData.getTexture(u._specular).data=e,e?this._shaderData.addDefine(u._useSpecularTextureDefine):this._shaderData.removeDefine(u._useSpecularTextureDefine.id)}get shininess(){return this._shaderData.getFloat(u._shininess).data}set shininess(e){this._shaderData.getFloat(u._shininess).data=e}get tilingOffset(){return this._shaderData.getFloat4(u._tilingOffset).data}set tilingOffset(e){let t=this._shaderData.getFloat4(u._tilingOffset).data;t!==e&&t.copyFrom(e)}_initShader(){this._shader=a.ShaderManager.ins().findShader("BlinnPhongShader")}_initDefine(){}_initUniform(){this._shaderData.addUniform(new o.Uniform(s.Const.GL_TYPE.COLOR,u._mainColor,new n.Color(1,1,1,1))),this._shaderData.addUniform(new o.Uniform(s.Const.GL_TYPE.TEXTURE,u._diffuse)),this._shaderData.addUniform(new o.Uniform(s.Const.GL_TYPE.TEXTURE,u._specular)),this._shaderData.addUniform(new o.Uniform(s.Const.GL_TYPE.FLOAT4,u._tilingOffset,new i.Vector4(1,1,0,0))),this._shaderData.addUniform(new o.Uniform(s.Const.GL_TYPE.FLOAT,u._shininess,32))}}t.BlinnPhongMaterial=u,u._useDiffuseTextureDefine=a.ShaderManager.ins().registerDefine("USE_DIFFUSE_TEXTURE"),u._useSpecularTextureDefine=a.ShaderManager.ins().registerDefine("USE_SPECULAR_TEXTURE"),u._mainColor=a.ShaderManager.ins().registerUniform("u_MainColor"),u._diffuse=a.ShaderManager.ins().registerUniform("u_DiffuseTexture"),u._specular=a.ShaderManager.ins().registerUniform("u_SpecularTexture"),u._shininess=a.ShaderManager.ins().registerUniform("u_Shininess"),u._tilingOffset=a.ShaderManager.ins().registerUniform("u_TilingOffset")},"./src/core/asset/material/IrradianceMaterial.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IrradianceMaterial=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/asset/shader/Uniform.ts"),i=r("./src/core/asset/material/Material.ts");class o extends i.Material{get mainTexture(){return this._shaderData.getCubeTexture(o._mainTexture).data}set mainTexture(e){this._shaderData.getCubeTexture(o._mainTexture).data=e,e?this._shaderData.addDefine(o._useMainTextureDefine):this._shaderData.removeDefine(o._useMainTextureDefine.id)}_initShader(){this._shader=a.ShaderManager.ins().findShader("IrradianceShader")}_initDefine(){}_initUniform(){this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.CUBE_TEXTURE,o._mainTexture))}}t.IrradianceMaterial=o,o._useMainTextureDefine=a.ShaderManager.ins().registerDefine("ENV_TEXTURE"),o._mainTexture=a.ShaderManager.ins().registerUniform("u_EnvTexture")},"./src/core/asset/material/MapToCubeMaterial.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapToCubeMaterial=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/asset/shader/Uniform.ts"),i=r("./src/core/asset/texture/CubeRenderTarget.ts"),o=r("./src/core/asset/texture/CubeTexture.ts"),l=r("./src/core/asset/material/Material.ts");class u extends l.Material{constructor(e){super(),(null==e?void 0:e.mainTexture)&&(this.mainTexture=e.mainTexture)}get mainTexture(){return this._mainTexture||null}set mainTexture(e){if(this._mainTexture=e,e){let t;e instanceof o.CubeTexture||e instanceof i.CubeRenderTarget?(t=this._shaderData.getCubeTexture(u._cubeMap),this._shaderData.addDefine(u._useCubeMap),this._shaderData.removeDefine(u._useEqRectMap.id)):(t=this._shaderData.getTexture(u._eqRectMap),this._shaderData.addDefine(u._useEqRectMap),this._shaderData.removeDefine(u._useCubeMap.id)),t.data=e}else this._shaderData.removeDefine(u._useEqRectMap.id),this._shaderData.removeDefine(u._useCubeMap.id)}_initShader(){this._shader=a.ShaderManager.ins().findShader("MapToCubeShader")}_initUniform(){this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.TEXTURE,u._eqRectMap,null)),this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.CUBE_TEXTURE,u._cubeMap,null))}}t.MapToCubeMaterial=u,u._useEqRectMap=a.ShaderManager.ins().registerDefine("USE_EQ_RECT_MAP"),u._useCubeMap=a.ShaderManager.ins().registerDefine("USE_CUBE_MAP"),u._eqRectMap=a.ShaderManager.ins().registerUniform("u_EquirectangularMap"),u._cubeMap=a.ShaderManager.ins().registerUniform("u_CubeMap")},"./src/core/asset/material/Material.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Material=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/asset/shader/ShaderData.ts");t.Material=class{constructor(){this._initShader(),this._initProperty(),this._initDefine(),this._initUniform(),this._initRenderMode()}get shader(){return this._shader}get shaderData(){return this._shaderData}get cullFace(){return this._cullFace}set cullFace(e){this._cullFace=e}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this._setBlendMode(e)}get blendSrc(){return this._blendSrc}set blendSrc(e){this._blendSrc=e}get blendDst(){return this._blendDst}set blendDst(e){this._blendDst=e}get blendEquation(){return this._blendEquation}set blendEquation(e){this._blendEquation=e}get blendSrcAlpha(){return this._blendSrcAlpha}set blendSrcAlpha(e){this._blendSrcAlpha=e}get blendDstAlpha(){return this._blendDstAlpha}set blendDstAlpha(e){this._blendDstAlpha=e}get blendEquationAlpha(){return this._blendEquationAlpha}set blendEquationAlpha(e){this._blendEquationAlpha=e}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest=e}get depthTest(){return this._depthTest}set depthTest(e){this._depthTest=e}get depthWrite(){return this._depthWrite}set depthWrite(e){this._depthWrite=e}get stencilTest(){return this._stencilTest}set stencilTest(e){this._stencilTest=e}get stencilPass(){return this._stencilPass}set stencilPass(e){this._stencilPass=e}get stencilFail(){return this._stencilFail}set stencilFail(e){this._stencilFail=e}get stencilZFail(){return this._stencilZFail}set stencilZFail(e){this._stencilZFail=e}get stencilWrite(){return this._stencilWrite}set stencilWrite(e){this._stencilWrite=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this._polygonOffset=e}get polygonOffsetFactor(){return this._polygonOffsetFactor}set polygonOffsetFactor(e){this._polygonOffsetFactor=e}get polygonOffsetUnits(){return this._polygonOffsetUnits}set polygonOffsetUnits(e){this._polygonOffsetUnits=e}get renderQueue(){return this._renderQueue}set renderQueue(e){this._renderQueue=e}set renderMode(e){this._setRenderMode(e)}_initShader(){}_initProperty(){this._shaderData=new a.ShaderData}_initDefine(){}_initUniform(){}_initRenderMode(){this.renderMode=s.Const.GL_RENDER_MODE.OPAQUE}_setRenderMode(e){switch(e){case s.Const.GL_RENDER_MODE.OPAQUE:this._cullFace=s.Const.GL_CULL_FACE.BACK,this._alphaTest=!1,this._depthTest=s.Const.GL_DEPTH.TEST_LESS,this._depthWrite=!0,this._renderQueue=s.Const.GL_RENDER_QUEUE.OPAQUE,this.blendMode=s.Const.GL_BLENDING.NONE;break;case s.Const.GL_RENDER_MODE.CUTOUT:this._cullFace=s.Const.GL_CULL_FACE.BACK,this._alphaTest=!1,this._depthTest=s.Const.GL_DEPTH.TEST_LESS,this._depthWrite=!0,this._renderQueue=s.Const.GL_RENDER_QUEUE.ALPHA_TEST,this.blendMode=s.Const.GL_BLENDING.NONE;break;case s.Const.GL_RENDER_MODE.FADE:break;case s.Const.GL_RENDER_MODE.TRANSPARENT:this._cullFace=s.Const.GL_CULL_FACE.BACK,this._alphaTest=!1,this._depthTest=s.Const.GL_DEPTH.TEST_LESS,this._depthWrite=!1,this._renderQueue=s.Const.GL_RENDER_QUEUE.TRANSPARENT,this.blendMode=s.Const.GL_BLENDING.NORMAL}}_setBlendMode(e){switch(e){case s.Const.GL_BLENDING.NONE:this._blendSrc=s.Const.GL_BLENDING.ONE_FACTOR,this._blendDst=s.Const.GL_BLENDING.ZERO_FACTOR,this._blendEquation=s.Const.GL_BLENDING.ADD_EQUATION;break;case s.Const.GL_BLENDING.NORMAL:this._blendSrc=s.Const.GL_BLENDING.SRC_ALPHA_FACTOR,this._blendDst=s.Const.GL_BLENDING.ONE_MINUS_SRC_ALPHA_FACTOR,this._blendEquation=s.Const.GL_BLENDING.ADD_EQUATION;break;case s.Const.GL_BLENDING.ADDITIVE:this._blendSrc=s.Const.GL_BLENDING.ONE_MINUS_DST_COLOR_FACTOR,this._blendDst=s.Const.GL_BLENDING.ONE_FACTOR,this._blendEquation=s.Const.GL_BLENDING.ADD_EQUATION;break;case s.Const.GL_BLENDING.SUBTRACTIVE:break;case s.Const.GL_BLENDING.MULTIPLY:this._blendSrc=s.Const.GL_BLENDING.DST_COLOR_FACTOR,this._blendDst=s.Const.GL_BLENDING.ZERO_FACTOR,this._blendEquation=s.Const.GL_BLENDING.ADD_EQUATION}}}},"./src/core/asset/material/PBRMaterial.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PBRMaterial=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/math/Color.ts"),i=r("./src/core/asset/shader/Uniform.ts"),o=r("./src/core/asset/material/Material.ts");class l extends o.Material{constructor(e){super(),e&&(e.albedoTexture&&(this.albedoTexture=e.albedoTexture),e.normalTexture&&(this.normalTexture=e.normalTexture),e.metallicTexture&&(this.metallicTexture=e.metallicTexture),e.roughnessTexture&&(this.roughnessTexture=e.roughnessTexture),e.aoTexture&&(this.aoTexture=e.aoTexture),e.emissiveTexture&&(this.emissiveTexture=e.emissiveTexture),e.albedo&&(this.albedo=e.albedo),e.metallic&&(this.metallic=e.metallic),e.roughness&&(this.roughness=e.roughness),e.ao&&(this.ao=e.ao),e.emissive&&(this.emissive=e.emissive),e.emissiveIntensity&&(this.emissiveIntensity=e.emissiveIntensity))}get albedoTexture(){return this._shaderData.getTexture(l._albedoTexture).data||null}set albedoTexture(e){this._shaderData.getTexture(l._albedoTexture).data=e,e?this._shaderData.addDefine(l._albedoTextureDefine):this._shaderData.removeDefine(l._albedoTextureDefine.id)}get normalTexture(){return this._shaderData.getTexture(l._normalTexture).data||null}set normalTexture(e){this._shaderData.getTexture(l._normalTexture).data=e,e?this._shaderData.addDefine(l._normalTextureDefine):this._shaderData.removeDefine(l._normalTextureDefine.id)}get metallicTexture(){return this._shaderData.getTexture(l._metallicTexture).data||null}set metallicTexture(e){this._shaderData.getTexture(l._metallicTexture).data=e,e?this._shaderData.addDefine(l._metallicTextureDefine):this._shaderData.removeDefine(l._metallicTextureDefine.id)}get roughnessTexture(){return this._shaderData.getTexture(l._roughnessTexture).data||null}set roughnessTexture(e){this._shaderData.getTexture(l._roughnessTexture).data=e,e?this._shaderData.addDefine(l._roughnessTextureDefine):this._shaderData.removeDefine(l._roughnessTextureDefine.id)}get aoTexture(){return this._shaderData.getTexture(l._aoTexture).data||null}set aoTexture(e){this._shaderData.getTexture(l._aoTexture).data=e,e?this._shaderData.addDefine(l._aoTextureDefine):this._shaderData.removeDefine(l._aoTextureDefine.id)}get emissiveTexture(){return this._shaderData.getTexture(l._emissiveTexture).data||null}set emissiveTexture(e){this._shaderData.getTexture(l._emissiveTexture).data=e,e?this._shaderData.addDefine(l._emissiveTextureDefine):this._shaderData.removeDefine(l._emissiveTextureDefine.id)}get albedo(){return this._shaderData.getColor(l._albedo).data}set albedo(e){let t=this._shaderData.getColor(l._albedo).data;t!==e&&t.copyFrom(e)}get metallic(){return this._shaderData.getFloat(l._metallic).data}set metallic(e){this._shaderData.getFloat(l._metallic).data=e}get roughness(){return this._shaderData.getFloat(l._roughness).data}set roughness(e){this._shaderData.getFloat(l._roughness).data=e}get ao(){return this._shaderData.getFloat(l._ao).data}set ao(e){this._shaderData.getFloat(l._ao).data=e}get emissive(){return this._shaderData.getColor(l._emissive).data}set emissive(e){let t=this._shaderData.getColor(l._emissive).data;t!==e&&t.copyFrom(e)}get emissiveIntensity(){return this._shaderData.getFloat(l._emissiveIntensity).data}set emissiveIntensity(e){this._shaderData.getFloat(l._emissiveIntensity).data=e}_initShader(){this._shader=a.ShaderManager.ins().findShader("PBRShader")}_initDefine(){}_initUniform(){this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.TEXTURE,l._albedoTexture)),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.TEXTURE,l._normalTexture)),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.TEXTURE,l._metallicTexture)),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.TEXTURE,l._roughnessTexture)),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.TEXTURE,l._aoTexture)),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.TEXTURE,l._emissiveTexture)),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.COLOR,l._albedo,new n.Color(1,1,1))),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.FLOAT,l._metallic,0)),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.FLOAT,l._roughness,.5)),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.FLOAT,l._ao,1)),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.COLOR,l._emissive,new n.Color(0,0,0))),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.FLOAT,l._emissiveIntensity,1))}}t.PBRMaterial=l,l._albedoTextureDefine=a.ShaderManager.ins().registerDefine("ALBEDO_TEXTURE"),l._normalTextureDefine=a.ShaderManager.ins().registerDefine("NORMAL_TEXTURE"),l._metallicTextureDefine=a.ShaderManager.ins().registerDefine("METALLIC_TEXTURE"),l._roughnessTextureDefine=a.ShaderManager.ins().registerDefine("ROUGHNESS_TEXTURE"),l._aoTextureDefine=a.ShaderManager.ins().registerDefine("AO_TEXTURE"),l._emissiveTextureDefine=a.ShaderManager.ins().registerDefine("EMISSIVE_TEXTURE"),l._albedoTexture=a.ShaderManager.ins().registerUniform("u_AlbedoTexture"),l._normalTexture=a.ShaderManager.ins().registerUniform("u_NormalTexture"),l._metallicTexture=a.ShaderManager.ins().registerUniform("u_MetallicTexture"),l._roughnessTexture=a.ShaderManager.ins().registerUniform("u_RoughnessTexture"),l._aoTexture=a.ShaderManager.ins().registerUniform("u_AoTexture"),l._emissiveTexture=a.ShaderManager.ins().registerUniform("u_EmissiveTexture"),l._albedo=a.ShaderManager.ins().registerUniform("u_Albedo"),l._metallic=a.ShaderManager.ins().registerUniform("u_Metallic"),l._roughness=a.ShaderManager.ins().registerUniform("u_Roughness"),l._ao=a.ShaderManager.ins().registerUniform("u_Ao"),l._emissive=a.ShaderManager.ins().registerUniform("u_Emissive"),l._emissiveIntensity=a.ShaderManager.ins().registerUniform("u_EmissiveIntensity")},"./src/core/asset/material/PrefilteringMaterial.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PrefilteringMaterial=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/asset/shader/Uniform.ts"),i=r("./src/core/asset/material/Material.ts");class o extends i.Material{get mainTexture(){return this._shaderData.getCubeTexture(o._mainTexture).data}set mainTexture(e){this._shaderData.getCubeTexture(o._mainTexture).data=e,e?this._shaderData.addDefine(o._useMainTextureDefine):this._shaderData.removeDefine(o._useMainTextureDefine.id)}get roughness(){return this._shaderData.getFloat(o._roughness).data}set roughness(e){this._shaderData.getFloat(o._roughness).data=e}_initShader(){this._shader=a.ShaderManager.ins().findShader("PrefilteringShader")}_initDefine(){}_initUniform(){this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.CUBE_TEXTURE,o._mainTexture)),this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.FLOAT,o._roughness,0))}}t.PrefilteringMaterial=o,o._useMainTextureDefine=a.ShaderManager.ins().registerDefine("ENV_TEXTURE"),o._mainTexture=a.ShaderManager.ins().registerUniform("u_EnvTexture"),o._roughness=a.ShaderManager.ins().registerUniform("u_Roughness")},"./src/core/asset/material/SkyBoxMaterial.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyBoxMaterial=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/asset/shader/Uniform.ts"),i=r("./src/core/asset/texture/CubeRenderTarget.ts"),o=r("./src/core/asset/texture/CubeTexture.ts"),l=r("./src/core/asset/material/Material.ts");class u extends l.Material{constructor(e){super(),e&&e.mainTexture&&(this.mainTexture=e.mainTexture)}get mainTexture(){return this._mainTexture||null}set mainTexture(e){if(this._mainTexture=e,e){let t;e instanceof o.CubeTexture||e instanceof i.CubeRenderTarget?(t=this._shaderData.getCubeTexture(u._cubeMap),this._shaderData.addDefine(u._useCubeMap),this._shaderData.removeDefine(u._useEqRectMap.id)):(t=this._shaderData.getTexture(u._eqRectMap),this._shaderData.addDefine(u._useEqRectMap),this._shaderData.removeDefine(u._useCubeMap.id)),t.data=e}else this._shaderData.removeDefine(u._useEqRectMap.id),this._shaderData.removeDefine(u._useCubeMap.id)}get exposure(){return this._shaderData.getFloat(u._exposureID).data}set exposure(e){this._shaderData.getFloat(u._exposureID).data=e}_initShader(){this._shader=a.ShaderManager.ins().findShader("SkyBoxShader")}_initUniform(){this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.TEXTURE,u._eqRectMap,null)),this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.CUBE_TEXTURE,u._cubeMap,null)),this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.FLOAT,u._exposureID,1))}_initRenderMode(){super._initRenderMode(),this._cullFace=s.Const.GL_CULL_FACE.FRONT,this._depthTest=s.Const.GL_DEPTH.TEST_LEQUAL}}t.SkyBoxMaterial=u,u._useEqRectMap=a.ShaderManager.ins().registerDefine("USE_EQ_RECT_MAP"),u._useCubeMap=a.ShaderManager.ins().registerDefine("USE_CUBE_MAP"),u._eqRectMap=a.ShaderManager.ins().registerUniform("u_EquirectangularMap"),u._cubeMap=a.ShaderManager.ins().registerUniform("u_CubeMap"),u._exposureID=a.ShaderManager.ins().registerUniform("u_Exposure")},"./src/core/asset/material/SkySphereMaterial.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkySphereMaterial=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/math/Color.ts"),i=r("./src/core/math/Vector4.ts"),o=r("./src/core/util/Utils.ts"),l=r("./src/core/asset/shader/Uniform.ts"),u=r("./src/core/asset/material/Material.ts");class _ extends u.Material{get sumYaw(){return this._shaderData.getFloat4(_._sumYPR).data.x}set sumYaw(e){this._shaderData.getFloat4(_._sumYPR).data.x=e}get sumPitch(){return this._shaderData.getFloat4(_._sumYPR).data.y}set sumPitch(e){this._shaderData.getFloat4(_._sumYPR).data.y=e}get sumRadius(){return this._shaderData.getFloat4(_._sumYPR).data.z}set sumRadius(e){this._shaderData.getFloat4(_._sumYPR).data.z=e}get sumYPR(){return this._shaderData.getFloat4(_._sumYPR).data}get sumColor(){return this._shaderData.getColor(_._sumColor).data}get sumHalo(){return this._shaderData.getColor(_._sumHaloAndThickness).data}get sumHaloThickness(){return this._shaderData.getFloat4(_._sumHaloAndThickness).data.w}set sumHaloThickness(e){this._shaderData.getFloat4(_._sumHaloAndThickness).data.w=e}get skyColor(){return this._shaderData.getColor(_._skyColor).data}get groundColor(){return this._shaderData.getColor(_._groundColor).data}get skylineColor(){return this._shaderData.getColor(_._skylineColorAndThickness).data}get skylineThickness(){return this._shaderData.getFloat4(_._skylineColorAndThickness).data.w}set skylineThickness(e){this._shaderData.getFloat4(_._skylineColorAndThickness).data.w=e}get exposure(){return this._shaderData.getFloat(_._exposureID).data}set exposure(e){this._shaderData.getFloat(_._exposureID).data=e}_initShader(){this._shader=a.ShaderManager.ins().findShader("SkySphereShader")}_initUniform(){this._shaderData.addUniform(new l.Uniform(s.Const.GL_TYPE.FLOAT4,_._sumYPR,new i.Vector4(-60*o.Utils.Math.DEG2RAD,20*o.Utils.Math.DEG2RAD,.04,1))),this._shaderData.addUniform(new l.Uniform(s.Const.GL_TYPE.COLOR,_._sumColor,new n.Color(1,1,1,1))),this._shaderData.addUniform(new l.Uniform(s.Const.GL_TYPE.COLOR,_._sumHaloAndThickness,new n.Color(1,1,1,.2))),this._shaderData.addUniform(new l.Uniform(s.Const.GL_TYPE.COLOR,_._skyColor,new n.Color(.2,.32,.64,1))),this._shaderData.addUniform(new l.Uniform(s.Const.GL_TYPE.COLOR,_._groundColor,new n.Color(.3,.3,.3,1))),this._shaderData.addUniform(new l.Uniform(s.Const.GL_TYPE.COLOR,_._skylineColorAndThickness,new n.Color(1,1,1,1))),this._shaderData.addUniform(new l.Uniform(s.Const.GL_TYPE.FLOAT,_._exposureID,1))}_initRenderMode(){super._initRenderMode(),this._cullFace=s.Const.GL_CULL_FACE.FRONT,this._depthTest=s.Const.GL_DEPTH.TEST_LEQUAL}}t.SkySphereMaterial=_,_._sumYPR=a.ShaderManager.ins().registerUniform("u_SumYawPitchRadius"),_._sumColor=a.ShaderManager.ins().registerUniform("u_SumColor"),_._sumHaloAndThickness=a.ShaderManager.ins().registerUniform("u_SumHaloAndThickness"),_._skyColor=a.ShaderManager.ins().registerUniform("u_SkyColor"),_._groundColor=a.ShaderManager.ins().registerUniform("u_GroundColor"),_._skylineColorAndThickness=a.ShaderManager.ins().registerUniform("u_SkylineColorAndThickness"),_._exposureID=a.ShaderManager.ins().registerUniform("u_Exposure")},"./src/core/asset/material/UnlitMaterial.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnlitMaterial=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/math/Color.ts"),i=r("./src/core/math/Vector4.ts"),o=r("./src/core/asset/shader/Uniform.ts"),l=r("./src/core/asset/material/Material.ts");class u extends l.Material{constructor(e){super(),e&&(e.mainColor&&(this.mainColor=e.mainColor),e.mainTexture&&(this.mainTexture=e.mainTexture),e.tilingOffset&&(this.tilingOffset=e.tilingOffset))}get mainColor(){return this._shaderData.getColor(u._mainColor).data}set mainColor(e){let t=this._shaderData.getColor(u._mainColor).data;t!==e&&t.copyFrom(e)}get mainTexture(){return this._shaderData.getTexture(u._mainTexture).data}set mainTexture(e){this._shaderData.getTexture(u._mainTexture).data=e,e?this._shaderData.addDefine(u._useMainTextureDefine):this._shaderData.removeDefine(u._useMainTextureDefine.id)}get tilingOffset(){return this._shaderData.getFloat4(u._tilingOffset).data}set tilingOffset(e){let t=this._shaderData.getFloat4(u._tilingOffset).data;t!==e&&t.copyFrom(e)}get enableVertexColor(){return!!this._shaderData.getDefine(u._useVertexColorDefine.id)}set enableVertexColor(e){e?this._shaderData.addDefine(u._useVertexColorDefine):this._shaderData.removeDefine(u._useVertexColorDefine.id)}_initShader(){this._shader=a.ShaderManager.ins().findShader("UnlitShader")}_initDefine(){}_initUniform(){this._shaderData.addUniform(new o.Uniform(s.Const.GL_TYPE.COLOR,u._mainColor,new n.Color(1,1,1,1))),this._shaderData.addUniform(new o.Uniform(s.Const.GL_TYPE.TEXTURE,u._mainTexture)),this._shaderData.addUniform(new o.Uniform(s.Const.GL_TYPE.FLOAT4,u._tilingOffset,new i.Vector4(1,1,0,0)))}}t.UnlitMaterial=u,u._useMainTextureDefine=a.ShaderManager.ins().registerDefine("USE_MAIN_TEXTURE"),u._useVertexColorDefine=a.ShaderManager.ins().registerDefine("USE_VERTEX_COLOR"),u._mainColor=a.ShaderManager.ins().registerUniform("u_MainColor"),u._mainTexture=a.ShaderManager.ins().registerUniform("u_MainTexture"),u._tilingOffset=a.ShaderManager.ins().registerUniform("u_TilingOffset")},"./src/core/asset/material/postprocessing/BloomPass.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BloomPass=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/math/Vector2.ts"),i=r("./src/core/asset/shader/ShaderData.ts"),o=r("./src/core/asset/shader/Uniform.ts"),l=r("./src/core/asset/texture/RenderTarget.ts"),u=r("./src/core/asset/material/postprocessing/EffectPass.ts");class _ extends u.EffectPass{constructor(e,t,r,s){super(),this._tempVec2=new n.Vector2,this._downSample=e,this._radius=t,this._iteration=r,this.threshold=s}get downSample(){return this._downSample}set downSample(e){this._downSample=e}get radius(){return this._radius}set radius(e){this._radius=e}get iteration(){return this._iteration}set iteration(e){this._iteration=e}get threshold(){return this._extBrightData.getFloat(_._thresholdID).data}set threshold(e){this._extBrightData.getFloat(_._thresholdID).data=e}_initProperty(){this._extBrightData=new i.ShaderData,this._blurData=new i.ShaderData,this._shaderData=new i.ShaderData}_initShader(){this._extBrightShader=a.ShaderManager.ins().findShader("ExtBrightShader"),this._blurShader=a.ShaderManager.ins().findShader("BlurShader"),this._shader=a.ShaderManager.ins().findShader("CombineShader")}_initUniform(){this._extBrightData.addUniform(new o.Uniform(s.Const.GL_TYPE.TEXTURE,_._sourceMapID)),this._extBrightData.addUniform(new o.Uniform(s.Const.GL_TYPE.FLOAT,_._thresholdID,1)),this._blurData.addUniform(new o.Uniform(s.Const.GL_TYPE.TEXTURE,_._sourceMapID)),this._blurData.addUniform(new o.Uniform(s.Const.GL_TYPE.FLOAT2,_._texelOffsetID,new n.Vector2)),this._shaderData.addUniform(new o.Uniform(s.Const.GL_TYPE.TEXTURE,_._sourceMapID)),this._shaderData.addUniform(new o.Uniform(s.Const.GL_TYPE.TEXTURE,_._overlayMapID))}onRender(e,t){let r=t.source,a=t.dest,n=l.RenderTarget.get({width:t.screenWidth,height:t.screenHeight,magFilter:s.Const.TEX_FILTER.LINEAR,minFilter:s.Const.TEX_FILTER.LINEAR}),i=this._extBrightShader.pass[0].compile(e,this._extBrightData.defineGroup);t.blitToScreenQuad(e,r,n,i,this._extBrightData),i=this._blurShader.pass[0].compile(e,this._blurData.defineGroup);let o=t.screenWidth/this._downSample,u=t.screenHeight/this._downSample,h=l.RenderTarget.get({width:o,height:u,magFilter:s.Const.TEX_FILTER.LINEAR,minFilter:s.Const.TEX_FILTER.LINEAR}),c=l.RenderTarget.get({width:o,height:u,magFilter:s.Const.TEX_FILTER.LINEAR,minFilter:s.Const.TEX_FILTER.LINEAR});t.blitToScreenQuad(e,n,h);for(let r=0;r<this._iteration;r++)this._blurData.setFloat2(_._texelOffsetID,this._tempVec2.set(this._radius/t.screenWidth,0)),t.blitToScreenQuad(e,h,c,i,this._blurData),this._blurData.setFloat2(_._texelOffsetID,this._tempVec2.set(0,this._radius/t.screenHeight)),t.blitToScreenQuad(e,c,h,i,this._blurData);t.blitToScreenQuad(e,h,n),i=this._shader.pass[0].compile(e,this._shaderData.defineGroup),this._shaderData.setTexture(_._overlayMapID,n),t.blitToScreenQuad(e,r,a,i,this._shaderData),l.RenderTarget.put(n),l.RenderTarget.put(h),l.RenderTarget.put(c)}}t.BloomPass=_,_._sourceMapID=a.ShaderManager.ins().registerUniform(s.Const.UNIFORM_MAP.u_SourceMap),_._thresholdID=a.ShaderManager.ins().registerUniform("u_Threshold"),_._texelOffsetID=a.ShaderManager.ins().registerUniform("u_TexelOffset"),_._overlayMapID=a.ShaderManager.ins().registerUniform("u_OverlayMap")},"./src/core/asset/material/postprocessing/BlurPass.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlurPass=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/math/Vector2.ts"),i=r("./src/core/asset/shader/Uniform.ts"),o=r("./src/core/asset/texture/RenderTarget.ts"),l=r("./src/core/asset/material/postprocessing/EffectPass.ts");class u extends l.EffectPass{constructor(e,t,r){super(),this._tempVec2=new n.Vector2,this._downSample=e,this._radius=t,this._iteration=r}get downSample(){return this._downSample}set downSample(e){this._downSample=e}get radius(){return this._radius}set radius(e){this._radius=e}get iteration(){return this._iteration}set iteration(e){this._iteration=e}_initShader(){this._shader=a.ShaderManager.ins().findShader("BlurShader")}_initUniform(){this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.TEXTURE,u._sourceMapID)),this._shaderData.addUniform(new i.Uniform(s.Const.GL_TYPE.FLOAT2,u._texelOffsetID,new n.Vector2))}onRender(e,t){let r=t.source,a=t.dest,n=this.shader.pass[0].compile(e,this._shaderData.defineGroup),i=t.screenWidth/this._downSample,l=t.screenHeight/this._downSample,_=o.RenderTarget.get({width:i,height:l,magFilter:s.Const.TEX_FILTER.LINEAR,minFilter:s.Const.TEX_FILTER.LINEAR}),h=o.RenderTarget.get({width:i,height:l,magFilter:s.Const.TEX_FILTER.LINEAR,minFilter:s.Const.TEX_FILTER.LINEAR});t.blitToScreenQuad(e,r,_);for(let r=0;r<this._iteration;r++)this._shaderData.setFloat2(u._texelOffsetID,this._tempVec2.set(this._radius/t.screenWidth,0)),t.blitToScreenQuad(e,_,h,n,this._shaderData),this._shaderData.setFloat2(u._texelOffsetID,this._tempVec2.set(0,this._radius/t.screenHeight)),t.blitToScreenQuad(e,h,_,n,this._shaderData);t.blitToScreenQuad(e,_,a),o.RenderTarget.put(_),o.RenderTarget.put(h)}}t.BlurPass=u,u._sourceMapID=a.ShaderManager.ins().registerUniform(s.Const.UNIFORM_MAP.u_SourceMap),u._texelOffsetID=a.ShaderManager.ins().registerUniform("u_TexelOffset")},"./src/core/asset/material/postprocessing/EffectPass.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EffectPass=void 0;const s=r("./src/core/asset/shader/ShaderData.ts");t.EffectPass=class{constructor(){this._initShader(),this._initProperty(),this._initDefine(),this._initUniform()}get shader(){return this._shader}get shaderData(){return this._shaderData}_initShader(){}_initProperty(){this._shaderData=new s.ShaderData}_initDefine(){}_initUniform(){}onRender(e,t){let r=t.source,s=t.dest,a=this.shader.pass[0].compile(e,this._shaderData.defineGroup);t.blitToScreenQuad(e,r,s,a,this._shaderData)}}},"./src/core/asset/material/postprocessing/NormalPass.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NormalPass=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/asset/shader/Uniform.ts"),i=r("./src/core/asset/material/postprocessing/EffectPass.ts");class o extends i.EffectPass{_initShader(){this._shader=a.ShaderManager.ins().findShader("BlitToQuadShader")}_initUniform(){this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.TEXTURE,o._sourceMapID))}}t.NormalPass=o,o._sourceMapID=a.ShaderManager.ins().registerUniform(s.Const.UNIFORM_MAP.u_SourceMap)},"./src/core/asset/material/postprocessing/Postprocessor.ts":function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Postprocessor=void 0;const a=s(r("./src/config/Config.ts")),n=r("./src/core/common/Const.ts"),i=r("./src/core/manager/ShaderManager.ts"),o=r("./src/core/system/renderer/state/TextureState.ts"),l=r("./src/core/util/Utils.ts"),u=r("./src/core/asset/texture/RenderTarget.ts"),_=r("./src/core/asset/material/postprocessing/NormalPass.ts"),h=r("./src/core/asset/material/postprocessing/ToneMappingPass.ts"),c=r("./src/core/manager/TimerManager.ts"),d=l.Utils.Mesh.createQuad("Z",1,0,2,2),m=i.ShaderManager.ins().registerUniform(n.Const.UNIFORM_MAP.u_SourceMap);class g{constructor(e,t){let r=this._screenWidth=a.default.width,s=this._screenHeight=a.default.height,i=e.enabledHDR?n.Const.TEX_INTERNAL_FORMAT.RGBA32F:n.Const.TEX_INTERNAL_FORMAT.RGBA8;this._camera=e,this._initial=new u.RenderTarget({width:r,height:s,colorFormat:i}),this._source=new u.RenderTarget({width:r,height:s,colorFormat:i}),this._dest=new u.RenderTarget({width:r,height:s,colorFormat:i}),this._pass=t||new Array}static get textureState(){return this._textureState||(this._textureState=new o.TextureState),this._textureState}static get normalPass(){return this._normalPass||(this._normalPass=new _.NormalPass),this._normalPass}static get toneMappingPass(){return this._toneMappingPass||(this._toneMappingPass=new h.ToneMappingPass),this._toneMappingPass}get initial(){return this._initial}get source(){return this._source}get dest(){return this._dest}get screenWidth(){return this._screenWidth}get screenHeight(){return this._screenHeight}addPass(e,t=Number.MAX_VALUE){-1===this._pass.indexOf(e)&&(t=l.Utils.Math.clamp(t,0,this._pass.length),this._pass.splice(t,0,e))}delPass(e){let t=this._pass.indexOf(e);-1!==t&&this._pass.splice(t,1)}render(e){if(0!==this._pass.length){this._source.setUp(e),e.copyTexSubImage2D(e.TEXTURE_2D,0,0,0,0,0,this._source.size.x,this._source.size.y);for(let t=0;t<this._pass.length;t++)this._pass[t].onRender(e,this),this._source.setUp(e),e.copyTexSubImage2D(e.TEXTURE_2D,0,0,0,0,0,this._source.size.x,this._source.size.y)}}blitToScreenQuad(e,t,r,s=null,a=null){g.blitToScreenQuad(e,t,r,s,a)}static blitToScreenQuad(e,t,r,s=null,o=null){r?r.setUpRT(e):e.bindFramebuffer(e.FRAMEBUFFER,null),s||(o=this.normalPass.shaderData,s=this.normalPass.shader.pass[0].compile(e,o.defineGroup));let l,u=this.textureState,_=s.uniformMap,h=o.uniformGroup.uniformMap;s.use(),o.setTexture(m,t),u.releaseAllUnits(e),_.forEach(((t,r)=>{l=h.get(i.ShaderManager.ins().findUniform(r)),l?l.type===n.Const.GL_TYPE.TEXTURE?u.uploadTexture(e,l,t):l.upload(e,t):(r===n.Const.UNIFORM_MAP.u_ScreenSize&&e.uniform2f(t,a.default.width,a.default.height),r===n.Const.UBO_ITEM_MAP.u_Time&&e.uniform1f(t,c.TimerManager.ins().curTime))})),this._setRenderState(e),d.setup(e),d.subMeshs[0].draw(e,e.TRIANGLES)}static toneMapping(e,t,r,s,a){let n=this.toneMappingPass;n.toneMapping=s,n.gamma=a;let i=n.shaderData,o=n.shader.pass[0].compile(e,i.defineGroup);this.blitToScreenQuad(e,t,r,o,i)}static _setRenderState(e){e.enable(e.CULL_FACE),e.frontFace(e.CCW)}}t.Postprocessor=g},"./src/core/asset/material/postprocessing/ToneMappingPass.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ToneMappingPass=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/ShaderManager.ts"),n=r("./src/core/asset/shader/Uniform.ts"),i=r("./src/core/asset/material/postprocessing/EffectPass.ts");class o extends i.EffectPass{constructor(e=s.Const.TONE_MAPPING.LINEAR,t=1/2.2){super(),this.toneMapping=e,this.gamma=t}get toneMapping(){return this._toneMapping}set toneMapping(e){var t;if(this._toneMapping!==e){switch(this._toneMapping=e,this._shaderData.removeDefine(null===(t=this._define)||void 0===t?void 0:t.id),e){case s.Const.TONE_MAPPING.LINEAR:this._define=o._linearToneMappingDefine;break;case s.Const.TONE_MAPPING.REINHARD:this._define=o._reinhardDefine;break;case s.Const.TONE_MAPPING.OPTIMIZED_CINEON:this._define=o._optimizedCineonToneMappingDefine;break;case s.Const.TONE_MAPPING.ACES_FILMIC:this._define=o._acesFilmicToneMappingDefine}this._shaderData.addDefine(this._define)}}get gamma(){return this._shaderData.getFloat(o._gammaID).data}set gamma(e){this._shaderData.getFloat(o._gammaID).data=e}_initShader(){this._shader=a.ShaderManager.ins().findShader("ToneMappingShader")}_initUniform(){this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.TEXTURE,o._sourceMapID)),this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.FLOAT,o._exposureID,1)),this._shaderData.addUniform(new n.Uniform(s.Const.GL_TYPE.FLOAT,o._gammaID,1/2.2))}}t.ToneMappingPass=o,o._linearToneMappingDefine=a.ShaderManager.ins().registerDefine("LINEAR_TONE_MAPPING"),o._reinhardDefine=a.ShaderManager.ins().registerDefine("REINHARD_TONE_MAPPING"),o._optimizedCineonToneMappingDefine=a.ShaderManager.ins().registerDefine("OPTIMIZED_CINEON_TONE_MAPPING"),o._acesFilmicToneMappingDefine=a.ShaderManager.ins().registerDefine("ACES_FILMIC_TONE_MAPPING"),o._sourceMapID=a.ShaderManager.ins().registerUniform(s.Const.UNIFORM_MAP.u_SourceMap),o._exposureID=a.ShaderManager.ins().registerUniform("u_Exposure"),o._gammaID=a.ShaderManager.ins().registerUniform("u_Gamma")},"./src/core/asset/primitive/Mesh.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mesh=void 0;const s=r("./src/core/asset/primitive/SubMesh.ts"),a=r("./src/core/manager/ShaderManager.ts");t.Mesh=class{constructor(e,t){this._gl=null,this._vertexBuffer=e,this._indexBuffer=t,this._VAO=null,this._VBO=null,this._EBO=null,this._subMeshs=new Array}get vertexBuffer(){return this._vertexBuffer}get indexBuffer(){return this._indexBuffer}get subMeshs(){return this._subMeshs}get boundingBox(){return this._boundingBox}get boundingSphere(){return this._boundingSphere}split(e,t){let r=this._indexBuffer;void 0===e&&(e=0),void 0===t&&(t=r.length);let a=new s.SubMesh(this,e,t,this._subMeshs.length);this._subMeshs.push(a)}setup(e){let t=this._vertexBuffer,r=this._indexBuffer;if(this._VAO)e.bindVertexArray(this._VAO);else{this._VAO=e.createVertexArray(),e.bindVertexArray(this._VAO);let s=this._VBO=e.createBuffer(),n=this._EBO=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,t.source,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r.source,e.STATIC_DRAW);let i,o,l,u,_=t.fSize,h=t.vertexSpan,c=this._vertexBuffer.attribNames;for(let r=0,s=c.length;r<s;r++)l=c[r],u=a.ShaderManager.ins().registerAttribute(l),i=t.getAttributeOffset(l),o=t.getAttributeSize(l),e.vertexAttribPointer(u,o,e.FLOAT,!1,_*h,_*i),e.enableVertexAttribArray(u)}}unSetup(){}destroy(){this._VAO}}},"./src/core/asset/primitive/SubMesh.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubMesh=void 0;const s=r("./src/core/common/Const.ts");t.SubMesh=class{constructor(e,t,r,s){this._mesh=e,this._startIndex=t,this._indexCount=r,this._indexInMesh=s}get indexInMesh(){return this._indexInMesh}draw(e,t){this._mesh.indexBuffer.type===s.Const.TYPE_ARRAY.Uint8?e.drawElements(t,this._indexCount,e.UNSIGNED_BYTE,this._startIndex):e.drawElements(t,this._indexCount,e.UNSIGNED_SHORT,this._startIndex)}}},"./src/core/asset/shader/BlockUniform.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlockUniform=void 0;t.BlockUniform=class{constructor(e,t){this._name=e,this._data=t}get name(){return this._name}get type(){return this._data.type}get data(){return this._data}getNextBaseOffset(){return this._data.getNextBaseOffset()}setBaseOffset(e){this._data.setBaseOffset(e)}}},"./src/core/asset/shader/Define.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Define=void 0;t.Define=class{constructor(e,t,r){this._flag=r,this._id=e,this._name=t}get id(){return this._id}get name(){return this._name}get flag(){return this._flag}}},"./src/core/asset/shader/DefineGroup.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefineGroup=void 0;const s=r("./src/core/common/BitOp.ts");t.DefineGroup=class{constructor(){this._flags=new s.BitOp,this._defines=new Map}get flags(){return this._flags}addDefine(e){this._defines.has(e.id)||(this._defines.set(e.id,e),this._flags.or(e.flag))}removeDefine(e){let t=this._defines.get(e);return t&&(this._defines.delete(e),this._flags.xor(t.flag)),t||null}getDefine(e){return this._defines.get(e)||null}hasDefine(e){return this._defines.has(e)}}},"./src/core/asset/shader/Shader.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Shader=void 0;const s=r("./src/core/asset/shader/ShaderPass.ts");class a{constructor(e,t,r,s,n){this._id=a.ID++,this._name=e,this._attributes=t,this._uniforms=r,this._uniformBlockGroup=s,this._pass=new Array,this._instancing=n}get id(){return this._id}get name(){return this._name}get attributes(){return this._attributes}get uniforms(){return this._uniforms}get uniformBlockGroup(){return this._uniformBlockGroup}get pass(){return this._pass}addPass(e,t){let r=new s.ShaderPass(this,e,t);return this._pass.push(r),r}}t.Shader=a,a.ID=0},"./src/core/asset/shader/ShaderData.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderData=void 0;const s=r("./src/core/asset/shader/DefineGroup.ts"),a=r("./src/core/asset/shader/UniformGroup.ts");t.ShaderData=class{constructor(){this._defineGroup=new s.DefineGroup,this._uniformGroup=new a.UniformGroup}get defineGroup(){return this._defineGroup}get uniformGroup(){return this._uniformGroup}addDefine(e){this._defineGroup.addDefine(e)}removeDefine(e){return this._defineGroup.removeDefine(e)}getDefine(e){return this._defineGroup.getDefine(e)}hasDefine(e){return this._defineGroup.hasDefine(e)}addUniform(e){this._uniformGroup.addUniform(e)}removeUniform(e){return this._uniformGroup.removeUniform(e)}getBoolean(e){return this._uniformGroup.getBoolean(e)}getInt(e){return this._uniformGroup.getInt(e)}getFloat(e){return this._uniformGroup.getFloat(e)}getFloat2(e){return this._uniformGroup.getFloat2(e)}setFloat2(e,t){let r=this._uniformGroup.getFloat2(e);r&&r.data.copyFrom(t)}getFloat3(e){return this._uniformGroup.getFloat3(e)}getFloat4(e){return this._uniformGroup.getFloat4(e)}getMatrix3(e){return this._uniformGroup.getMatrix3(e)}getMatrix4(e){return this._uniformGroup.getMatrix4(e)}getColor(e){return this._uniformGroup.getColor(e)}getTexture(e){return this._uniformGroup.getTexture(e)}setTexture(e,t){let r=this._uniformGroup.getTexture(e);r&&(r.data=t)}getCubeTexture(e){return this._uniformGroup.getCubeTexture(e)}}},"./src/core/asset/shader/ShaderEctype.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderEctype=void 0;const s=r("./src/core/manager/ShaderManager.ts"),a=r("./src/core/renderer/webgl/GLEnum.ts"),n=r("./src/core/renderer/webgl/GLProgram.ts"),i=r("./src/core/renderer/webgl/GLShader.ts");t.ShaderEctype=class{constructor(e){this._owner=e,this._uniformMap=new Map,this._uniformBlockMap=new Map}get program(){return this._program}get invalid(){return!this._program||this._program.invalid}get uniformMap(){return this._uniformMap}get uniformBlockMap(){return this._uniformBlockMap}get uniformBlockIDs(){return this._owner.uniformBlockGroup.uniformBlockIDs}use(){this._program.use(),this._program.uniformBlockBinding(this._uniformBlockMap)}compile(e,t,r){this._program=new n.GLProgram(e);let o=new i.GLShader(e,t,a.GLEnum.ShaderType.V_SHADER),l=new i.GLShader(e,r,a.GLEnum.ShaderType.F_SHADER);if(o.invalid||l.invalid)return void console.warn("compile shaderpass failed: vshader or fshader invalid!");this._program.attachShaders(o,l);let u=Array.from(this._owner.attributes);for(let e=0,t=u.length;e<t;e++)this._program.bindAttribLocation(u[e],s.ShaderManager.ins().registerAttribute(u[e]));if(!this._program.linkProgram())return void console.warn("compile shaderpass failed: link program failed!");let _,h,c=Array.from(this._owner.uniforms),d=this._owner.uniformBlockGroup.uniformBlocks;for(let e=0,t=c.length;e<t;e++)_=this._program.getUniformLocation(c[e]),_&&this._uniformMap.set(c[e],_);for(let e=0,t=d.length;e<t;e++)h=this._program.getUniformBlockIndex(d[e].name),-1!==h&&this._uniformBlockMap.set(d[e].id,h)}}},"./src/core/asset/shader/ShaderPass.ts":function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderPass=void 0;const a=s(r("./src/core/asset/shader/source/VSHead.glsl")),n=s(r("./src/core/asset/shader/source/FSHead.glsl")),i=r("./src/core/asset/shader/ShaderEctype.ts"),o=r("./src/core/util/Utils.ts"),l=r("./src/core/manager/ShaderManager.ts");t.ShaderPass=class{constructor(e,t,r){this._owner=e,this._vsCode=t,this._fsCode=r,this._shaderEctypes=new Map}get attributes(){return this._owner.attributes}get uniforms(){return this._owner.uniforms}get uniformBlockGroup(){return this._owner.uniformBlockGroup}compile(e,t){let r=this.uniformBlockGroup,s=t.flags.toString()+(0===r.flags?"":`&${r.flags}`);if(this._shaderEctypes.has(s))return this._shaderEctypes.get(s);let u=o.Utils.Shader.buildDefineGroupCode(t,l.ShaderManager.ins().shaderDefineMap),_=o.Utils.Shader.buildUniformBlockGroupCode(r),h=a.default+"\n"+u+"\n"+_+"\n"+this._vsCode,c=n.default+"\n"+u+"\n"+_+"\n"+this._fsCode,d=new i.ShaderEctype(this);return d.compile(e,h,c),this._shaderEctypes.set(s,d),d}}},"./src/core/asset/shader/Uniform.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Uniform=void 0;const s=r("./src/core/common/Const.ts");class a{constructor(e,t,r){switch(this._id=t,this._type=e,this._data=r,e){case s.Const.GL_TYPE.BOOL:case s.Const.GL_TYPE.INT:this.upload=a.uploadInt;break;case s.Const.GL_TYPE.FLOAT:this.upload=a.uploadFloat;break;case s.Const.GL_TYPE.FLOAT2:this.upload=a.uploadFloat2;break;case s.Const.GL_TYPE.FLOAT3:this.upload=a.uploadFloat3;break;case s.Const.GL_TYPE.FLOAT4:this.upload=a.uploadFloat4;break;case s.Const.GL_TYPE.MATRIX3:this.upload=a.uploadMatrix3;break;case s.Const.GL_TYPE.MATRIX4:this.upload=a.uploadMatrix4;break;case s.Const.GL_TYPE.COLOR:this.upload=a.uploadFloat4;break;case s.Const.GL_TYPE.TEXTURE:this.upload=a.uploadTexture;break;case s.Const.GL_TYPE.CUBE_TEXTURE:this.upload=a.uploadCubeTexture}}static uploadInt(e,t){e.uniform1i(t,this.data)}static uploadFloat(e,t){e.uniform1f(t,this.data)}static uploadFloat2(e,t){e.uniform2fv(t,this.data.value)}static uploadFloat3(e,t){e.uniform3fv(t,this.data.value)}static uploadFloat4(e,t){e.uniform4fv(t,this.data.value)}static uploadMatrix3(e,t){e.uniformMatrix3fv(t,!1,this.data.value)}static uploadMatrix4(e,t){e.uniformMatrix4fv(t,!1,this.data.value)}static uploadTexture(e,t,r){this.data.setUp(e),e.uniform1i(t,r)}static uploadCubeTexture(e,t,r){this.data.setUp(e),e.uniform1i(t,r)}get id(){return this._id}get type(){return this._type}get data(){return this._data}set data(e){this._data=e}}t.Uniform=a},"./src/core/asset/shader/UniformBlock.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UniformBlock=void 0;const s=r("./src/core/common/container/TBuffer.ts");t.UniformBlock=class{constructor(e,t){this._flag=1<<e,this._frame=-1,this._id=e,this._name=t,this._uniformMap=new Map}get flag(){return this._flag}get frame(){return this._frame}set frame(e){this._frame=e}get id(){return this._id}get name(){return this._name}get uniforms(){return[...this._uniformMap.values()]}setUp(e){if(!this._UBO){let t=this._calculateSize();this._buffer=new s.TBuffer(Float32Array,t/4,!1);let r=this._UBO=e.createBuffer();e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,t,e.DYNAMIC_DRAW),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,this._id,r),this._gl=e}}unSetup(){}addUniform(e){var t;this._uniformMap.has(e.name)||(e.setBaseOffset((null===(t=this._lastUniform)||void 0===t?void 0:t.getNextBaseOffset())||0),this._uniformMap.set(e.name,e),this._lastUniform=e)}updateData(e,t){let r,s=!1;t.forEach(((e,t)=>{r=this._uniformMap.get(t),s?r.data.updateData(this._buffer,e):s=r.data.updateData(this._buffer,e)})),s&&this.upload(e)}upload(e){e.bindBuffer(e.UNIFORM_BUFFER,this._UBO),e.bufferSubData(e.UNIFORM_BUFFER,0,this._buffer.source),e.bindBuffer(e.UNIFORM_BUFFER,null)}destroy(){var e;null===(e=this._gl)||void 0===e||e.deleteBuffer(this._UBO),this._gl=null,this._uniformMap.clear()}_calculateSize(){var e;return(null===(e=this._lastUniform)||void 0===e?void 0:e.getNextBaseOffset())||0}}},"./src/core/asset/shader/UniformBlockGroup.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UniformBlockGroup=void 0;t.UniformBlockGroup=class{constructor(){this._flags=0,this._uniformBlockMap=new Map}get flags(){return this._flags}get uniformBlockIDs(){return 0===this._flags?[]:(this._uniformBlockIDs||(this._uniformBlockIDs=[...this._uniformBlockMap.keys()]),this._uniformBlockIDs)}get uniformBlocks(){return 0===this._flags?[]:(this._uniformBlocks||(this._uniformBlocks=[...this._uniformBlockMap.values()]),this._uniformBlocks)}addUniformBlock(e){this._uniformBlockMap.has(e.id)||(this._uniformBlockMap.set(e.id,e),this._flags|=e.flag)}removeUniformBlock(e){let t=this._uniformBlockMap.get(e);return t&&(this._uniformBlockMap.delete(e),this._flags^=t.flag),t||null}getUniformBlock(e){return this._uniformBlockMap.get(e)||null}hasUniformBlock(e){return this._uniformBlockMap.has(e)}}},"./src/core/asset/shader/UniformGroup.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UniformGroup=void 0;t.UniformGroup=class{constructor(){this._uniformMap=new Map}get uniformMap(){return this._uniformMap}addUniform(e){this._uniformMap.has(e.id)||this._uniformMap.set(e.id,e)}removeUniform(e){let t=this._uniformMap.get(e);return this._uniformMap.delete(e),t||null}getBoolean(e){return this._uniformMap.get(e)||null}getInt(e){return this._uniformMap.get(e)||null}getFloat(e){return this._uniformMap.get(e)||null}getFloat2(e){return this._uniformMap.get(e)||null}getFloat3(e){return this._uniformMap.get(e)||null}getFloat4(e){return this._uniformMap.get(e)||null}getMatrix3(e){return this._uniformMap.get(e)||null}getMatrix4(e){return this._uniformMap.get(e)||null}getColor(e){return this._uniformMap.get(e)||null}getTexture(e){return this._uniformMap.get(e)||null}getCubeTexture(e){return this._uniformMap.get(e)||null}}},"./src/core/asset/shader/blockuniform/BlockGroup.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlockGroup=void 0;const s=r("./src/core/common/Const.ts");class a{constructor(e){this._data=e,Array.isArray(e)?(this._length=e.length,this.getNextBaseOffset=a.getNextBaseOffsetArray,this.setBaseOffset=a.setBaseOffsetArray,this.updateData=a.updateDatas):(this._length=1,this.getNextBaseOffset=a.getNextBaseOffset,this.setBaseOffset=a.setBaseOffset,this.updateData=a.updateData)}static getNextBaseOffset(){return this.data.getNextBaseOffset()}static getNextBaseOffsetArray(){var e;let t=this.data;return(null===(e=t[t.length-1])||void 0===e?void 0:e.getNextBaseOffset())||0}static setBaseOffset(e){this.data.setBaseOffset(e)}static setBaseOffsetArray(e){let t=this.data;for(let r=0,s=t.length;r<s;r++)t[r].setBaseOffset(e),e=t[r].getNextBaseOffset()}static updateData(e,t){return this.data.updateData(e,t)}static updateDatas(e,t){let r=this.data,s=!1;for(let a=0,n=t.length;a<n;a++)s?r[a].updateData(e,t[a]):s=r[a].updateData(e,t[a]);return s}get type(){return s.Const.GL_TYPE.STRUCT}get data(){return this._data}get length(){return this._length}get isArray(){return 1!==this._length}}t.BlockGroup=a},"./src/core/asset/shader/blockuniform/BlockItem.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlockItem=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/math/Vector3.ts"),n=r("./src/core/util/Utils.ts");class i{constructor(e,t,r){switch(this._name=e,this._type=t,this._data=r,this._length=Array.isArray(r)?r.length:1,this._alignedOffset=0,t){case s.Const.GL_TYPE.BOOL:case s.Const.GL_TYPE.INT:case s.Const.GL_TYPE.FLOAT:this.isArray?(this._size=this._baseAlignment=16,this.updateData=i.updateFloats):(this._size=this._baseAlignment=4,this.updateData=i.updateFloat);break;case s.Const.GL_TYPE.INT2:case s.Const.GL_TYPE.FLOAT2:this.isArray?(this._size=this._baseAlignment=16,this.updateData=i.updateFloatNs):(this._size=this._baseAlignment=8,this.updateData=i.updateFloatN);break;case s.Const.GL_TYPE.INT3:case s.Const.GL_TYPE.INT4:case s.Const.GL_TYPE.FLOAT3:case s.Const.GL_TYPE.FLOAT4:this._size=this._baseAlignment=16,this.isArray?this.updateData=i.updateFloatNs:this.updateData=i.updateFloatN;break;case s.Const.GL_TYPE.MATRIX3:this._baseAlignment=16,this._size=48,this.isArray?this.updateData=i.updateMatrixNs:this.updateData=i.updateMatrixN;break;case s.Const.GL_TYPE.MATRIX4:this._baseAlignment=16,this._size=64,this.isArray?this.updateData=i.updateMatrixNs:this.updateData=i.updateMatrixN;break;case s.Const.GL_TYPE.MATRIX2x3:this._baseAlignment=16,this._size=32}}static updateFloat(e,t){let r=this;return r._data!==t&&(r._data=t,e.setIndex(0===r._alignedOffset?0:r._alignedOffset/4,t),!0)}static updateFloats(e,t){let r=this,s=!1,a=0===r._alignedOffset?0:r._alignedOffset/4;for(let n=0,i=t.length;n<i;n++)r._data[n]!==t[n]&&(s=!0,r._data[n]=t[n],e.setIndex(a,t[n])),a+=4;return s}static updateFloatN(e,t){let r=this;return!r._data.isEqual(t)&&(r._data.copyFrom(t),n.Utils.Array.copy(t.value,e.source,0,0===r._alignedOffset?0:r._alignedOffset/4,t.value.length),!0)}static updateFloatNs(e,t){let r=this,s=!1,a=0===r._alignedOffset?0:r._alignedOffset/4;for(let i=0,o=t.length;i<o;i++)r._data[i].isEqual(t[i])||(s=!0,r._data[i].copyFrom(t[i]),n.Utils.Array.copy(t[i].value,e.source,0,a,t[i].value.length)),a+=4;return s}static updateMatrixN(e,t){let r=this;if(r._data.isEqual(t))return!1;r._data.copyFrom(t);let s=a.Vector3.get(),i=t.column,o=0===r._alignedOffset?0:r._alignedOffset/4;for(let r=0;r<i;r++)t.getColumn(r,s),n.Utils.Array.copy(s.value,e.source,0,o,s.value.length),o+=s.value.length;return a.Vector3.put(s),!0}static updateMatrixNs(e,t){let r,s=this,i=!1,o=a.Vector3.get(),l=0===s._alignedOffset?0:s._alignedOffset/4;for(let a=0,u=t.length;a<u;a++)if(s._data[a].isEqual(t[a]))l+=4*t[a].column;else{i=!0,s._data[a].copyFrom(t[a]),r=t[a].column;for(let s=0;s<r;s++)t[a].getColumn(s,o),n.Utils.Array.copy(o.value,e.source,0,l,o.value.length),l+=o.value.length}return a.Vector3.put(o),i}get isStruct(){return!1}get name(){return this._name}get type(){return this._type}get length(){return this._length}get isArray(){return 1!==this._length}get alignedOffset(){return this._alignedOffset}get baseAlignment(){return this._baseAlignment}getNextBaseOffset(){return this._alignedOffset+this._size*this._length}setBaseOffset(e){e%this._baseAlignment!=0&&(e=this._baseAlignment*Math.ceil(e/this._baseAlignment)),this._alignedOffset=e}}t.BlockItem=i,i.NumberData=new Float32Array(1),i.Matrix3Data=new Float32Array(12)},"./src/core/asset/shader/blockuniform/BlockStruct.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlockStruct=void 0;const s=r("./src/core/common/Const.ts");t.BlockStruct=class{constructor(e,t){this._name=e,this._type=s.Const.GL_TYPE.STRUCT,this._items=t}get isStruct(){return!0}get name(){return this._name}get items(){return this._items}getNextBaseOffset(){var e;return(null===(e=this._items[this._items.length-1])||void 0===e?void 0:e.getNextBaseOffset())||0}setBaseOffset(e){for(let t=0,r=this._items.length;t<r;t++)this._items[t].setBaseOffset(e),e=this._items[t].getNextBaseOffset()}updateData(e,t){let r,s=!1;for(let a=0,n=this._items.length;a<n;a++)r=t.get(this._items[a].name),r&&(s=!0,this._items[a].updateData(e,r));return s}}},"./src/core/asset/shader/blockuniform/ParallelLightStruct.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParallelLightStruct=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/math/Vector4.ts"),n=r("./src/core/asset/shader/blockuniform/BlockItem.ts"),i=r("./src/core/asset/shader/blockuniform/BlockStruct.ts");class o extends i.BlockStruct{constructor(){super("ParallelLight",[new n.BlockItem(s.Const.PARALLEL_LIGHT_STRUCT.direction,s.Const.GL_TYPE.FLOAT4,new a.Vector4),new n.BlockItem(s.Const.PARALLEL_LIGHT_STRUCT.colorAndIntensity,s.Const.GL_TYPE.FLOAT4,new a.Vector4)])}}t.ParallelLightStruct=o},"./src/core/asset/shader/blockuniform/PointLightStruct.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointLightStruct=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/math/Vector4.ts"),n=r("./src/core/asset/shader/blockuniform/BlockItem.ts"),i=r("./src/core/asset/shader/blockuniform/BlockStruct.ts");class o extends i.BlockStruct{constructor(){super("PointLight",[new n.BlockItem(s.Const.POINT_LIGHT_STRUCT.position,s.Const.GL_TYPE.FLOAT4,new a.Vector4),new n.BlockItem(s.Const.POINT_LIGHT_STRUCT.colorAndIntensity,s.Const.GL_TYPE.FLOAT4,new a.Vector4),new n.BlockItem(s.Const.POINT_LIGHT_STRUCT.constLinearQuad,s.Const.GL_TYPE.FLOAT4,new a.Vector4)])}}t.PointLightStruct=o},"./src/core/asset/shader/blockuniform/SpotLightStruct.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpotLightStruct=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/math/Vector4.ts"),n=r("./src/core/asset/shader/blockuniform/BlockItem.ts"),i=r("./src/core/asset/shader/blockuniform/BlockStruct.ts");class o extends i.BlockStruct{constructor(){super("SpotLight",[new n.BlockItem(s.Const.SPOT_LIGHT_STRUCT.positionAndCutOff,s.Const.GL_TYPE.FLOAT4,new a.Vector4),new n.BlockItem(s.Const.SPOT_LIGHT_STRUCT.directionAndOuterCutOff,s.Const.GL_TYPE.FLOAT4,new a.Vector4),new n.BlockItem(s.Const.SPOT_LIGHT_STRUCT.colorAndIntensity,s.Const.GL_TYPE.FLOAT4,new a.Vector4),new n.BlockItem(s.Const.SPOT_LIGHT_STRUCT.constLinearQuad,s.Const.GL_TYPE.FLOAT4,new a.Vector4)])}}t.SpotLightStruct=o},"./src/core/asset/texture/BaseRenderTarget.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseRenderTarget=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/asset/texture/BaseTexture.ts");class n extends a.BaseTexture{constructor(e=null){super(null,e),this._inPool=!1,this._size.set(e.width,e.height),this._magFilter=(null==e?void 0:e.magFilter)?e.magFilter:s.Const.TEX_FILTER.LINEAR,this._minFilter=(null==e?void 0:e.minFilter)?e.minFilter:s.Const.TEX_FILTER.LINEAR,this._colorFormat=(null==e?void 0:e.colorFormat)?e.colorFormat:s.Const.RT_FORMAT.RGBA8,this._depthStencilFormat=(null==e?void 0:e.depthFormat)?e.depthFormat:s.Const.RT_FORMAT.DEPTH24_STENCIL8,this._generateDepthTexture=!!(null==e?void 0:e.generateDepthTexture),this._useMipmap=!!(null==e?void 0:e.useMipmap)&&e.useMipmap,this._autoUpdate=!!(null==e?void 0:e.autoUpdate)&&e.autoUpdate,this._needUpdate=!0}get isFloatPointTexture(){return this._colorFormat===s.Const.TEX_INTERNAL_FORMAT.RGB16F||this._colorFormat===s.Const.TEX_INTERNAL_FORMAT.RGBA16F||this._colorFormat===s.Const.TEX_INTERNAL_FORMAT.RGB32F||this._colorFormat===s.Const.TEX_INTERNAL_FORMAT.RGBA32F}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){this._autoUpdate=e}get needUpdate(){return this._autoUpdate||this._needUpdate}set needUpdate(e){this._needUpdate=e}setUp(e){this._glTexture||(this._glTexture=this._createTextureAttachment(e,this._colorFormat)),e.bindTexture(e.TEXTURE_2D,this._glTexture)}setUpRT(e){}_createTextureAttachment(e,t){let r=this._getTextureAttachmentInfo(e,t),s=e.createTexture();return e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this._wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this._wrapT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,r.internalFormat,this._size.x,this._size.y,0,r.format,r.type,null),this._useMipmap&&e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null),s}_createRBOAttachment(e,t){let r=e.createRenderbuffer();return e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorage(e.RENDERBUFFER,t,this._size.x,this._size.y),r}_getAttachment(e,t){switch(t){case s.Const.RT_FORMAT.RG8:case s.Const.RT_FORMAT.RG16F:case s.Const.RT_FORMAT.RG32F:case s.Const.RT_FORMAT.RGB8:case s.Const.RT_FORMAT.SRGB8:case s.Const.RT_FORMAT.RGBA8:case s.Const.RT_FORMAT.RGB16F:case s.Const.RT_FORMAT.RGBA16F:case s.Const.RT_FORMAT.RGB32F:case s.Const.RT_FORMAT.RGBA32F:return e.COLOR_ATTACHMENT0;case s.Const.RT_FORMAT.DEPTH_COMPONENT16:case s.Const.RT_FORMAT.DEPTH_COMPONENT24:case s.Const.RT_FORMAT.DEPTH_COMPONENT32F:return e.DEPTH_ATTACHMENT;case s.Const.RT_FORMAT.STENCIL_INDEX8:return e.STENCIL_ATTACHMENT;case s.Const.RT_FORMAT.DEPTH24_STENCIL8:return e.DEPTH_STENCIL_ATTACHMENT;default:return null}}_getTextureAttachmentInfo(e,t){let r={};switch(t){case s.Const.RT_FORMAT.RG8:r.internalFormat=t,r.format=s.Const.TEX_FORMAT.RG,r.type=s.Const.TEX_DATA_TYPE.UNSIGNED_BYTE;break;case s.Const.RT_FORMAT.RG16F:r.internalFormat=t,r.format=s.Const.TEX_FORMAT.RG,r.type=s.Const.TEX_DATA_TYPE.HALF_FLOAT;break;case s.Const.RT_FORMAT.RG32F:r.internalFormat=t,r.format=s.Const.TEX_FORMAT.RG,r.type=s.Const.TEX_DATA_TYPE.FLOAT;break;case s.Const.RT_FORMAT.RGB8:case s.Const.RT_FORMAT.SRGB8:r.internalFormat=t,r.format=s.Const.TEX_FORMAT.RGB,r.type=s.Const.TEX_DATA_TYPE.UNSIGNED_BYTE;break;case s.Const.RT_FORMAT.RGBA8:case s.Const.RT_FORMAT.SRGB8_ALPHA8:r.internalFormat=t,r.format=s.Const.TEX_FORMAT.RGBA,r.type=s.Const.TEX_DATA_TYPE.UNSIGNED_BYTE;break;case s.Const.RT_FORMAT.RGB16F:r.internalFormat=t,r.format=s.Const.TEX_FORMAT.RGB,r.type=s.Const.TEX_DATA_TYPE.HALF_FLOAT;break;case s.Const.RT_FORMAT.RGBA16F:r.internalFormat=t,r.format=s.Const.TEX_FORMAT.RGBA,r.type=s.Const.TEX_DATA_TYPE.HALF_FLOAT;break;case s.Const.RT_FORMAT.RGB32F:r.internalFormat=t,r.format=s.Const.TEX_FORMAT.RGB,r.type=s.Const.TEX_DATA_TYPE.FLOAT;break;case s.Const.RT_FORMAT.RGBA32F:r.internalFormat=t,r.format=s.Const.TEX_FORMAT.RGBA,r.type=s.Const.TEX_DATA_TYPE.FLOAT;break;case s.Const.RT_FORMAT.DEPTH_COMPONENT16:r.internalFormat=t,r.format=e.DEPTH_COMPONENT,r.type=s.Const.TEX_DATA_TYPE.UNSIGNED_INT;break;case s.Const.RT_FORMAT.DEPTH_COMPONENT24:case s.Const.RT_FORMAT.DEPTH_COMPONENT32F:r.internalFormat=t,r.format=t,r.type=s.Const.TEX_DATA_TYPE.UNSIGNED_INT;break;case s.Const.RT_FORMAT.DEPTH24_STENCIL8:r.internalFormat=t,r.format=e.DEPTH_STENCIL,r.type=e.UNSIGNED_INT_24_8;break;default:throw"depht texture format wrong."}return r}}t.BaseRenderTarget=n},"./src/core/asset/texture/BaseTexture.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTexture=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/math/Vector2.ts"),n=r("./src/core/asset/Asset.ts");class i extends n.Asset{constructor(e,t=null){super(),this._source=e||null,this._wrapS=(null==t?void 0:t.wrapS)?t.wrapS:s.Const.TEX_WRAP.CLAMP_TO_EDGE,this._wrapT=(null==t?void 0:t.wrapT)?t.wrapT:s.Const.TEX_WRAP.CLAMP_TO_EDGE,this._magFilter=(null==t?void 0:t.magFilter)?t.magFilter:s.Const.TEX_FILTER.LINEAR,this._minFilter=(null==t?void 0:t.minFilter)?t.minFilter:s.Const.TEX_FILTER.LINEAR_MIPMAP_LINEAR,this._internalFormat=(null==t?void 0:t.internalFormat)?t.internalFormat:s.Const.TEX_INTERNAL_FORMAT.RGBA8,this._format=(null==t?void 0:t.format)?t.format:s.Const.TEX_FORMAT.RGBA,this._dataType=(null==t?void 0:t.dataType)?t.dataType:s.Const.TEX_DATA_TYPE.UNSIGNED_BYTE,this._encoding=(null==t?void 0:t.encoding)?t.encoding:s.Const.TEX_ENCODING.LINEAR,this._useMipmap=!(null==t?void 0:t.useMipmap)||t.useMipmap,this._mipmaps=(null==t?void 0:t.mipmaps)?t.mipmaps:[],this._preMultiplyAlpha=!!(null==t?void 0:t.preMultiplyAlpha)&&t.preMultiplyAlpha,this._flipY=!(null==t?void 0:t.flipY)||t.flipY,this._unpackAlignment=(null==t?void 0:t.unpackAlignment)?t.unpackAlignment:4,this._size=new a.Vector2}get glTexture(){return this._glTexture}get isDataTexture(){return!1}get isFloatPointTexture(){return!1}get source(){return this._source||null}set source(e){this._source=e}get wrapS(){return this._wrapS}set wrapS(e){this._wrapS=e}get wrapT(){return this._wrapT}set wrapT(e){this._wrapT=e}get magFilter(){return this._magFilter}set magFilter(e){this._magFilter=e}get minFilter(){return this._minFilter}set minFilter(e){this._minFilter=e}get internalFormat(){return this._internalFormat}set internalFormat(e){this._internalFormat=e}get format(){return this._format}set format(e){this._format=e}get dataType(){return this._dataType}set dataType(e){this._dataType=e}get encoding(){return this._encoding}get useMipmap(){return this._useMipmap}set useMipmap(e){this._useMipmap=e}get mipmaps(){return this._mipmaps}get preMultiplyAlpha(){return this._preMultiplyAlpha}set preMultiplyAlpha(e){this._preMultiplyAlpha=e}get flipY(){return this._flipY}set flipY(e){this._flipY=e}get unpackAlignment(){return this._unpackAlignment}set unpackAlignment(e){this._unpackAlignment=e}get size(){return this._size}setUp(e){}setSize(e,t){this._size.set(e,t)}}t.BaseTexture=i},"./src/core/asset/texture/BitMap.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitMap=void 0;const s=r("./src/core/asset/Asset.ts");class a extends s.Asset{constructor(e,t=1,r=1){super(),this._source=e,this._width=t,this._height=r,this._isDataBuffer=!(e instanceof HTMLImageElement)}get isDataBuffer(){return this._isDataBuffer}get dataType(){return this._source.type}get source(){return this._source}get width(){return this._width}get height(){return this._height}}t.BitMap=a},"./src/core/asset/texture/CubeRenderTarget.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CubeRenderTarget=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/asset/texture/BaseRenderTarget.ts");class n extends a.BaseRenderTarget{constructor(e=null){super(e),this._wrapR=(null==e?void 0:e.wrapR)?e.wrapR:s.Const.TEX_WRAP.CLAMP_TO_EDGE}get wrapR(){return this._wrapR}set wrapR(e){this._wrapR=e}setUp(e){this._glTexture||(this._glTexture=this._createTextureAttachment(e,this._colorFormat)),e.bindTexture(e.TEXTURE_CUBE_MAP,this._glTexture)}setUpRT(e,t=0,r=0){if(e.viewport(0,0,this._size.x*Math.pow(.5,r),this._size.y*Math.pow(.5,r)),this._FBO)e.bindFramebuffer(e.FRAMEBUFFER,this._FBO),0!=r&&e.renderbufferStorage(e.RENDERBUFFER,this._depthStencilFormat,this._size.x*Math.pow(.5,r),this._size.y*Math.pow(.5,r)),e.framebufferTexture2D(e.FRAMEBUFFER,this._getAttachment(e,this._colorFormat),e.TEXTURE_CUBE_MAP_POSITIVE_X+t,this._glTexture,r);else{let t=this._FBO=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,t),this._glTexture?e.bindTexture(e.TEXTURE_CUBE_MAP,null):this._glTexture=this._colorTexture=this._createTextureAttachment(e,this._colorFormat);let r=this._glTexture;if(e.framebufferTexture2D(e.FRAMEBUFFER,this._getAttachment(e,this._colorFormat),e.TEXTURE_CUBE_MAP_POSITIVE_X,r,0),this._generateDepthTexture)r=this._depthTexture=this._createTextureAttachment(e,this._depthStencilFormat),e.framebufferTexture2D(e.FRAMEBUFFER,this._getAttachment(e,this._depthStencilFormat),e.TEXTURE_2D,r,0);else{let t=this._RBO=this._createRBOAttachment(e,this._depthStencilFormat);e.framebufferRenderbuffer(e.FRAMEBUFFER,this._getAttachment(e,this._depthStencilFormat),e.RENDERBUFFER,t)}}}_createTextureAttachment(e,t){let r=this._getTextureAttachmentInfo(e,t),s=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,s),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,this._wrapS),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,this._wrapT),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_R,this._wrapR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,this._minFilter),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,this._magFilter);for(let t=0;t<6;t++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,r.internalFormat,this._size.x,this._size.y,0,r.format,r.type,null);return this._useMipmap&&e.generateMipmap(e.TEXTURE_CUBE_MAP),e.bindTexture(e.TEXTURE_CUBE_MAP,null),s}}t.CubeRenderTarget=n},"./src/core/asset/texture/CubeTexture.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CubeTexture=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/asset/texture/BaseTexture.ts");class n extends a.BaseTexture{constructor(e,t=null){super(e,t),this._wrapR=(null==t?void 0:t.wrapR)?t.wrapR:s.Const.TEX_WRAP.CLAMP_TO_EDGE,this._useMipmap=!0,this._flipY=!1,e&&this._size.set(e[0].width,e[0].height)}get isDataTexture(){return this._source[0].isDataBuffer}get isFloatPointTexture(){return this.isDataTexture&&this._source[0].source.type>=s.Const.TYPE_ARRAY.Uint16}get source(){return this._source||null}set source(e){super.source=e}get wrapR(){return this._wrapR}set wrapR(e){this._wrapR=e}get size(){return this._size}setUp(e){if(this._glTexture)e.bindTexture(e.TEXTURE_CUBE_MAP,this._glTexture);else{let t,r=this._glTexture=e.createTexture();e.bindTexture(e.TEXTURE_CUBE_MAP,r),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,this.wrapS),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,this.wrapT),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_R,this.wrapR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,this.magFilter),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,this.minFilter);for(let r=0,s=this.source.length;r<s;r++)t=this.isDataTexture?this.source[r].source.source:this.source[r].source,e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,this._internalFormat,this._size.x,this._size.y,0,this._format,this._dataType,t);this._useMipmap&&e.generateMipmap(e.TEXTURE_CUBE_MAP)}}}t.CubeTexture=n},"./src/core/asset/texture/RenderTarget.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderTarget=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/asset/texture/BaseRenderTarget.ts");class n extends a.BaseRenderTarget{static get(e){let t,r=-1;for(let a=0,n=this._pool.length;a<n;a++)if(t=this._pool[a],e.width===t._size.x&&e.height===t._size.y&&(e.colorFormat||s.Const.RT_FORMAT.RGBA8)===t._colorFormat&&(e.depthFormat||s.Const.RT_FORMAT.DEPTH24_STENCIL8)===t._depthStencilFormat&&(e.generateDepthTexture||!1)===t._generateDepthTexture&&(e.wrapS||s.Const.TEX_WRAP.CLAMP_TO_EDGE)===t._wrapS&&(e.wrapT||s.Const.TEX_WRAP.CLAMP_TO_EDGE)===t.wrapT&&(e.magFilter||s.Const.TEX_FILTER.LINEAR)===t._magFilter&&(e.minFilter||s.Const.TEX_FILTER.LINEAR_MIPMAP_LINEAR)===t._minFilter&&(e.internalFormat||s.Const.TEX_INTERNAL_FORMAT.RGBA8)===t._internalFormat&&(e.format||s.Const.TEX_FORMAT.RGBA)===t._format&&(e.dataType||s.Const.TEX_DATA_TYPE.UNSIGNED_BYTE)===t._dataType&&(e.encoding||s.Const.TEX_ENCODING.LINEAR)===t._encoding&&(e.useMipmap||!1)===t._useMipmap&&(e.preMultiplyAlpha||!1)===t._preMultiplyAlpha&&(e.flipY||!0)===t._flipY&&(e.unpackAlignment||4)===t._unpackAlignment){r=a;break}return t?this._pool.splice(r,1):t=new n(e),t._inPool=!1,t}static put(e){e._inPool||(e._inPool=!0,this._pool.push(e))}setUpRT(e){if(e.viewport(0,0,this._size.x,this._size.y),this._FBO)e.bindFramebuffer(e.FRAMEBUFFER,this._FBO);else{let t=this._FBO=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,t),this._glTexture?e.bindTexture(e.TEXTURE_2D,null):this._glTexture=this._colorTexture=this._createTextureAttachment(e,this._colorFormat);let r=this._glTexture;if(e.framebufferTexture2D(e.FRAMEBUFFER,this._getAttachment(e,this._colorFormat),e.TEXTURE_2D,r,0),this._generateDepthTexture)r=this._depthTexture=this._createTextureAttachment(e,this._depthStencilFormat),e.framebufferTexture2D(e.FRAMEBUFFER,this._getAttachment(e,this._depthStencilFormat),e.TEXTURE_2D,r,0);else{let t=this._RBO=this._createRBOAttachment(e,this._depthStencilFormat);e.framebufferRenderbuffer(e.FRAMEBUFFER,this._getAttachment(e,this._depthStencilFormat),e.RENDERBUFFER,t)}}}}t.RenderTarget=n,n._pool=new Array},"./src/core/asset/texture/RenderTexture.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderTexture=void 0;const s=r("./src/core/asset/texture/Texture.ts");class a extends s.Texture{}t.RenderTexture=a},"./src/core/asset/texture/Texture.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Texture=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/math/Matrix3.ts"),n=r("./src/core/math/Vector2.ts"),i=r("./src/core/asset/texture/BaseTexture.ts");class o extends i.BaseTexture{constructor(e,t=null){super(e,t),e&&this._size.set(e.width,e.height),this._position=new n.Vector2,this._rotation=0,this._transform=new a.Matrix3}get isDataTexture(){var e;return!!(null===(e=this._source)||void 0===e?void 0:e.isDataBuffer)}get isFloatPointTexture(){return this.isDataTexture&&this._source.source.type>=s.Const.TYPE_ARRAY.Uint16}get source(){return this._source||null}set source(e){super.source=e}get postion(){return this._position}get rotation(){return this._rotation}get transform(){return this._transform}setUp(e){if(this._glTexture)e.bindTexture(e.TEXTURE_2D,this._glTexture);else{let t=this._glTexture=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.wrapT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.magFilter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.minFilter);let r=this.isDataTexture?this.source.source.source:this.source.source;e.texImage2D(e.TEXTURE_2D,0,this._internalFormat,this._size.x,this._size.y,0,this._format,this._dataType,r),this._useMipmap&&e.generateMipmap(e.TEXTURE_2D)}}setOffsetAndSize(e,t,r,s){this._size.set(r,s),this._position.set(e,t)}}t.Texture=o},"./src/core/asset/texture/Texture3D.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Texture3D=void 0;const s=r("./src/core/asset/Asset.ts");class a extends s.Asset{}t.Texture3D=a},"./src/core/common/BitOp.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitOp=void 0;t.BitOp=class{constructor(e=2){this._bits=new Int32Array(e)}get bits(){return this._bits}get length(){return this._bits.length}set length(e){this._bits.length!==e&&this._setLength(e)}setBit(e,t){let r=Math.floor(e/32);r+1>this._bits.length&&this._setLength(r+1);let s=e%32;return this.setBitByIndexPos(r,s,t),this}setBitByIndexPos(e,t,r){return r?this._bits[e]|=1<<t:this._bits[e]&=~(1<<t),this}getBit(e){let t=Math.floor(e/32);if(t+1>this._bits.length)return!1;let r=e%32;return 0!=(this._bits[t]&1<<r)}getBitByIndexPos(e,t){return 0!=(this._bits[e]&1<<t)}and(e){this._setMaxLength(this,e);for(let t=0,r=this._bits.length;t<r;t++)this._bits[t]&=e._bits[t];return this}or(e){this._setMaxLength(this,e);for(let t=0,r=this._bits.length;t<r;t++)this._bits[t]|=e._bits[t];return this}xor(e){this._setMaxLength(this,e);for(let t=0,r=this._bits.length;t<r;t++)this._bits[t]^=e._bits[t];return this}not(){for(let e=0,t=this._bits.length;e<t;e++)this._bits[e]=~this._bits[e];return this}leftMove(e){let t,r;for(let s=0,a=this._bits.length;s<a;s++)r=this._bits[s],this._bits[s]=r<<e,void 0!==t&&(this._bits[s]|=t),t=r>>1-e;return this}rightMove(e){throw new Error("Method not implemented.")}toString(){let e="";for(let t=0,r=this._bits.length,s=r-1;t<r;t++)e+=t===s?this._bits[t]:this._bits[t]+"|";return e}_setLength(e){let t=this._bits;e>t.length?(this._bits=new Int32Array(e),this._bits.set(t)):this._bits=t.slice(0,e)}_setMaxLength(e,t){e.length>t.length?t.length=e.length:e.length<t.length&&(e.length=t.length)}}},"./src/core/common/Const.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Const=void 0,function(e){let t,r,s,a,n,i,o,l,u,_,h,c,d,m,g;e.PRECISION={LV0:0,LV1:.1,LV2:.01,LV3:.001,LV4:1e-4,LV5:1e-5},function(e){e[e.FloatType=0]="FloatType",e[e.HalfFloatType=1]="HalfFloatType"}(t=e.FLOAT_TYPE||(e.FLOAT_TYPE={})),function(e){e[e.Uint8=0]="Uint8",e[e.Uint16=1]="Uint16",e[e.Uint32=2]="Uint32",e[e.Float32=3]="Float32",e[e.Float64=4]="Float64"}(r=e.TYPE_ARRAY||(e.TYPE_ARRAY={})),e.GO_EVENT={ADD_CHILD:"add_child",ADD_TO_PARENT:"add_to_parent",REMOVE_CHILD:"remove_child",REMOVE_FROM_PARENT:"remove_from_parent",PARENT_CHANGE:"parent_change",GO_STATE_CHANGE:"go_state_change",SIBILING_INDEX_CHANGE:"sibiling_index_change",ADD_COMPONENT:"add_component",REMOVE_COMPONENT:"remove_component",TRANSFORM_CHANGED:"transform_changed"},e.TRANSFORM_FLAG={NONE:0,POSITION:1,ROTATION:2,SCALE:4,RS:6,TRS:7,TRS_MASK:-8,WORLD_MATRIX:8},function(e){e[e.BOOL=0]="BOOL",e[e.BOOL2=1]="BOOL2",e[e.BOOL3=2]="BOOL3",e[e.BOOL4=3]="BOOL4",e[e.INT=4]="INT",e[e.INT2=5]="INT2",e[e.INT3=6]="INT3",e[e.INT4=7]="INT4",e[e.UINT=8]="UINT",e[e.UINT2=9]="UINT2",e[e.UINT3=10]="UINT3",e[e.UINT4=11]="UINT4",e[e.FLOAT=12]="FLOAT",e[e.FLOAT2=13]="FLOAT2",e[e.FLOAT3=14]="FLOAT3",e[e.FLOAT4=15]="FLOAT4",e[e.DOUBLE=16]="DOUBLE",e[e.DOUBLE2=17]="DOUBLE2",e[e.DOUBLE3=18]="DOUBLE3",e[e.DOUBLE4=19]="DOUBLE4",e[e.MATRIX2=20]="MATRIX2",e[e.MATRIX2x3=21]="MATRIX2x3",e[e.MATRIX3=22]="MATRIX3",e[e.MATRIX3x2=23]="MATRIX3x2",e[e.MATRIX4=24]="MATRIX4",e[e.COLOR=25]="COLOR",e[e.TEXTURE=26]="TEXTURE",e[e.CUBE_TEXTURE=27]="CUBE_TEXTURE",e[e.STRUCT=28]="STRUCT",e[e.FLOAT_ARRAY=29]="FLOAT_ARRAY",e[e.VECTOR_ARRAY=30]="VECTOR_ARRAY",e[e.STRUCT_ARRAY=31]="STRUCT_ARRAY"}(s=e.GL_TYPE||(e.GL_TYPE={})),e.GL_DRAW_MODE={POINTS:WebGL2RenderingContext.POINTS,LINE_STRIP:WebGL2RenderingContext.LINE_STRIP,LINE_LOOP:WebGL2RenderingContext.LINE_LOOP,LINES:WebGL2RenderingContext.LINES,TRIANGLE_STRIP:WebGL2RenderingContext.TRIANGLE_STRIP,TRIANGLE_FAN:WebGL2RenderingContext.TRIANGLE_FAN,TRIANGLES:WebGL2RenderingContext.TRIANGLES},e.GL_RENDER_BATCH={NONE:0,STATIC:1,DYNAMIC:2,INSTANCE:3},e.GL_RENDER_MODE={OPAQUE:0,CUTOUT:1,FADE:2,TRANSPARENT:3},e.GL_RENDER_QUEUE={OPAQUE:2e3,ALPHA_TEST:2450,TRANSPARENT:3e3},e.GL_CULL_FACE={NONE:0,BACK:1,FRONT:2,FRONT_BACK:3},e.GL_DEPTH={TEST_OFF:0,TEST_NEVER:1,TEST_LESS:2,TEST_EQUAL:3,TEST_LEQUAL:4,TEST_GREATER:5,TEST_NOTEQUAL:6,TEST_GEQUAL:7,TEST_ALWAYS:8},e.GL_STENCIL={TEST_OFF:0,TEST_NEVER:1,TEST_LESS:2,TEST_EQUAL:3,TEST_LEQUAL:4,TEST_GREATER:5,TEST_NOTEQUAL:6,TEST_GEQUAL:7,TEST_ALWAYS:8,OP_ZERO:9,OP_KEEP:10,OP_REPLACE:11,OP_INCR:12,OP_INCR_WRAP:13,OP_DECR:14,OP_DECR_WRAP:15,OP_INVERT:16},e.GL_BLENDING={NONE:0,NORMAL:1,ADDITIVE:2,SUBTRACTIVE:3,MULTIPLY:4,ZERO_FACTOR:5,ONE_FACTOR:6,ONE_MINUS_SRC_COLOR_FACTOR:7,ONE_MINUS_SRC_ALPHA_FACTOR:8,ONE_MINUS_DST_ALPHA_FACTOR:9,ONE_MINUS_DST_COLOR_FACTOR:10,SRC_COLOR_FACTOR:11,SRC_ALPHA_FACTOR:12,SRC_ALPHA_SATURATE_FACTOR:13,DST_ALPHA_FACTOR:14,DST_COLOR_FACTOR:15,ADD_EQUATION:16,SUB_EQUATION:17,REVERSE_SUB_EQUATION:18,MIN_EQUATION:19,MAX_EQUATION:20},function(e){e[e.LINEAR=0]="LINEAR",e[e.REINHARD=1]="REINHARD",e[e.OPTIMIZED_CINEON=2]="OPTIMIZED_CINEON",e[e.ACES_FILMIC=3]="ACES_FILMIC"}(a=e.TONE_MAPPING||(e.TONE_MAPPING={})),e.ATTRIBUTE_MAP={a_Position:"a_Position",a_Normal:"a_Normal",a_Tangent:"a_Tangent",a_Color:"a_Color",a_Uv:"a_Uv",a_Uv1:"a_Uv1"},e.UNIFORM_MAP={u_MvpMatrix:"u_MvpMatrix",u_ModelMatrix:"u_ModelMatrix",u_NormalMatrix:"u_NormalMatrix",u_EnvLightMap:"u_EnvLightMap",u_EnvRefMap:"u_EnvRefMap",u_EnvBRDFLUTMap:"u_EnvBRDFLUTMap",u_SourceMap:"u_SourceMap",u_ScreenSize:"u_ScreenSize"},e.EnvLightMapDefineName="ENV_LIGHT_MAP",e.EnvRefMapDefineName="ENV_REF_MAP",e.EnvBRDFLUTDefineName="ENV_BRDF_LUT_MAP",e.UBO_MAP={CameraBlock:"CameraBlock",SceneBlock:"SceneBlock",LightBlock:"LightBlock",ShadowBlock:"ShadowBlock"},e.UBO_ITEM_MAP={u_ViewMatrix:"u_ViewMatrix",u_ProjectMatrix:"u_ProjectMatrix",u_ViewProjectMatrix:"u_ViewProjectMatrix",u_ProjectParams:"u_ProjectParams",u_Viewport:"u_Viewport",u_CameraPosition:"u_CameraPosition",u_CameraDirection:"u_CameraDirection",u_CameraUp:"u_CameraUp",u_Time:"u_Time",u_FogStart:"u_FogStart",u_FogRange:"u_FogRange",u_FogColor:"u_FogColor",u_EnvColorAndIntensity:"u_EnvColorAndIntensity",u_LightCounts:"u_LightCounts",u_ParallelLights:"u_ParallelLights",u_PointLights:"u_PointLights",u_SpotLights:"u_SpotLights"},e.PARALLEL_LIGHT_STRUCT={direction:"direction",colorAndIntensity:"colorAndIntensity"},e.POINT_LIGHT_STRUCT={position:"position",colorAndIntensity:"colorAndIntensity",constLinearQuad:"constLinearQuad"},e.SPOT_LIGHT_STRUCT={positionAndCutOff:"positionAndCutOff",directionAndOuterCutOff:"directionAndOuterCutOff",colorAndIntensity:"colorAndIntensity",constLinearQuad:"constLinearQuad"},function(e){e[e.TEXTURE_1D=0]="TEXTURE_1D",e[e.TEXTURE_2D=1]="TEXTURE_2D",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.CUBE=3]="CUBE"}(n=e.TEX_TYPE||(e.TEX_TYPE={})),function(e){e[e.LINEAR=0]="LINEAR",e[e.SRGB=1]="SRGB"}(i=e.TEX_ENCODING||(e.TEX_ENCODING={})),e.TEX_INTERNAL_FORMAT={R8:WebGL2RenderingContext.R8,R8I:WebGL2RenderingContext.R8I,R8UI:WebGL2RenderingContext.R8UI,R8_SNORM:WebGL2RenderingContext.R8_SNORM,R16I:WebGL2RenderingContext.R16I,R16UI:WebGL2RenderingContext.R16UI,R16F:WebGL2RenderingContext.R16F,R32I:WebGL2RenderingContext.R32I,R32UI:WebGL2RenderingContext.R32UI,R32F:WebGL2RenderingContext.R32F,RG8:WebGL2RenderingContext.RG8,RG8I:WebGL2RenderingContext.RG8I,RG8UI:WebGL2RenderingContext.RG8UI,RG8_SNORM:WebGL2RenderingContext.RG8_SNORM,RG16I:WebGL2RenderingContext.RG16I,RG16UI:WebGL2RenderingContext.RG16UI,RG16F:WebGL2RenderingContext.RG16F,RG32I:WebGL2RenderingContext.RG32I,RG32UI:WebGL2RenderingContext.RG32UI,RG32F:WebGL2RenderingContext.RG32F,RGB8:WebGL2RenderingContext.RGB8,RGB8I:WebGL2RenderingContext.RGB8I,RGB8UI:WebGL2RenderingContext.RGB8UI,RGB8_SNORM:WebGL2RenderingContext.RGB8_SNORM,RGB16I:WebGL2RenderingContext.RGB16I,RGB16UI:WebGL2RenderingContext.RGB16UI,RGB16F:WebGL2RenderingContext.RGB16F,RGB32I:WebGL2RenderingContext.RGB32I,RGB32UI:WebGL2RenderingContext.RGB32UI,RGB32F:WebGL2RenderingContext.RGB32F,SRGB8:WebGL2RenderingContext.SRGB8,RGB565:WebGL2RenderingContext.RGB565,R11F_G11F_B10F:WebGL2RenderingContext.R11F_G11F_B10F,RGB9_E5:WebGL2RenderingContext.RGB9_E5,RGBA8:WebGL2RenderingContext.RGBA8,RGBA8I:WebGL2RenderingContext.RGBA8I,RGBA8UI:WebGL2RenderingContext.RGBA8UI,RGBA8_SNORM:WebGL2RenderingContext.RGBA8_SNORM,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8,RGBA16I:WebGL2RenderingContext.RGBA16I,RGBA16UI:WebGL2RenderingContext.RGBA16UI,RGBA16F:WebGL2RenderingContext.RGBA16F,RGBA32I:WebGL2RenderingContext.RGBA32I,RGBA32UI:WebGL2RenderingContext.RGBA32UI,RGBA32F:WebGL2RenderingContext.RGBA32F,RGBA4:WebGL2RenderingContext.RGBA4,RGB5_A1:WebGL2RenderingContext.RGB5_A1,RGB10_A2:WebGL2RenderingContext.RGB10_A2,RGB10_A2UI:WebGL2RenderingContext.RGB10_A2UI},e.TEX_FORMAT={RED:WebGL2RenderingContext.RED,RED_INTEGER:WebGL2RenderingContext.RED_INTEGER,RG:WebGL2RenderingContext.RG,RG_INTEGER:WebGL2RenderingContext.RG_INTEGER,RGB:WebGL2RenderingContext.RGB,RGB_INTEGER:WebGL2RenderingContext.RGB_INTEGER,RGBA:WebGL2RenderingContext.RGBA,RGBA_INTEGER:WebGL2RenderingContext.RGBA_INTEGER},e.TEX_DATA_TYPE={BYTE:WebGL2RenderingContext.BYTE,SHORT:WebGL2RenderingContext.SHORT,UNSIGNED_BYTE:WebGL2RenderingContext.UNSIGNED_BYTE,UNSIGNED_SHORT:WebGL2RenderingContext.UNSIGNED_SHORT,INT:WebGL2RenderingContext.INT,UNSIGNED_INT:WebGL2RenderingContext.UNSIGNED_INT,UNSIGNED_SHORT_5_6_5:WebGL2RenderingContext.UNSIGNED_SHORT_5_6_5,UNSIGNED_SHORT_5_5_5_1:WebGL2RenderingContext.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_4_4_4_4:WebGL2RenderingContext.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_INT_5_9_9_9_REV:WebGL2RenderingContext.UNSIGNED_INT_5_9_9_9_REV,UNSIGNED_INT_2_10_10_10_REV:WebGL2RenderingContext.UNSIGNED_INT_2_10_10_10_REV,UNSIGNED_INT_10F_11F_11F_REV:WebGL2RenderingContext.UNSIGNED_INT_10F_11F_11F_REV,HALF_FLOAT:WebGL2RenderingContext.HALF_FLOAT,FLOAT:WebGL2RenderingContext.FLOAT},e.TEX_MAPPING={},e.TEX_WRAP={REPEAT:WebGL2RenderingContext.REPEAT,MIRRORED_REPEAT:WebGL2RenderingContext.MIRRORED_REPEAT,CLAMP_TO_EDGE:WebGL2RenderingContext.CLAMP_TO_EDGE},e.TEX_FILTER={NEAREST:WebGL2RenderingContext.NEAREST,NEAREST_MIPMAP_LINEAR:WebGL2RenderingContext.NEAREST_MIPMAP_LINEAR,NEAREST_MIPMAP_NEAREST:WebGL2RenderingContext.NEAREST_MIPMAP_NEAREST,LINEAR:WebGL2RenderingContext.LINEAR,LINEAR_MIPMAP_LINEAR:WebGL2RenderingContext.LINEAR_MIPMAP_LINEAR,LINEAR_MIPMAP_NEAREST:WebGL2RenderingContext.LINEAR_MIPMAP_NEAREST},e.RT_FORMAT={RG8:WebGL2RenderingContext.RG8,RG16F:WebGL2RenderingContext.RG16F,RG32F:WebGL2RenderingContext.RG32F,RGB8:WebGL2RenderingContext.RGB8,SRGB8:WebGL2RenderingContext.SRGB8,RGBA8:WebGL2RenderingContext.RGBA8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8,RGB16F:WebGL2RenderingContext.RGB16F,RGBA16F:WebGL2RenderingContext.RGBA16F,RGB32F:WebGL2RenderingContext.RGB32F,RGBA32F:WebGL2RenderingContext.RGBA32F,DEPTH_COMPONENT16:WebGL2RenderingContext.DEPTH_COMPONENT16,DEPTH_COMPONENT24:WebGL2RenderingContext.DEPTH_COMPONENT24,DEPTH_COMPONENT32F:WebGL2RenderingContext.DEPTH_COMPONENT32F,STENCIL_INDEX8:WebGL2RenderingContext.STENCIL_INDEX8,DEPTH24_STENCIL8:WebGL2RenderingContext.DEPTH24_STENCIL8},function(e){e[e.CUBE=0]="CUBE",e[e.SPHERE=1]="SPHERE",e[e.CONE=2]="CONE",e[e.CYLINDER=3]="CYLINDER",e[e.CAPSULE=4]="CAPSULE",e[e.TORUS=5]="TORUS",e[e.TORUS_KNOT=6]="TORUS_KNOT",e[e.QUAD=7]="QUAD",e[e.PLANE=8]="PLANE"}(o=e.PRIMITIVE_TYPE||(e.PRIMITIVE_TYPE={})),function(e){e[e.BITMAP=0]="BITMAP",e[e.TEXTURE=1]="TEXTURE",e[e.TEXTURE3D=2]="TEXTURE3D",e[e.CUBE_TEXTURE=3]="CUBE_TEXTURE",e[e.AUDIO=4]="AUDIO",e[e.GLTF=5]="GLTF",e[e.ARRAY_BUFFER=6]="ARRAY_BUFFER",e[e.BLOB=7]="BLOB",e[e.DOCUMENT=8]="DOCUMENT",e[e.JSON=9]="JSON",e[e.TEXT=10]="TEXT"}(l=e.ASSET_TYPE||(e.ASSET_TYPE={})),function(e){e[e.SkyBox=0]="SkyBox",e[e.SkySphere=1]="SkySphere"}(u=e.SKYBOX_TYPE||(e.SKYBOX_TYPE={})),function(e){e[e.Parallel=0]="Parallel",e[e.Point=1]="Point",e[e.Spot=2]="Spot"}(_=e.LIGHT_TYPE||(e.LIGHT_TYPE={})),function(e){e[e.Realtime=0]="Realtime",e[e.Mixed=1]="Mixed",e[e.Baked=2]="Baked"}(h=e.LIGHT_MODE||(e.LIGHT_MODE={})),function(e){e[e.No=0]="No",e[e.Hard=1]="Hard",e[e.Soft=2]="Soft"}(c=e.SHADOW_TYPE||(e.SHADOW_TYPE={})),function(e){e[e.SkyBox=0]="SkyBox",e[e.Color=1]="Color"}(d=e.ENV_LIGHT_TYPE||(e.ENV_LIGHT_TYPE={})),function(e){e[e.SkyBox=0]="SkyBox",e[e.Custom=1]="Custom"}(m=e.ENV_REF_TYPE||(e.ENV_REF_TYPE={})),function(e){e[e.NONE=0]="NONE",e[e.Default=1]="Default",e[e.Layer1=2]="Layer1",e[e.Layer2=4]="Layer2",e[e.Layer3=8]="Layer3",e[e.Layer4=16]="Layer4",e[e.Layer5=32]="Layer5",e[e.Layer6=64]="Layer6",e[e.Layer7=128]="Layer7",e[e.Layer8=256]="Layer8",e[e.SkyBox=512]="SkyBox",e[e.ALL=1023]="ALL"}(g=e.LAYER||(e.LAYER={})),e.KEY_BOARD={ShiftLeft:"ShiftLeft",AltLeft:"AltLeft",ControlLeft:"ControlLeft",ArrowUp:"ArrowUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",KeyQ:"KeyQ",KeyW:"KeyW",KeyE:"KeyE",KeyR:"KeyR",KeyT:"KeyT",KeyU:"KeyU",KeyI:"KeyI",KeyO:"KeyO",KeyP:"KeyP",KeyA:"KeyA",KeyS:"KeyS",KeyD:"KeyD",KeyF:"KeyF",KeyG:"KeyG",KeyH:"KeyH",KeyJ:"KeyJ",KeyK:"KeyK",KeyL:"KeyL",KeyZ:"KeyZ",KeyX:"KeyX",KeyC:"KeyC",KeyV:"KeyV",KeyB:"KeyB",KeyN:"KeyN",KeyM:"KeyM"}}(t.Const||(t.Const={}))},"./src/core/common/Handler.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Handler=void 0;const s=r("./src/core/manager/PoolManager.ts");class a{constructor(e,t,...r){this._method=e,this._context=t,this._params=r}static get(e,t,...r){let n=s.PoolManager.ins().getPool(this._TAG);return n||(n=s.PoolManager.ins().addPool(this._TAG,(()=>new a),{init:(e,t,r,...s)=>{e.set(t,r,...s)},reset:e=>{e.set(null,null,null)}})),n.get(e,t,...r)}static put(e){let t=s.PoolManager.ins().getPool(this._TAG);return t||(t=s.PoolManager.ins().addPool(this._TAG,(()=>new a),{init:(e,t,r,...s)=>{e.set(t,r,...s)},reset:e=>{e.set(null,null,null)}})),t.put(e)}set(e,t,...r){this._method=e,this._context=t,this._params=r}call(...e){this._params&&0!==this._params.length&&e.unshift(...this._params),this._method.apply(this._context,e)}}t.Handler=a,a._TAG="Handler"},"./src/core/common/Timer.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=void 0;const s=r("./src/core/common/Handler.ts");function a(e){if(this._delay>0)this._delay--;else if(this._sumDelta+=e,this._wait>0)this._wait--;else{if(0!==this._onceHandlers.length){for(let e=0,t=this._onceHandlers.length;e<t;e++)this._onceHandlers[e].call(this._sumDelta);s.Handler.put(this._onceHandlers)}for(let e=0,t=this._loopHandlers.length;e<t;e++)this._loopHandlers[e].call(this._sumDelta);this._wait=this._delta-1,this._sumDelta=0,this._curFrame++}}function n(e){let t=0;if(this._delay>0){if(this._delay-=e,!(this._delay<0))return;this._wait=-this._delay,this._delay=0,t++}else this._wait+=e;for(t+=Math.floor(this._wait/this._delta),this._wait%=this._delta;t-- >0;){if(0!==this._onceHandlers.length){for(let e=0,t=this._onceHandlers.length;e<t;e++)this._onceHandlers[e].call(this._delta);s.Handler.put(this._onceHandlers)}for(let e=0,t=this._loopHandlers.length;e<t;e++)this._loopHandlers[e].call(this._delta);this._curFrame++}}t.Timer=class{constructor(e=0,t=1,r=!0){this._delay=e,this._delta=t,this._baseFrame=r,this._onceHandlers=new Array,this._loopHandlers=new Array,this._curFrame=0,this._wait=0,this._sumDelta=0,this._tick=r?a.bind(this):n.bind(this)}get delay(){return this._delay}get delta(){return this._delta}get baseFrame(){return this._baseFrame}get curFrame(){return this._curFrame}addHandler(e,t=!1){t?this._onceHandlers.push(e):this._loopHandlers.push(e)}}},"./src/core/common/container/TBuffer.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TBuffer=void 0;const s=r("./src/core/util/Utils.ts"),a=r("./src/core/common/Const.ts");class n{constructor(e,t=12,r=!0){"function"==typeof e?(this._creator=e,this._source=new this._creator(t),this._capacity=t,this._length=0):(this._source=e,this._capacity=t,this._length=Math.min(t,this._source.length),this._creator=e.constructor),this._source instanceof Uint8Array?this._type=a.Const.TYPE_ARRAY.Uint8:this._source instanceof Uint16Array?this._type=a.Const.TYPE_ARRAY.Uint16:this._source instanceof Uint32Array?this._type=a.Const.TYPE_ARRAY.Uint32:this._source instanceof Float32Array?this._type=a.Const.TYPE_ARRAY.Float32:this._type=a.Const.TYPE_ARRAY.Float64,this._autoExpand=r}get type(){return this._type}get source(){return this._source}get length(){return this._length}get capacity(){return this._capacity}get creator(){return this._creator}get fSize(){return this._creator.BYTES_PER_ELEMENT}getIndex(e){if(s.Utils.Math.isSection(e,0,this._capacity-1))return this._source[e]}setIndex(e,t){s.Utils.Math.isSection(e,0,this._capacity-1)&&(this._source[e]=t)}push(e){this._checkFill()||(this._source[this._length++]=e)}pushArray(e){for(let t=0,r=e.length;t<r&&!this._checkFill();t++)this._source[this._length++]=e[t]}pop(){let e=this._source[this._length];return this._length=s.Utils.Math.clamp(--this._length,0,this._capacity),e}unshift(e){this.splice(0,0,[e])}unshiftArray(e){this.splice(0,0,e)}shift(){for(let e=0,t=this._length-1;e<t;e++)this._source[e]=this._source[e+1];this._length--}slice(e,t){let r=this._source.slice(e,t);return new n(r,r.length,!1)}splice(e,t=-1,r,a){let n;t<0&&(t=this._length),e=s.Utils.Math.clamp(e,0,this._length),t=s.Utils.Math.clamp(t,0,this._length-e),a&&t>0&&(n=new this._creator(t),s.Utils.Array.copy(this._source,n,e,0,t));let i=(null==r?void 0:r.length)||0,o=this._length-t+i;if(this._autoExpand)for(;this._capacity<o;)this._expand();else i=Math.min(this._capacity-this._length-t,i);let l,u=i-t,_=this._length-e-t;if(u>0)for(l=this._length-1;_>0;_--,l--)this._source[l+u]=this._source[l];else if(u<0)for(l=e+t;_>0;_--,l++)this._source[l+u]=this._source[l];for(let t=0;t<i;t++,e++)this._source[e]=r[t];return this._length=o,n||null}clear(){this._length=0}_checkFill(){if(this._length>=this._capacity){if(!this._autoExpand)return console.warn("buffer size already fill!"),!0;this._expand()}return!1}_expand(){this._capacity+=this._capacity;let e=new this._creator(this._capacity);e.set(this._source),this._source=e}_setCapacity(e){throw new Error("Method not implemented.")}}t.TBuffer=n},"./src/core/common/container/VertexBuffer.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VertexBuffer=void 0;const s=r("./src/core/util/Utils.ts"),a=r("./src/core/common/container/TBuffer.ts");class n extends a.TBuffer{constructor(e,t,r){let a=s.Utils.Array.sum(t),n=a*r;if(0===n)throw new Error("init vertex buffer faild!");super(Float32Array,n,!1),this._attribNames=e,this._attribSizes=t,this._vertexSpan=a,this._length=n,this._capacity=n,this._vertexCount=r}get attribNames(){return this._attribNames}get vertexSpan(){return this._vertexSpan}hasAttribute(e){return-1!==this._attribNames.indexOf(e)}getAttribute(e){let t=this._attribNames.indexOf(e);if(-1===t)return console.warn("not find vertex attribute name!"),null;let r=this._attribSizes[t],a=new this._creator(r*this._vertexCount),n=s.Utils.Array.sum(this._attribSizes,0,t);for(let e=0,t=0;e<this._length;e+=this._vertexSpan,t+=r)s.Utils.Array.copy(this._source,a,e+n,t,r);return a}getAttribute2At(e,t,r){return this._getAttributeAt(e,t,r.value,2),r}getAttribute3At(e,t,r){return this._getAttributeAt(e,t,r.value,3),r}setAttribute(e,t){let r=this._attribNames.indexOf(e);if(-1===r)return void console.warn("not find vertex attribute name!");let a=this._attribSizes[r],n=s.Utils.Array.sum(this._attribSizes,0,r);for(let e=0,r=0;e<this._length;e+=this._vertexSpan,r+=a)s.Utils.Array.copy(t,this._source,r,e+n,a)}setAttribute2At(e,t,r){this._setAttributeAt(e,t,r.value,2)}setAttribute3At(e,t,r){this._setAttributeAt(e,t,r.value,3)}getAttributeOffset(e){let t=this._attribNames.indexOf(e);if(-1!==t)return s.Utils.Array.sum(this._attribSizes,0,t);console.warn("not find vertex attribute name!")}getAttributeSize(e){let t=this._attribNames.indexOf(e);return-1===t?(console.warn("not find vertex attribute name!"),-1):this._attribSizes[t]}_getAttributeAt(e,t,r,a){let n=this._attribNames.indexOf(e);if(-1===n)return void console.warn("not find vertex attribute name!");if(!s.Utils.Math.isSection(t,0,this._vertexCount-1))return void console.warn("index out of bound!");let i=this._attribSizes[n],o=s.Utils.Array.sum(this._attribSizes,0,n),l=t*this._vertexSpan+o;s.Utils.Array.copy(this._source,r,l,0,Math.min(a,i))}_setAttributeAt(e,t,r,a){let n=this._attribNames.indexOf(e);if(-1===n)return void console.warn("not find vertex attribute name!");if(!s.Utils.Math.isSection(t,0,this._vertexCount-1))return void console.warn("index out of bound!");let i=this._attribSizes[n],o=s.Utils.Array.sum(this._attribSizes,0,n),l=t*this._vertexSpan+o;s.Utils.Array.copy(r,this._source,0,l,Math.min(a,i))}}t.VertexBuffer=n},"./src/core/component/Animation.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Animation=void 0;const s=r("./src/core/component/Component.ts");class a extends s.Component{}t.Animation=a},"./src/core/component/BaseCamera.ts":function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseCamera=void 0;const a=s(r("./src/config/Config.ts")),n=r("./src/core/math/Color.ts"),i=r("./src/core/math/Matrix4.ts"),o=r("./src/core/math/Vector4.ts"),l=r("./src/core/component/Component.ts"),u=r("./src/core/event/Event.ts"),_=r("./src/core/common/Const.ts"),h=r("./src/core/util/Utils.ts");class c extends l.Component{constructor(){super(),this._clearFlags=0,this._background=new n.Color,this._cullingLayers=0,this._orthographic=!1,this._fov=60,this._size=5,this._aspect=a.default.aspect,this._nearPlane=.1,this._farPlane=1e3,this._viewport=new o.Vector4(0,0,1,1),this._projectMatrix=new i.Matrix4,this._projectMatrixNeedUpdate=!0,this._viewMatrixNeedUpdate=!0,this._depth=0,this._occlusionCulling=!0,this._renderTarget=null,this._enabledHDR=!1,this._enabledSMAA=!1,this._toneMapping=_.Const.TONE_MAPPING.LINEAR,this._gamma=1/2.2,this._isCubeCamera=!1}get clearFlags(){return this._clearFlags}set clearFlags(e){this._clearFlags=e}get cullingLayers(){return this._cullingLayers}set cullingLayers(e){this._cullingLayers=e}get fov(){return this._fov}set fov(e){this._fov=e,this._projectMatrixNeedUpdate=!0}get aspect(){return this._aspect}set aspect(e){this._aspect=e,this._projectMatrixNeedUpdate=!0}get background(){return this._background}get depth(){return this._depth}set depth(e){this._depth=e}get renderTarget(){return this._renderTarget||null}set renderTarget(e){this._renderTarget=e}get enabledHDR(){return this._enabledHDR}set enabledHDR(e){this._enabledHDR=e}get enabledSMAA(){return this._enabledSMAA}set enabledSMAA(e){this._enabledSMAA=e}get toneMapping(){return this._toneMapping}set toneMapping(e){this._toneMapping=e}get gamma(){return this._gamma}set gamma(e){this._gamma=e}get projectMatrix(){return this._projectMatrixNeedUpdate&&(this._updateProjectMatrix(),this._projectMatrixNeedUpdate=!1),this._projectMatrix}get isCubeCamera(){return this._isCubeCamera}_onEvent(){super._onEvent(),this._gameobject.transform.addEventListener(new u.Event(_.Const.GO_EVENT.TRANSFORM_CHANGED,this._onTransformChange,this))}_updateViewMatrix(){}_updateProjectMatrix(){if(this._orthographic){let e=this._size,t=e*this._aspect;this._projectMatrix.setOrthographic(e,-e,-t,t,this._nearPlane,this._farPlane)}else this._projectMatrix.setPerspective(this._fov*h.Utils.Math.DEG2RAD,this._aspect,this._nearPlane,this._farPlane)}_onTransformChange(e){this._viewMatrixNeedUpdate=!0}}t.BaseCamera=c},"./src/core/component/Behaviour.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Behaviour=void 0;const s=r("./src/core/component/Component.ts");class a extends s.Component{}t.Behaviour=a},"./src/core/component/Camera.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/math/Matrix4.ts"),n=r("./src/core/math/Vector3.ts"),i=r("./src/core/math/Vector4.ts"),o=r("./src/core/component/BaseCamera.ts");class l extends o.BaseCamera{constructor(){super(),this._viewMatrix=new a.Matrix4,this._viewProjectMatrix=new a.Matrix4,this._uboData=new Map}get renderTarget(){return this._renderTarget||null}set renderTarget(e){this._renderTarget=e}get viewMatrix(){return this._viewMatrixNeedUpdate&&(this._updateViewMatrix(),this._viewMatrixNeedUpdate=!1),this._viewMatrix}get projectMatrix(){return this._projectMatrixNeedUpdate&&(this._updateProjectMatrix(),this._projectMatrixNeedUpdate=!1),this._projectMatrix}get viewProjectMatrix(){return a.Matrix4.multiply(this.projectMatrix,this.viewMatrix,this._viewProjectMatrix),this._viewProjectMatrix}get postprocessor(){return this._postprocessor||null}set postprocessor(e){this._postprocessor=e,e._camera=this}getCameraUBOData(){this._uboData.set(s.Const.UBO_ITEM_MAP.u_ViewMatrix,this.viewMatrix),this._uboData.set(s.Const.UBO_ITEM_MAP.u_ProjectMatrix,this.projectMatrix),this._uboData.set(s.Const.UBO_ITEM_MAP.u_ViewProjectMatrix,this.viewProjectMatrix),this._uboData.set(s.Const.UBO_ITEM_MAP.u_Viewport,this._viewport),this._uboData.set(s.Const.UBO_ITEM_MAP.u_CameraPosition,this.gameobject.transform.position);let e=this._uboData.get(s.Const.UBO_ITEM_MAP.u_ProjectParams);e?e.set(this._nearPlane,this._farPlane,1,1/this._farPlane):(e=new i.Vector4(this._nearPlane,this._farPlane,1,1/this._farPlane),this._uboData.set(s.Const.UBO_ITEM_MAP.u_ProjectParams,e));let t=this._uboData.get(s.Const.UBO_ITEM_MAP.u_CameraDirection);t||(t=new n.Vector3,this._uboData.set(s.Const.UBO_ITEM_MAP.u_CameraDirection,t)),this.gameobject.transform.getForward(t);let r=this._uboData.get(s.Const.UBO_ITEM_MAP.u_CameraUp);return r||(r=new n.Vector3,this._uboData.set(s.Const.UBO_ITEM_MAP.u_CameraUp,r)),this.gameobject.transform.getUp(r),this._uboData}_updateViewMatrix(){let e=this.gameobject.transform;this._viewMatrix.copyFrom(e.worldMatrix);let t=1/e.scale.x,r=1/e.scale.y,s=1/e.scale.z;this._viewMatrix.value[0]*=t,this._viewMatrix.value[1]*=t,this._viewMatrix.value[2]*=t,this._viewMatrix.value[4]*=r,this._viewMatrix.value[5]*=r,this._viewMatrix.value[6]*=r,this._viewMatrix.value[8]*=s,this._viewMatrix.value[9]*=s,this._viewMatrix.value[10]*=s,this._viewMatrix.invert()}}t.Camera=l},"./src/core/component/Component.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;const s=r("./src/core/event/EventDispatcher.ts"),a=r("./src/core/util/Utils.ts");class n extends s.EventDispatcher{constructor(){super(),this._uuid=a.Utils.String.generateUUID(),this._enabled=!0,this._activeInHierarchy=!1,this._invalid=!1,this._dontDestroy=!1,this._callEnable=!1,this._callStart=!1,this._dirty=!1}get uuid(){return this._uuid}get gameobject(){return this._gameobject}get enabled(){return this._enabled}set enabled(e){e!==this._enabled&&(this._enabled=e,this._gameobject.activeInHierarchy&&(e?this.onEnable():this.onDisable()))}get activeInHierarchy(){return this._activeInHierarchy}get invalid(){return this._invalid}onAwake(){this._onEvent()}onEnable(){this._gameobject._onComponentStateChange(this.constructor.FLAG,!0),this._activeInHierarchy=!0}onStart(){}onDisable(){this._gameobject._onComponentStateChange(this.constructor.FLAG,!1),this._activeInHierarchy=!1}onDestroy(){this._offEvent()}destroy(){this._dontDestroy||(this.enabled=!1,this.onDestroy(),this._gameobject._removeComponent(this.constructor))}_onEvent(){}_offEvent(){}_onGameObjectActiveChange(e){e&&this._enabled?this.onEnable():!e&&this._enabled&&this.onDisable()}}t.Component=n},"./src/core/component/CubeCamera.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CubeCamera=void 0;const s=r("./src/core/math/Vector3.ts"),a=r("./src/core/component/BaseCamera.ts"),n=r("./src/core/component/Camera.ts");class i extends a.BaseCamera{constructor(){super(),this._fov=90,this._aspect=1,this._isCubeCamera=!0,this._subCameras=[new n.Camera,new n.Camera,new n.Camera,new n.Camera,new n.Camera,new n.Camera]}set cullingLayers(e){let t;this._cullingLayers=e;for(let r=0,s=this._subCameras.length;r<s;r++)t=this._subCameras[r],t._cullingLayers=e}get renderTarget(){return this._renderTarget||null}set renderTarget(e){this._renderTarget=e}get subCameras(){return this._viewMatrixNeedUpdate&&(this._updateViewMatrix(),this._viewMatrixNeedUpdate=!1),this._projectMatrixNeedUpdate&&(this._updateProjectMatrix(),this._projectMatrixNeedUpdate=!1),this._subCameras}onAwake(){this._initSubCameras()}_initSubCameras(){let e;for(let t=0,r=this._subCameras.length;t<r;t++)e=this._subCameras[t],e._gameobject=this._gameobject,e._cullingLayers=this._cullingLayers,e._fov=90,e._aspect=1,e._viewMatrixNeedUpdate=!1,e._projectMatrixNeedUpdate=!1}_updateViewMatrix(){let e=this.gameobject.transform,t=e.position,r=e.getRight(s.Vector3.get()).normalize(),a=s.Vector3.get().copyFrom(r).negate(),n=e.getUp(s.Vector3.get()).normalize(),i=s.Vector3.get().copyFrom(n).negate(),o=e.getForward(s.Vector3.get()).negate().normalize(),l=s.Vector3.get().copyFrom(o).negate();this._setViewMatrix(l,i,a,t,this._subCameras[0].viewMatrix).invert(),this._setViewMatrix(o,i,r,t,this._subCameras[1].viewMatrix).invert(),this._setViewMatrix(r,o,i,t,this._subCameras[2].viewMatrix).invert(),this._setViewMatrix(r,l,n,t,this._subCameras[3].viewMatrix).invert(),this._setViewMatrix(r,i,l,t,this._subCameras[4].viewMatrix).invert(),this._setViewMatrix(a,i,o,t,this._subCameras[5].viewMatrix).invert(),s.Vector3.put([r,a,n,i,o,l])}_updateProjectMatrix(){super._updateProjectMatrix();for(let e=0,t=this._subCameras.length;e<t;e++)this._subCameras[e].projectMatrix.copyFrom(this._projectMatrix)}_setViewMatrix(e,t,r,a,n){n.setColumn(0,e),n.setColumn(1,t),n.setColumn(2,r),n.setColumn(3,a);let i=s.Vector3.get();return n.setRow(3,i),s.Vector3.put(i),n}}t.CubeCamera=i},"./src/core/component/Light.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Light=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/event/Event.ts"),n=r("./src/core/math/Color.ts"),i=r("./src/core/math/Vector3.ts"),o=r("./src/core/util/Utils.ts"),l=r("./src/core/component/Component.ts");class u extends l.Component{constructor(){super(),this._mode=s.Const.LIGHT_MODE.Realtime,this._color=new n.Color,this._intensity=1,this._shadowType=s.Const.SHADOW_TYPE.No,this._range=30,this._spotAngle=15,this._spotOutAngle=25,this._dirty=!0,this._parallelUBOData=new Map,this._pointUBOData=new Map,this._spotUBOData=new Map}static getAttenuation(e,t){e<7?t.set(1,.7,1.8):e<13?t.set(1,.35,.44):e<20?t.set(1,.22,.2):e<32?t.set(1,.14,.07):e<50?t.set(1,.09,.032):e<65?t.set(1,.07,.017):e<100?t.set(1,.045,.0075):e<160?t.set(1,.027,.0028):e<200?t.set(1,.022,.0019):e<325?t.set(1,.014,7e-4):e<600?t.set(1,.007,2e-4):e<3250&&t.set(1,.0014,7e-6)}static getParallelUBOData(){let e=this;if(!e._dirty)return e._parallelUBOData;e._dirty=!1;let t=e._gameobject.transform,r=e._parallelUBOData,a=r.get(s.Const.PARALLEL_LIGHT_STRUCT.direction),n=r.get(s.Const.PARALLEL_LIGHT_STRUCT.colorAndIntensity);return a||(a=new i.Vector3,r.set(s.Const.PARALLEL_LIGHT_STRUCT.direction,a)),n||(n=new i.Vector3,r.set(s.Const.PARALLEL_LIGHT_STRUCT.colorAndIntensity,n)),t.getForward(a),n.set(e._color.r,e._color.g,e._color.b,e._intensity),r}static getPointUBOData(){let e=this;if(!e._dirty)return e._pointUBOData;e._dirty=!1;let t=e._gameobject.transform,r=e._pointUBOData,a=r.get(s.Const.POINT_LIGHT_STRUCT.position),n=r.get(s.Const.POINT_LIGHT_STRUCT.colorAndIntensity),o=r.get(s.Const.POINT_LIGHT_STRUCT.constLinearQuad);return a||(a=new i.Vector3,r.set(s.Const.POINT_LIGHT_STRUCT.position,a)),n||(n=new i.Vector3,r.set(s.Const.POINT_LIGHT_STRUCT.colorAndIntensity,n)),o||(o=new i.Vector3,r.set(s.Const.POINT_LIGHT_STRUCT.constLinearQuad,o)),a.copyFrom(t.position),n.set(e._color.r,e._color.g,e._color.b,e._intensity),u.getAttenuation(e._range,o),r}static getSpotUBOData(){let e=this;if(!e._dirty)return e._spotUBOData;e._dirty=!1;let t=e._gameobject.transform,r=e._spotUBOData,a=r.get(s.Const.SPOT_LIGHT_STRUCT.positionAndCutOff),n=r.get(s.Const.SPOT_LIGHT_STRUCT.directionAndOuterCutOff),l=r.get(s.Const.SPOT_LIGHT_STRUCT.colorAndIntensity),_=r.get(s.Const.SPOT_LIGHT_STRUCT.constLinearQuad);return a||(a=new i.Vector3,r.set(s.Const.SPOT_LIGHT_STRUCT.positionAndCutOff,a)),n||(n=new i.Vector3,r.set(s.Const.SPOT_LIGHT_STRUCT.directionAndOuterCutOff,n)),l||(l=new i.Vector3,r.set(s.Const.SPOT_LIGHT_STRUCT.colorAndIntensity,l)),_||(_=new i.Vector3,r.set(s.Const.SPOT_LIGHT_STRUCT.constLinearQuad,_)),a.copyFrom(t.position),t.getForward(n),a.w=Math.cos(e._spotAngle*o.Utils.Math.DEG2RAD),n.w=Math.cos(e._spotOutAngle*o.Utils.Math.DEG2RAD),l.set(e._color.r,e._color.g,e._color.b,e._intensity),u.getAttenuation(e._range,_),r}get type(){return this._type}set type(e){e!==this._type&&(this._type=e,this._dirty=!0,this._updateType())}get color(){return this._color}set color(e){this._color!==e&&(this._color.copyFrom(e),this._dirty=!0)}get intensity(){return this._intensity}set intensity(e){this._intensity=e,this._dirty=!0}get range(){return this._range}set range(e){this._range=e,this._dirty=!0}get spotAngle(){return this._spotAngle}set spotAngle(e){this._spotAngle=e,this._dirty=!0}get spotOutAngle(){return this._spotOutAngle}set spotOutAngle(e){this._spotOutAngle=e,this._dirty=!0}onAwake(){super.onAwake(),this.type=s.Const.LIGHT_TYPE.Parallel}_onEvent(){super._onEvent(),this._gameobject.transform.addEventListener(new a.Event(s.Const.GO_EVENT.TRANSFORM_CHANGED,this._onTransformChange,this))}_updateType(){switch(this._type){case s.Const.LIGHT_TYPE.Parallel:this.getLightUBOData=u.getParallelUBOData;break;case s.Const.LIGHT_TYPE.Point:this.getLightUBOData=u.getPointUBOData;break;case s.Const.LIGHT_TYPE.Spot:this.getLightUBOData=u.getSpotUBOData}this._gameobject._onDirty()}_onTransformChange(){this._dirty=!0}}t.Light=u},"./src/core/component/LineRenderer.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineRenderer=void 0;const s=r("./src/core/component/Component.ts");class a extends s.Component{}t.LineRenderer=a},"./src/core/component/MeshFilter.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MeshFilter=void 0;const s=r("./src/core/component/Component.ts");class a extends s.Component{get mesh(){return this._mesh}set mesh(e){this._mesh=e}}t.MeshFilter=a},"./src/core/component/MeshRenderer.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MeshRenderer=void 0;const s=r("./src/core/component/Component.ts");class a extends s.Component{constructor(){super(),this._materials=new Array,this._castShadow=!1,this._receiveShadow=!1,this._frustumCulled=!0}get material(){return this._materials[0]||null}set material(e){this._materials[0]=e}get materials(){return this._materials}set materials(e){this._materials=e}}t.MeshRenderer=a},"./src/core/component/RigidBody.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RigidBody=void 0;const s=r("./src/core/component/Component.ts");class a extends s.Component{}t.RigidBody=a},"./src/core/component/SkinnedMeshRenderer.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkinnedMeshRenderer=void 0;const s=r("./src/core/component/Component.ts");class a extends s.Component{}t.SkinnedMeshRenderer=a},"./src/core/component/Transform.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/math/Euler.ts"),n=r("./src/core/math/Matrix4.ts"),i=r("./src/core/math/Quaternion.ts"),o=r("./src/core/math/Vector3.ts"),l=r("./src/core/component/Component.ts");class u extends l.Component{constructor(){super()}get position(){return this._tryUpdatePosition(),this._position}set position(e){this._position!==e&&this._position.copyFrom(e),this._positionUpdate()}get localPosition(){return this._localPosition}set localPosition(e){this._localPosition!==e&&this._localPosition.copyFrom(e),this._localPositionUpdate()}get rotation(){return this._tryUpdateRotation(),this._rotation}set rotation(e){this._rotation!==e&&this._rotation.copyFrom(e),this._rotationUpdate()}get localRotation(){return this._localRotation}set localRotation(e){this._localRotation!==e&&this._localRotation.copyFrom(e),this._localRotationUpdate()}get scale(){return this._tryUpdateScale(),this._scale}set scale(e){this._scale!==e&&this._scale.copyFrom(e),this._scaleUpdate()}get localScale(){return this._localScale}set localScale(e){this._localScale!==e&&this._localScale.copyFrom(e),this._localScaleUpdate()}get worldMatrix(){return this._tryUpdateWorldMatrix(),this._worldMatrix}set worldMatrix(e){this._worldMatrix!==e&&this._worldMatrix.copyFrom(e),this._worldMatrixUpdate()}onAwake(){super.onAwake(),this._initProperty()}_initProperty(){this._position=new o.Vector3,this._rotation=new i.Quaternion(0,0,0,1),this._scale=new o.Vector3(1,1,1),this._localPosition=new o.Vector3,this._localRotation=new i.Quaternion(0,0,0,1),this._localScale=new o.Vector3(1,1,1),this._worldMatrix=new n.Matrix4,this._dirtyWorldFlags=0,this._dontDestroy=!0}getUp(e){return this.worldMatrix.getColumn(1,e)}getRight(e){return this.worldMatrix.getColumn(0,e)}getForward(e){return this.worldMatrix.getColumn(2,e),e.negate()}getLocalMatrix(e){return e.setByTRS(this._localPosition,this._localRotation,this._localScale)}getWorldMatrixInv(e){return n.Matrix4.invert(this.worldMatrix,e),e}setTransformByMatrix(e,t=!1){t?this.worldMatrix=e:(e.toTRS(this._localPosition,this._localRotation,this._localScale),this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.TRS|s.Const.TRANSFORM_FLAG.WORLD_MATRIX,!0))}setRotateByEuler(e,t=!1){let r=i.Quaternion.get().setByEuler(e);t?this.rotation=r:this.localRotation=r,i.Quaternion.put(r)}setRotateByQuaternion(e,t=!1){t?this.rotation=e:this.localRotation=e}setRotateByMatrix(e,t=!1){let r=i.Quaternion.get().setByMatrix(e);t?this.rotation=r:this.localRotation=r,i.Quaternion.put(r)}applyTranslate(e,t=!1){let r=o.Vector3.get();t?(this.position.add(e),this.position=this._position):(this._localRotation.transformVector(e,r),this._localPosition.add(r),this.localPosition=this._localPosition),o.Vector3.put(r)}applyRotateAround(e,t,r,s=!1){let a=i.Quaternion.get().setByAxisAngle(t,r),n=o.Vector3.sub(this.position,e,o.Vector3.get());a.transformVector(n,n),n.add(e),s?this.position=n:this.localPosition=n,i.Quaternion.put(a),o.Vector3.put(n)}applyRotateByAxisAngle(e,t,r=!1){let s=i.Quaternion.get().setByAxisAngle(e,t);this.applyRotateByQuaternion(s,r),i.Quaternion.put(s)}applyRotateByEuler(e,t=!1){let r=i.Quaternion.get().setByEuler(e);this.applyRotateByQuaternion(r,t),i.Quaternion.put(r)}applyRotateX(e,t=!1){let r=a.Euler.get().set(e,0,0);this.applyRotateByEuler(r,t),a.Euler.put(r)}applyRotateY(e,t=!1){let r=a.Euler.get().set(0,e,0);this.applyRotateByEuler(r,t),a.Euler.put(r)}applyRotateZ(e,t=!1){let r=a.Euler.get().set(0,0,e);this.applyRotateByEuler(r,t),a.Euler.put(r)}applyRotateByMatrix(e,t=!1){let r=i.Quaternion.get().setByMatrix(e);this.applyRotateByQuaternion(r,t),i.Quaternion.put(r)}applyRotateByQuaternion(e,t=!1){t?(this.rotation.multiply(e),this.rotation=this._rotation):(this._localRotation.multiply(e),this.localRotation=this._localRotation)}applyScale(e,t=!1){}applyMatrix(e,t=!1){}transformPointToLocal(e,t){let r=this.getWorldMatrixInv(n.Matrix4.get());return r.transformPoint(e,t),n.Matrix4.put(r),t}transformPointToWorld(e,t){return this.worldMatrix.transformPoint(e,t)}transformVectorToLocal(e,t){let r=this.getWorldMatrixInv(n.Matrix4.get());return r.transformVector(e,t),n.Matrix4.put(r),t}transformVectorToWorld(e,t){return this.worldMatrix.transformVector(e,t)}lookAt(e,t,r=!1){let s=n.Matrix4.get();r?(s.setByLookAt(this.position,e,t),this._rotation.setByMatrix(s),this.rotation=this._rotation):(s.setByLookAt(this._localPosition,e,t),this._localRotation.setByMatrix(s),this.localRotation=this._localRotation),n.Matrix4.put(s)}_transform(e){e|=s.Const.TRANSFORM_FLAG.POSITION,e|=s.Const.TRANSFORM_FLAG.WORLD_MATRIX;let t=this._gameobject.children;for(let r=0,s=t.length;r<s;r++)t[r].transform._onParentTransform(e);this.dispatchEvent(s.Const.GO_EVENT.TRANSFORM_CHANGED,e)}_onParentTransform(e){(this._dirtyWorldFlags&e)!==e&&(this._setDirtyWorldFlag(e,!0),this._transform(e))}_onParentChange(e){e?this._worldMatrixUpdate():(this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.TRS|s.Const.TRANSFORM_FLAG.WORLD_MATRIX,!0),this._transform(s.Const.TRANSFORM_FLAG.TRS|s.Const.TRANSFORM_FLAG.WORLD_MATRIX))}_positionUpdate(){if(this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.POSITION,!1),this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.WORLD_MATRIX,!0),this._gameobject.parent){let e=this._gameobject.parent.transform.getWorldMatrixInv(n.Matrix4.get());e.transformPoint(this._position,this._localPosition),n.Matrix4.put(e)}else this._localPosition.copyFrom(this._position);this._transform(s.Const.TRANSFORM_FLAG.POSITION)}_localPositionUpdate(){this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.POSITION|s.Const.TRANSFORM_FLAG.WORLD_MATRIX,!0),this._transform(s.Const.TRANSFORM_FLAG.POSITION)}_rotationUpdate(){if(this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.ROTATION,!1),this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.WORLD_MATRIX,!0),this._gameobject.parent){let e=i.Quaternion.get();i.Quaternion.invert(this._gameobject.parent.transform.rotation,e),i.Quaternion.multiply(e,this._rotation,this._localRotation),i.Quaternion.put(e)}else this._localRotation.copyFrom(this._rotation);this._transform(s.Const.TRANSFORM_FLAG.ROTATION)}_localRotationUpdate(){this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.ROTATION|s.Const.TRANSFORM_FLAG.WORLD_MATRIX,!0),this._transform(s.Const.TRANSFORM_FLAG.ROTATION)}_scaleUpdate(){if(this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.SCALE,!1),this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.WORLD_MATRIX,!0),this._gameobject.parent){this._gameobject.transform.worldMatrix}else this._localScale.copyFrom(this._scale);this._transform(s.Const.TRANSFORM_FLAG.SCALE)}_localScaleUpdate(){this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.SCALE|s.Const.TRANSFORM_FLAG.WORLD_MATRIX,!0),this._transform(s.Const.TRANSFORM_FLAG.SCALE)}_worldMatrixUpdate(){if(this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.WORLD_MATRIX,!1),this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.TRS,!0),this._gameobject.parent){let e=this._gameobject.parent.transform.getWorldMatrixInv(n.Matrix4.get()),t=n.Matrix4.get();n.Matrix4.multiply(this._worldMatrix,e,t),t.toTRS(this._localPosition,this._localRotation,this._localScale),n.Matrix4.put([e,t])}else this._worldMatrix.toTRS(this._localPosition,this._localRotation,this._localScale);this._transform(s.Const.TRANSFORM_FLAG.TRS)}_updateWorldTransform(){var e;if(!this._getDirtyWorldFlag(s.Const.TRANSFORM_FLAG.WORLD_MATRIX))return;let t=[],r=this;for(;r&&r._getDirtyWorldFlag(s.Const.TRANSFORM_FLAG.WORLD_MATRIX);)t.push(r._gameobject.transform),r=null===(e=r._gameobject.parent)||void 0===e?void 0:e.transform;let a,i=r,l=o.Vector3.get();for(let e=t.length-1;e>=0;e--)a=t[e],a._worldMatrix.setByTRS(a._localPosition,a._localRotation,a._localScale),i&&n.Matrix4.multiply(a._worldMatrix,i._worldMatrix,a._worldMatrix),a._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.WORLD_MATRIX,!1),i=a;o.Vector3.put(l)}_tryUpdatePosition(){this._getDirtyWorldFlag(s.Const.TRANSFORM_FLAG.POSITION)&&(this._updateWorldTransform(),this._worldMatrix.getColumn(3,this._position),this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.POSITION,!1))}_tryUpdateRotation(){this._getDirtyWorldFlag(s.Const.TRANSFORM_FLAG.ROTATION)&&(this._updateWorldTransform(),this.worldMatrix.toTRS(null,this._rotation,null),this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.ROTATION,!1))}_tryUpdateScale(){this._getDirtyWorldFlag(s.Const.TRANSFORM_FLAG.SCALE)&&(this._updateWorldTransform(),this.worldMatrix.toTRS(null,null,this._scale),this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.SCALE,!1))}_tryUpdateWorldMatrix(){this._getDirtyWorldFlag(s.Const.TRANSFORM_FLAG.WORLD_MATRIX)&&(this._getDirtyWorldFlag(s.Const.TRANSFORM_FLAG.TRS)?this._updateWorldTransform():this._worldMatrix.setByTRS(this._position,this._rotation,this._scale),this._setDirtyWorldFlag(s.Const.TRANSFORM_FLAG.WORLD_MATRIX,!1))}_getDirtyWorldFlag(e){return 0!=(this._dirtyWorldFlags&e)}_setDirtyWorldFlag(e,t){t?this._dirtyWorldFlags|=e:this._dirtyWorldFlags&=~e}}t.Transform=u},"./src/core/component/Wander.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wander=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/InputManager.ts"),n=r("./src/core/math/Euler.ts"),i=r("./src/core/math/Vector3.ts"),o=r("./src/core/component/Behaviour.ts");class l extends o.Behaviour{get moveSpeed(){return this._moveSpeed}set moveSpeed(e){this._moveSpeed=e}get rotateSpeed(){return this._rotateSpeed}set rotateSpeed(e){this._rotateSpeed=e}onAwake(){this._tr=this.gameobject.transform,this._forward=new i.Vector3,this._right=new i.Vector3,this._up=new i.Vector3,this._euler=new n.Euler,this._moveSpeed=2,this._rotateSpeed=.3}onStart(){this._euler.setByQuaternion(this._tr.rotation)}onUpdate(e){let t=this._tr.position;this._tr.getForward(this._forward),this._tr.getRight(this._right),this._tr.getUp(this._up);let r=0,n=0,i=0;if(a.InputManager.ins().getKey(s.Const.KEY_BOARD.KeyA)&&(n-=1),a.InputManager.ins().getKey(s.Const.KEY_BOARD.KeyD)&&(n+=1),a.InputManager.ins().getKey(s.Const.KEY_BOARD.KeyW)&&(r+=1),a.InputManager.ins().getKey(s.Const.KEY_BOARD.KeyS)&&(r-=1),a.InputManager.ins().getKey(s.Const.KEY_BOARD.KeyQ)&&(i-=1),a.InputManager.ins().getKey(s.Const.KEY_BOARD.KeyE)&&(i+=1),this._forward.mulScalar(r).add(this._right.mulScalar(n)).add(this._up.mulScalar(i)),t.add(this._forward.mulScalar(e*this._moveSpeed)),this._tr.position=t,a.InputManager.ins().getMouseKey(2)){let t=a.InputManager.ins().getMouseDrag(2);this._euler.x+=-t.offsetY*e*this._rotateSpeed,this._euler.y+=-t.offsetX*e*this._rotateSpeed,this._tr.setRotateByEuler(this._euler)}}}t.Wander=l},"./src/core/debug/Stats.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stats=void 0;t.Stats=class{constructor(){this._mode=0;let e=this._container=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",(t=>{t.preventDefault(),this.showPanel(++this._mode%e.children.length)}),!1),this._beginTime=(performance||Date).now(),this._prevTime=this._beginTime,this._frames=0,this._fpsPanel=this.addPanel(new r("FPS","#0ff","#002")),this._msPanel=this.addPanel(new r("MS","#0f0","#020")),self.performance&&self.performance.memory&&(this._memPanel=this.addPanel(new r("MB","#f08","#201"))),this.showPanel(0)}get dom(){return this._container}addPanel(e){return this._container.appendChild(e.dom),e}showPanel(e){for(var t=0;t<this._container.children.length;t++)this._container.children[t].style.display=t===e?"block":"none";this._mode=e}begin(){this._beginTime=(performance||Date).now()}end(){this._frames++;var e=(performance||Date).now();if(this._msPanel.update(e-this._beginTime,200),e>=this._prevTime+1e3&&(this._fpsPanel.update(1e3*this._frames/(e-this._prevTime),100),this._prevTime=e,this._frames=0,this._memPanel)){var t=performance.memory;this._memPanel.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e}update(){this._beginTime=this.end()}};class r{constructor(e,t,r){this._name=e,this._fg=t,this._bg=r,this._min=1/0,this._max=0,this._pr=Math.round(window.devicePixelRatio||1),this._width=80*this._pr,this._height=48*this._pr,this._text_x=3*this._pr,this._text_y=2*this._pr,this._graph_x=3*this._pr,this._graph_y=15*this._pr,this._graph_width=74*this._pr,this._graph_height=30*this._pr;let s=this._canvas=document.createElement("canvas"),a=this._context=s.getContext("2d");s.width=this._width,s.height=this._height,s.style.cssText="width:80px;height:48px",a.font="bold "+9*this._pr+"px Helvetica,Arial,sans-serif",a.textBaseline="top",a.fillStyle=r,a.fillRect(0,0,this._width,this._height),a.fillStyle=t,a.fillText(e,this._text_x,this._text_y),a.fillRect(this._graph_x,this._graph_y,this._graph_width,this._graph_height),a.fillStyle=r,a.globalAlpha=.9,a.fillRect(this._graph_x,this._graph_y,this._graph_width,this._graph_height)}get dom(){return this._canvas}update(e,t){let r=this._canvas,s=this._context;this._min=Math.min(this._min,e),this._max=Math.max(this._max,e),s.fillStyle=this._bg,s.globalAlpha=1,s.fillRect(0,0,this._width,this._graph_y),s.fillStyle=this._fg,s.fillText(Math.round(e)+" "+this._name+" ("+Math.round(this._min)+"-"+Math.round(this._max)+")",this._text_x,this._text_y),s.drawImage(r,this._graph_x+this._pr,this._graph_y,this._graph_width-this._pr,this._graph_height,this._graph_x,this._graph_y,this._graph_width-this._pr,this._graph_height),s.fillRect(this._graph_x+this._graph_width-this._pr,this._graph_y,this._pr,this._graph_height),s.fillStyle=this._bg,s.globalAlpha=.9,s.fillRect(this._graph_x+this._graph_width-this._pr,this._graph_y,this._pr,Math.round((1-e/t)*this._graph_height))}}},"./src/core/event/Event.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Event=void 0;t.Event=class{constructor(e,t,r){this._name=e,this._handle=t,this._context=r}get name(){return this._name}get context(){return this._context||null}isEqual(e){return this._name==e._name&&this._context===e._context}call(...e){this._handle.apply(this._context,e)}destroy(){this._name=null,this._handle=null,this._context=null}}},"./src/core/event/EventDispatcher.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=void 0;t.EventDispatcher=class{addEventListener(e){if(-1!==this.hasEventListener(e.name,e.context))return;void 0===this._listenerMap&&(this._listenerMap=new Map);let t=this._listenerMap.get(e.name);t?t.push(e):(t=[e],this._listenerMap.set(e.name,t))}hasEventListener(e,t){if(void 0===this._listenerMap)return-1;let r=this._listenerMap.get(e);if(!r)return-1;for(let e=0,s=r.length;e<s;e++)if(r[e].context===t)return e;return-1}removeEventListener(e,t){let r=this.hasEventListener(e,t);if(r<0)return;let s=this._listenerMap.get(e),a=s[r];s.splice(r,1),a.destroy()}dispatchEvent(e,...t){if(void 0===this._listenerMap)return;let r=this._listenerMap.get(e);if(!r)return;let s=r.concat();for(let e=0,r=s.length;e<r;e++)s[e].call(...t)}}},"./src/core/gameobject/EnvSetting.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnvSetting=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/gameobject/setting/GI.ts"),n=r("./src/core/gameobject/setting/EnvLight.ts"),i=r("./src/core/gameobject/setting/EnvReflection.ts"),o=r("./src/core/gameobject/setting/Fog.ts"),l=r("./src/core/gameobject/setting/SkyBox.ts");t.EnvSetting=class{constructor(e){this._scene=e,this._fog=new o.Fog,this._skybox=new l.SkyBox,this._envLight=new n.EnvLight,this._envReflection=new i.EnvReflection}get fog(){return this._fog}get skybox(){return this._skybox}get envLight(){return this._envLight}get envReflection(){return this._envReflection}get gi(){return this._gi}needUpdateeGI(){this._gi||(this._gi=new a.GI(this._scene));let e=0;return this._envLight.type!==s.Const.ENV_LIGHT_TYPE.SkyBox||this._envLight.envLightMap===this._gi.envLightMap&&!this._gi.envLightCamera.renderTarget.needUpdate||(this._envLight.envLightMap=this._gi.envLightMap,e|=1),this._envReflection.type!==s.Const.ENV_REF_TYPE.SkyBox||this._envReflection.envRefMap===this._gi.envRefMap&&!this._gi.envRefCamera.renderTarget.needUpdate||(this._envReflection.envRefMap=this._gi.envRefMap,this._envReflection.brdfLUTMap=this._gi.brdfLUTMap,e|=2),e}}},"./src/core/gameobject/GameObject.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GameObject=void 0;const s=r("./src/core/asset/material/PBRMaterial.ts"),a=r("./src/core/common/Const.ts"),n=r("./src/core/component/MeshFilter.ts"),i=r("./src/core/component/MeshRenderer.ts"),o=r("./src/core/component/Transform.ts"),l=r("./src/core/event/EventDispatcher.ts"),u=r("./src/core/manager/ComponentManager.ts"),_=r("./src/core/util/Utils.ts");class h extends l.EventDispatcher{constructor(e="GameObject"){super(),this._name=e,this._initProperty()}get uuid(){return this._uuid}get name(){return this._name}get parent(){return this._parent}get children(){return this._children}get siblingIndex(){return this._siblingIndex}get components(){return this._components}get transform(){return this._transform}get layer(){return this._layer}set layer(e){this._layer=e}get active(){return this._active}set active(e){e!==this._active&&this._setActive(e)}get activeInHierarchy(){return this._active&&this._activeInUpstream}get attributeMap(){return this._attributeMap}_initProperty(){this._uuid=_.Utils.String.generateUUID(),this._layer=a.Const.LAYER.Default,this._children=new Array,this._components=new Array,this._active=!0,this._activeInUpstream=!1,this._invalid=!1,this._isScene=!1,this._belongScene=null,this._attributeMap=new Map;let e=this.addComponent(o.Transform);this._transform=e}addChild(e,t=!0){this.addChildAt(e,Number.MAX_VALUE,t)}addChildAt(e,t,r=!0){if(e._isScene)return void console.warn("scene is top node!");if(e._parent===this)return void e.setSiblingIndex(t);r&&e.transform.worldMatrix,this._link(this,e,t),e.transform._onParentChange(r),e._setActiveInUpstream(this.activeInHierarchy),this._belongScene===e._belongScene||(e._onDirty(),this._onDirty(),e.downstream((e=>(e._belongScene=this._belongScene,0))))}setParent(e,t=!0){e?e.addChild(this,t):this.removeFromParent(t)}removeFromParent(e=!0){this._parent&&(e&&this.transform.worldMatrix,this._unLink(this._parent,this),this.transform._onParentChange(e),this._setActiveInUpstream(!1),this._onDirty(),this.downstream((e=>(e._belongScene=null,0))))}removeChild(e,t=!0){e._parent===this&&e.removeFromParent(t)}removeChildAt(e,t=!0){let r=this._children[e];r&&r.removeFromParent(t)}removeAllChildren(e=!0){let t=this._children.concat();if(e)for(let e=0,r=t.length;e<r;e++)t[e].transform.worldMatrix;this._removeAllChildren(this),this._onDirty();for(let r=0,s=t.length;r<s;r++)t[r].transform._onParentChange(e),t[r]._setActiveInUpstream(!1),t[r].downstream((e=>(e._belongScene=null,0)))}getChildAt(e){return this._children[e]||null}getChildByName(e){let t;for(let r=0,s=this._children.length;r<s;r++)if(this._children[r]._name===e){t=this._children[r];break}return t||null}getChildrenByName(e){let t=new Array;for(let r=0,s=this._children.length;r<s;r++)this._children[r]._name===e&&t.push(this._children[r]);return t}getChildByUUID(e){let t;for(let r=0,s=this._children.length;r<s;r++)if(this._children[r]._uuid===e){t=this._children[r];break}return t||null}getChildByPath(e){let t=e.split("/"),r=this;for(let e=1,s=t.length;e<s&&(r=r.getChildByName(t[e]),r);e++);return r||null}getSiblingIndex(){return this._siblingIndex}setSiblingIndex(e){if(!this._parent)return;let t=this._parent._children.length;e=e<0||e>t?t:e,this.siblingIndex!==e&&this._changedSiblingIndex(this._parent,this,e)}addComponent(e){if(this.hasComponent(e))return console.warn("component already attached!"),this.getComponent(e);let t=u.ComponentManager.ins().addComponent(e);if(t){t._gameobject=this,this._components.push(t);let r=u.ComponentManager.ins().getComponentFlags(e);return this._componentFlags|=r,t.onAwake(),t}return null}getComponent(e){if(!this.hasComponent(e))return null;let t=this._getComponent(e);return this._components[t]}getComponentInChildren(e){return null}getComponentsInChildren(e){return null}hasComponent(...e){let t=u.ComponentManager.ins().getComponentFlags(...e);return-1!==t&&0!=(this._componentFlags&t)}update(){this._lastActiveComponentFlags=this._activeComponentFlags}upstream(e,t=!1){let r=!0;t||(r=e(this)),r&&this._parent&&this._parent.upstream(e)}downstream(e,t=!1){let r=0;if(t||(r=e(this)),0!==r)return r;for(let t=0,s=this._children.length;t<s;t++)if(r=this._children[t].downstream(e),2===r)return r;return r}clone(){return null}destroy(e=!0){}_onEvent(){}_offEvent(){}_onComponentStateChange(e,t){t?this._activeComponentFlags|=e:this._activeComponentFlags&=~e,this._onDirty()}_onDirty(){var e;null===(e=this._belongScene)||void 0===e||e._onSceneTreeDirty()}upstreamEvent(e,t=!1){this.upstream((t=>(t.dispatchEvent(e),!0)),t)}downstreamEvent(e,t=!1){this.downstream((t=>(t.dispatchEvent(e),0)),t)}_link(e,t,r=Number.MAX_VALUE){t._parent&&this._unLink(t._parent,t),r>=e._children.length?e._children.push(t):e._children.splice(r,0,t),t._parent=e,e.dispatchEvent(a.Const.GO_EVENT.ADD_CHILD),t.dispatchEvent(a.Const.GO_EVENT.ADD_TO_PARENT),this._updateChildSiblingIndex(e)}_unLink(e,t){e._children.splice(t._siblingIndex,1),t._parent=null,e.dispatchEvent(a.Const.GO_EVENT.REMOVE_CHILD),t.dispatchEvent(a.Const.GO_EVENT.REMOVE_FROM_PARENT),this._updateChildSiblingIndex(e)}_removeAllChildren(e){for(let t=0,r=e._children.length;t<r;t++)e._children[t]._parent=null,e._children[t].dispatchEvent(a.Const.GO_EVENT.REMOVE_FROM_PARENT);e._children.length=0,e.dispatchEvent(a.Const.GO_EVENT.REMOVE_CHILD)}_changedSiblingIndex(e,t,r){let s=t._siblingIndex,n=e._children[r];e._children[r]=t,e._children[s]=n,t.dispatchEvent(a.Const.GO_EVENT.SIBILING_INDEX_CHANGE),n.dispatchEvent(a.Const.GO_EVENT.SIBILING_INDEX_CHANGE)}_updateChildSiblingIndex(e){for(let t=0,r=e._children.length;t<r;t++)e._children[t]._siblingIndex!==t&&(e._children[t]._siblingIndex=t,e._children[t].dispatchEvent(a.Const.GO_EVENT.SIBILING_INDEX_CHANGE))}_getComponent(e){let t=this._components;for(let r=0,s=t.length;r<s;r++)if(t[r].constructor===e)return r;return-1}_removeComponent(e){let t=e.FLAG,r=this._getComponent(e),s=this._components[r];-1!==r&&(this._components.splice(r,1),this._componentFlags&=~t,this._activeComponentFlags&=~t,u.ComponentManager.ins().removeComponent(s))}_setActive(e){let t=this.activeInHierarchy;this._active=e,t!==this.activeInHierarchy&&this._onActiveInHierarchyChange()}_setActiveInUpstream(e){let t=this.activeInHierarchy;this._activeInUpstream=e,t!==this.activeInHierarchy&&this._onActiveInHierarchyChange()}_onActiveInHierarchyChange(){for(let e=0,t=this._components.length;e<t;e++)this._components[e]._onGameObjectActiveChange(this.activeInHierarchy);for(let e=0,t=this._children.length;e<t;e++)this._children[e]._setActiveInUpstream(this.activeInHierarchy)}static createPrimitive(e,t="GameObject"){let r;switch(e){case a.Const.PRIMITIVE_TYPE.CUBE:r=this._cubeMesh;break;case a.Const.PRIMITIVE_TYPE.SPHERE:r=this._sphereMesh;break;case a.Const.PRIMITIVE_TYPE.CONE:r=this._coneMesh;break;case a.Const.PRIMITIVE_TYPE.CYLINDER:r=this._cylinderMesh;break;case a.Const.PRIMITIVE_TYPE.CAPSULE:r=this._capsuleMesh;break;case a.Const.PRIMITIVE_TYPE.TORUS:r=this._torusMesh;break;case a.Const.PRIMITIVE_TYPE.TORUS_KNOT:r=this._torusKnotMesh;break;case a.Const.PRIMITIVE_TYPE.QUAD:r=this._quadMesh;break;case a.Const.PRIMITIVE_TYPE.PLANE:r=this._planeMesh}if(void 0!==r){let e=new h(t),a=e.addComponent(n.MeshFilter),o=e.addComponent(i.MeshRenderer);return a.mesh=r,o.material=this._material?this._material:this._material=new s.PBRMaterial,e}return console.warn("primitive type undfined..."),null}}t.GameObject=h,h._cubeMesh=_.Utils.Mesh.createCube(),h._sphereMesh=_.Utils.Mesh.createUVSphere(),h._coneMesh=_.Utils.Mesh.createCone(),h._cylinderMesh=_.Utils.Mesh.createCylinder(),h._capsuleMesh=_.Utils.Mesh.createCapsule(),h._torusMesh=_.Utils.Mesh.createTorus(),h._torusKnotMesh=_.Utils.Mesh.createTorusKnot(),h._quadMesh=_.Utils.Mesh.createQuad("Z"),h._planeMesh=_.Utils.Mesh.createPlane()},"./src/core/gameobject/Scene.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Scene=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/TimerManager.ts"),n=r("./src/core/gameobject/EnvSetting.ts"),i=r("./src/core/gameobject/GameObject.ts");class o extends i.GameObject{_initProperty(){super._initProperty(),this._isScene=!0,this._handleQueueMap=new Map,this._envSetting=new n.EnvSetting(this),this._uboData=new Map,this._dirty=!0,this._belongScene=this,this._activeInUpstream=!0}get env(){return this._envSetting}setHandleQueue(e){let t=new Map;for(let r=0,s=e.length;r<s;r++)t.set(e[r],this._handleQueueMap.get(e[r])||[]);this._handleQueueMap.clear(),this._handleQueueMap=t,this._dirty=!0}getHandleQueue(e){return this._handleQueueMap.get(e)||[]}getGameObjectByTag(e){return[]}getSceneUBOData(){if(this._uboData.set(s.Const.UBO_ITEM_MAP.u_Time,a.TimerManager.ins().curTime),this._envSetting.fog.enabled){let e=this._envSetting.fog;this._uboData.set(s.Const.UBO_ITEM_MAP.u_FogStart,e.fogStart),this._uboData.set(s.Const.UBO_ITEM_MAP.u_FogRange,e.fogRange),this._uboData.set(s.Const.UBO_ITEM_MAP.u_FogColor,e.fogColor)}return this._uboData.set(s.Const.UBO_ITEM_MAP.u_EnvColorAndIntensity,this._envSetting.envLight.colorAndIntensity),this._uboData}update(){if(this._dirty){let e=[...this._handleQueueMap.keys()];return this._updateQueues(e),this._dirty=!1,!0}return!1}_updateQueues(e){this._clearQueues(e),this.downstream((t=>{if(!t.activeInHierarchy)return 1;for(let r=0,s=e.length;r<s;r++)(t._activeComponentFlags&e[r])===e[r]&&this._addToQueue(e[r],t);return 0}),!0)}_addToQueue(e,t){let r=this._handleQueueMap.get(e);r&&r.push(t)}_clearQueues(e){let t;for(let r=0,s=e.length;r<s;r++)t=this._handleQueueMap.get(e[r]),t&&(t.length=0)}_onAddGameObject(e){}_onRemoveGameObject(e){}_onSceneTreeDirty(){this._dirty||(this._dirty=!0)}}t.Scene=o},"./src/core/gameobject/setting/EnvLight.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnvLight=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/math/Vector4.ts");t.EnvLight=class{constructor(){this._type=s.Const.ENV_LIGHT_TYPE.SkyBox,this._colorAndIntensity=new a.Vector4(.2,.2,.2,1)}get type(){return this._type}set type(e){this._type=e}get colorAndIntensity(){return this._colorAndIntensity}get envLightMap(){return this._envLightMap||null}set envLightMap(e){this._envLightMap=e}}},"./src/core/gameobject/setting/EnvReflection.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnvReflection=void 0;const s=r("./src/core/common/Const.ts");t.EnvReflection=class{constructor(){this._type=s.Const.ENV_REF_TYPE.SkyBox}get type(){return this._type}set type(e){this._type=e}get envRefMap(){return this._envRefMap||null}set envRefMap(e){this._envRefMap=e}get brdfLUTMap(){return this._brdfLUTMap||null}set brdfLUTMap(e){this._brdfLUTMap=e}}},"./src/core/gameobject/setting/Fog.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Fog=void 0;const s=r("./src/core/math/Color.ts");t.Fog=class{constructor(){this._enabled=!1,this.fogStart=0,this.fogRange=0,this.fogColor=new s.Color(.6,.6,.6,1)}get enabled(){return this._enabled}}},"./src/core/gameobject/setting/GI.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GI=void 0;const s=r("./src/core/asset/material/IrradianceMaterial.ts"),a=r("./src/core/asset/texture/CubeRenderTarget.ts"),n=r("./src/core/common/Const.ts"),i=r("./src/core/component/CubeCamera.ts"),o=r("./src/core/util/Utils.ts"),l=r("./src/core/component/Camera.ts"),u=r("./src/core/asset/texture/RenderTarget.ts"),_=r("./src/core/asset/material/PrefilteringMaterial.ts"),h=r("./src/core/asset/material/BRDFLUTMaterial.ts");t.GI=class{constructor(e){this._scene=e,this._initEnvCamera(),this._initGIGameObject()}get envCaptureCamera(){return this._envCaptureCamera}get envLightCamera(){return this._envLightCamera}get envRefCamera(){return this._envRefCamera}get brdfLUTCamera(){return this._brdfLUTCamera}get envCaptureMap(){return this._envCaptureCamera.renderTarget}get envLightMap(){return this._envLightCamera.renderTarget}get envRefMap(){return this._envRefCamera.renderTarget}get brdfLUTMap(){return this._brdfLUTCamera.renderTarget}getEnvLightRenderable(e){e.layer=n.Const.LAYER.SkyBox,e.mesh=this._cubeMesh,e.subMeshIndex=0,e.material=this._genIrradianceMapMtl,e.transform=this._scene.transform}getEnvRefRenderable(e){e.layer=n.Const.LAYER.SkyBox,e.mesh=this._cubeMesh,e.subMeshIndex=0,e.material=this._genPrefilteringMapMtl,e.transform=this._scene.transform}getLUTRenderable(e){e.layer=n.Const.LAYER.SkyBox,e.mesh=this._quadMesh,e.subMeshIndex=0,e.material=this._genLUTMapMtl,e.transform=this._scene.transform}_initGIGameObject(){let e=this._genIrradianceMapMtl=new s.IrradianceMaterial;e.mainTexture=this._envCaptureCamera.renderTarget,e.cullFace=n.Const.GL_CULL_FACE.FRONT;let t=this._genPrefilteringMapMtl=new _.PrefilteringMaterial;t.mainTexture=this._envCaptureCamera.renderTarget,t.cullFace=n.Const.GL_CULL_FACE.FRONT;this._genLUTMapMtl=new h.BRDFLUTMaterial;this._cubeMesh=o.Utils.Mesh.createCube(1,1,1),this._quadMesh=o.Utils.Mesh.createQuad("Z",1,0,2,2)}_initEnvCamera(){let e=this._envCaptureCamera=new i.CubeCamera;e._cullingLayers=511,e._gameobject=this._scene,e._renderTarget=new a.CubeRenderTarget({width:512,height:512,colorFormat:n.Const.TEX_INTERNAL_FORMAT.RGBA32F,minFilter:n.Const.TEX_FILTER.LINEAR_MIPMAP_LINEAR,useMipmap:!0}),e._initSubCameras();let t=this._envLightCamera=new i.CubeCamera;t._cullingLayers=511,t._gameobject=this._scene,t._renderTarget=new a.CubeRenderTarget({width:32,height:32,colorFormat:n.Const.TEX_INTERNAL_FORMAT.RGBA32F}),t._initSubCameras();let r=this._envRefCamera=new i.CubeCamera;r._cullingLayers=511,r._gameobject=this._scene,r._renderTarget=new a.CubeRenderTarget({width:128,height:128,colorFormat:n.Const.TEX_INTERNAL_FORMAT.RGBA32F,useMipmap:!0}),r._renderTarget._minFilter=n.Const.TEX_FILTER.LINEAR_MIPMAP_LINEAR,r._initSubCameras();let s=this._brdfLUTCamera=new l.Camera;s._cullingLayers=511,s._gameobject=this._scene,s._renderTarget=new u.RenderTarget({width:512,height:512,colorFormat:n.Const.TEX_INTERNAL_FORMAT.RG16F})}}},"./src/core/gameobject/setting/SkyBox.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyBox=void 0;const s=r("./src/core/asset/material/SkyBoxMaterial.ts"),a=r("./src/core/common/Const.ts"),n=r("./src/core/util/Utils.ts");class i{constructor(){this._layer=a.Const.LAYER.SkyBox}get layer(){return this._layer}set layer(e){this._layer=e}get type(){return this._type}get mesh(){return this._mesh}get material(){return this._material}set material(e){e instanceof s.SkyBoxMaterial?(this._type=a.Const.SKYBOX_TYPE.SkyBox,this._setBoxMesh()):(this._type=a.Const.SKYBOX_TYPE.SkySphere,this._setSphereMesh()),this._material=e}get enabled(){return!!this._material}_setBoxMesh(){i._boxMesh||(i._boxMesh=n.Utils.Mesh.createCube()),this._mesh=i._boxMesh}_setSphereMesh(){i._sphereMesh||(i._sphereMesh=n.Utils.Mesh.createUVSphere(1)),this._mesh=i._sphereMesh}}t.SkyBox=i},"./src/core/manager/AssetManager.ts":function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(a,n){function i(e){try{l(s.next(e))}catch(e){n(e)}}function o(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AssetManager=void 0;const a=r("./src/core/common/Const.ts"),n=r("./src/core/manager/loader/BitMapLoader.ts"),i=r("./src/core/manager/loader/CubeTextureLoader.ts"),o=r("./src/core/manager/loader/FileLoader.ts"),l=r("./src/core/manager/loader/GLTFLoader.ts"),u=r("./src/core/manager/loader/TextureLoader.ts"),_={[a.Const.ASSET_TYPE.BITMAP]:"/bitmap",[a.Const.ASSET_TYPE.TEXTURE]:"/texture",[a.Const.ASSET_TYPE.TEXTURE3D]:"/texture3d",[a.Const.ASSET_TYPE.CUBE_TEXTURE]:"/cubetexture",[a.Const.ASSET_TYPE.AUDIO]:"/audio",[a.Const.ASSET_TYPE.ARRAY_BUFFER]:"/arraybuffer",[a.Const.ASSET_TYPE.BLOB]:"/blob",[a.Const.ASSET_TYPE.DOCUMENT]:"/document",[a.Const.ASSET_TYPE.JSON]:"/json",[a.Const.ASSET_TYPE.TEXT]:"/text"},h={".png":a.Const.ASSET_TYPE.TEXTURE,".jpg":a.Const.ASSET_TYPE.TEXTURE,".hdr":a.Const.ASSET_TYPE.TEXTURE,".gltf":a.Const.ASSET_TYPE.GLTF,".glb":a.Const.ASSET_TYPE.GLTF};class c{constructor(){this._crossOrigin="anonymous",this._withCredentials=!1,this._path="",this._resourcePath="",this._requestHeader={},this._fileLoader=new o.FileLoader(this),this._bitMapLoader=new n.BitMapLoader(this),this._textureLoader=new u.TextureLoader(this),this._cubeTextureLoader=new i.CubeTextureLoader(this),this._gltfLoader=new l.GLTFLoader(this),this._urlCacheMap=new Map,this._uuidCacheMap=new Map}static ins(){return this._ins||(this._ins=new c),this._ins}get urlCacheMap(){return this._urlCacheMap}get uuidCacheMap(){return this._uuidCacheMap}get crossOrigin(){return this._crossOrigin}set crossOrigin(e){this._crossOrigin=e}get withCredentials(){return this._withCredentials}set withCredentials(e){this._withCredentials=e}get path(){return this._path}set path(e){this._path=e}get resourcePath(){return this.resourcePath}set resourcePath(e){this._resourcePath=e}get requestHeader(){return this._requestHeader}set requestHeader(e){this._requestHeader=e}get fileLoader(){return this._fileLoader}get bitMapLoader(){return this._bitMapLoader}get textureLoader(){return this._textureLoader}get cubeTextureLoader(){return this._cubeTextureLoader}get gltfLoader(){return this._gltfLoader}getAssetByURL(e,t){return this._urlCacheMap.get(e+_[t])||null}getAssetByUUID(e){return this._uuidCacheMap.get(e)||null}cacheAsset(e,t){t.uuid&&(this._urlCacheMap.set(e,t),this._uuidCacheMap.set(t.uuid,t))}loadAsync(e,t=null){return s(this,void 0,void 0,(function*(){return new Promise(((r,s)=>{this.load(e,t,{onLoad:e=>{r(e)},onError:t=>{console.error(`load asset fialed, path:${e}`),s(t)}})}))}))}load(e,t=null,r){if(""===e){let e=r.args?r.args:[];r.onLoad(null,...e)}if(null===t){let r=e.match(/.[^.]+$/)[0].toLowerCase();t=h[r]||null}switch(t){case a.Const.ASSET_TYPE.BITMAP:this._bitMapLoader.load(e,r);break;case a.Const.ASSET_TYPE.TEXTURE:this._textureLoader.load(e,r);break;case a.Const.ASSET_TYPE.CUBE_TEXTURE:this._cubeTextureLoader.load(e,r);break;case a.Const.ASSET_TYPE.GLTF:this._gltfLoader.load(e,r);break;case a.Const.ASSET_TYPE.ARRAY_BUFFER:this.loadFile(e,"arraybuffer",r);break;case a.Const.ASSET_TYPE.BLOB:this.loadFile(e,"blob",r);break;case a.Const.ASSET_TYPE.DOCUMENT:this.loadFile(e,"document",r);break;case a.Const.ASSET_TYPE.JSON:this.loadFile(e,"json",r);break;case a.Const.ASSET_TYPE.TEXT:default:this.loadFile(e,"text",r)}return null}loadFile(e,t,r){this._fileLoader.load(e,t,r)}}t.AssetManager=c},"./src/core/manager/ComponentManager.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentManager=void 0;const s=r("./src/core/component/Animation.ts"),a=r("./src/core/component/Behaviour.ts"),n=r("./src/core/component/Camera.ts"),i=r("./src/core/component/CubeCamera.ts"),o=r("./src/core/component/Light.ts"),l=r("./src/core/component/MeshFilter.ts"),u=r("./src/core/component/MeshRenderer.ts"),_=r("./src/core/component/RigidBody.ts"),h=r("./src/core/component/SkinnedMeshRenderer.ts"),c=r("./src/core/component/Transform.ts");class d{constructor(){this._initProperty(),this._registerInnerComponent()}static ins(){return this._ins||(this._ins=new d),this._ins}get behaviourMap(){return this._behaviourMap}_initProperty(){this._componentFlagMap=new Map,this._componentMap=new Map,this._behaviourMap=new Map,this._allFlags=1}_registerInnerComponent(){this.registerComponent(s.Animation),this.registerComponent(n.Camera),this.registerComponent(i.CubeCamera),this.registerComponent(o.Light),this.registerComponent(_.RigidBody),this.registerComponent(l.MeshFilter),this.registerComponent(u.MeshRenderer),this.registerComponent(h.SkinnedMeshRenderer),this.registerComponent(c.Transform)}registerComponent(e){if(this._componentFlagMap.has(e))return;let t=new Array;e.prototype instanceof a.Behaviour&&this._behaviourMap.set(e,t),this._componentMap.set(e,t),this._componentFlagMap.set(e,this._allFlags),e.FLAG=this._allFlags,this._allFlags=this._allFlags<<1}addComponent(e){this.registerComponent(e);let t=this._componentMap.get(e),r=new e;return r._innerIx=t.length,t.push(r),r}removeComponent(e){let t=this._componentMap.get(e.constructor);t&&this._removeComponent(t,e._innerIx)}getComponentFlags(...e){let t,r=0;for(let s=0,a=e.length;s<a;s++){if(t=this._componentFlagMap.get(e[s]),void 0===t)return-1;r|=t}return r}_removeComponent(e,t){for(let r=t+1,s=e.length;r<s;r++)e[r]._innerIx--;e.splice(t,1)}}t.ComponentManager=d},"./src/core/manager/EventManager.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventManager=void 0;const s=r("./src/core/event/EventDispatcher.ts");class a extends s.EventDispatcher{static ins(){return this._ins||(this._ins=new a),this._ins}}t.EventManager=a},"./src/core/manager/InputManager.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputManager=void 0;const s=r("./src/core/math/Vector2.ts");class a{constructor(){this._mouseLeftKey="MouseLeftKey",this._mouseCenterKey="MouseCenterKey",this._mouseRightKey="MouseRightKey",this._keyMap=new Map,this._keyID=0,this._keyStateA=new Array,this._keyStateB=new Array,this._keyStateC=new Array,this._mouseDowns=new Set,this._mouseInfos=[new n,new n,new n],this._onEvent()}static ins(){return this._ins||(this._ins=new a),this._ins}_onEvent(){document.body.onkeydown=e=>{this._keyStateC[this.registerKeyBoard(e.code)]=!0},document.body.onkeyup=e=>{this._keyStateC[this.registerKeyBoard(e.code)]=!1},document.body.onmousedown=e=>{let t=this._getMouseKey(e.button);this._keyStateC[this.registerKeyBoard(t)]=!0,this._mouseDowns.add(e.button);let r=this._mouseInfos[e.button];r&&r.coordC.set(e.x,e.y),document.body.onmousemove=e=>{let t;this._mouseDowns.forEach((r=>{t=this._mouseInfos[r],t&&t.coordC.set(e.x,e.y)}))}},document.body.onmouseup=e=>{let t=this._getMouseKey(e.button);this._keyStateC[this.registerKeyBoard(t)]=!1,this._mouseDowns.delete(e.button);let r=this._mouseInfos[e.button];r&&r.clear(),0===this._mouseDowns.size&&(document.body.onmousemove=null)},document.body.oncontextmenu=function(e){return!1}}registerKeyBoard(e){let t=this._keyMap.get(e);return void 0===t&&(t=this._keyID++,this._keyMap.set(e,t)),t}getKey(e){let t=this.registerKeyBoard(e);return this._keyStateA[t]&&this._keyStateB[t]}getKeyDown(e){let t=this.registerKeyBoard(e);return!this._keyStateA[t]&&this._keyStateB[t]}getKeyUp(e){let t=this.registerKeyBoard(e);return this._keyStateA[t]&&!this._keyStateB[t]}getMouseKey(e){let t=this.registerKeyBoard(this._getMouseKey(e));return this._keyStateA[t]&&this._keyStateB[t]}getMouseKeyDown(e){let t=this.registerKeyBoard(this._getMouseKey(e));return!this._keyStateA[t]&&this._keyStateB[t]}getMouseKeyUp(e){let t=this.registerKeyBoard(this._getMouseKey(e));return this._keyStateA[t]&&!this._keyStateB[t]}getMouseDrag(e){return this._mouseInfos[e]||null}swapKeyState(){let e=0,t=this._keyStateB.length;for(;e<t;e++)this._keyStateA[e]=this._keyStateB[e];for(e=0,t=this._keyStateC.length;e<t;e++)this._keyStateB[e]=this._keyStateC[e];if(0!==this._mouseDowns.size){let e;this._mouseDowns.forEach((t=>{e=this._mouseInfos[t],e&&e.follow()}))}}_getMouseKey(e){return 0===e?this._mouseLeftKey:1===e?this._mouseCenterKey:2===e?this._mouseRightKey:""}}t.InputManager=a;class n{constructor(){this.coordA=new s.Vector2,this.coordB=new s.Vector2,this.coordC=new s.Vector2}get offsetX(){return this.coordB.x-this.coordA.x}get offsetY(){return this.coordB.y-this.coordA.y}follow(){this.coordA.set(this.coordB.x,this.coordB.y),this.coordB.set(this.coordC.x,this.coordC.y)}clear(){this.coordA.set(0,0),this.coordB.set(0,0),this.coordC.set(0,0)}}},"./src/core/manager/Managers.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Managers=void 0;const s=r("./src/core/manager/AssetManager.ts"),a=r("./src/core/manager/ComponentManager.ts"),n=r("./src/core/manager/EventManager.ts"),i=r("./src/core/manager/InputManager.ts"),o=r("./src/core/manager/PoolManager.ts"),l=r("./src/core/manager/SceneManager.ts"),u=r("./src/core/manager/ShaderManager.ts"),_=r("./src/core/manager/TimerManager.ts");!function(e){e.Asset=s.AssetManager.ins(),e.Component=a.ComponentManager.ins(),e.Event=n.EventManager.ins(),e.Input=i.InputManager.ins(),e.Pool=o.PoolManager.ins(),e.Scene=l.SceneManager.ins(),e.Shader=u.ShaderManager.ins(),e.Timer=_.TimerManager.ins(),e.init=function(){}}(t.Managers||(t.Managers={}))},"./src/core/manager/PoolManager.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PoolManager=void 0;const s=r("./src/core/math/Euler.ts"),a=r("./src/core/math/Matrix3.ts"),n=r("./src/core/math/Matrix4.ts"),i=r("./src/core/math/Quaternion.ts"),o=r("./src/core/math/Vector2.ts"),l=r("./src/core/math/Vector3.ts"),u=r("./src/core/math/Vector4.ts"),_=r("./src/core/manager/pool/Pool.ts");class h{constructor(){this._poolMap=new Map,this._initInnerPools()}static ins(){return this._ins||(this._ins=new h),this._ins}get eulerPool(){return this._eulerPool}get mtx3Pool(){return this._mtx3Pool}get mtx4Pool(){return this._mtx4Pool}get quatPool(){return this._quatPool}get vec2Pool(){return this._vec2Pool}get vec3Pool(){return this._vec3Pool}get vec4Pool(){return this._vec4Pool}_initInnerPools(){this._eulerPool=new _.Pool("Euler",(()=>new s.Euler),{initCount:20,capacity:Number.MAX_VALUE,init:(e,t=0,r=0,s=0)=>{e.set(t,r,s)}}),this._mtx3Pool=new _.Pool("Matrix3",(()=>new a.Matrix3),{initCount:20,capacity:Number.MAX_VALUE,init:e=>{e.setIdentify()}}),this._mtx4Pool=new _.Pool("Matrix4",(()=>new n.Matrix4),{initCount:20,capacity:Number.MAX_VALUE,init:e=>{e.setIdentify()}}),this._quatPool=new _.Pool("Quaternion",(()=>new i.Quaternion),{initCount:20,capacity:Number.MAX_VALUE,init:(e,t=0,r=0,s=0,a=1)=>{e.set(t,r,s,a)}}),this._vec2Pool=new _.Pool("Vector2",(()=>new o.Vector2),{initCount:20,capacity:Number.MAX_VALUE,init:(e,t=0,r=0)=>{e.set(t,r)}}),this._vec3Pool=new _.Pool("Vector3",(()=>new l.Vector3),{initCount:20,capacity:Number.MAX_VALUE,init:(e,t=0,r=0,s=0,a=1)=>{e.set(t,r,s,a)}}),this._vec4Pool=new _.Pool("Vector4",(()=>new u.Vector4),{initCount:20,capacity:Number.MAX_VALUE,init:(e,t=0,r=0,s=0,a=1)=>{e.set(t,r,s,a)}}),this._poolMap.set(this._eulerPool.name,this._eulerPool),this._poolMap.set(this._mtx3Pool.name,this._mtx3Pool),this._poolMap.set(this._mtx4Pool.name,this._mtx4Pool),this._poolMap.set(this._quatPool.name,this._quatPool),this._poolMap.set(this._vec2Pool.name,this._vec2Pool),this._poolMap.set(this._vec3Pool.name,this._vec3Pool),this._poolMap.set(this._vec4Pool.name,this._vec4Pool)}addPool(e,t,r){if(this._poolMap.has(e))return console.warn("pool already existed..."),null;{let s=new _.Pool(e,t,r);return this._poolMap.set(e,s),s}}removePool(e){let t=this._poolMap.get(e);t&&(t.destroy(),this._poolMap.delete(e))}getPool(e){return this._poolMap.get(e)}get(e,...t){let r=this.getPool(e);return r?r.get(...t):null}put(e,t){let r=this.getPool(e);r&&r.put(t)}setCapacity(e,t){let r=this.getPool(e);r&&r.setCapacity(t)}clear(){this._poolMap.forEach((e=>{e.clear()})),this._poolMap.clear()}destroy(){this._poolMap.forEach((e=>{e.destroy()})),this._poolMap.clear()}}t.PoolManager=h},"./src/core/manager/SceneManager.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SceneManager=void 0;class r{constructor(){this._initProperty()}static ins(){return this._ins||(this._ins=new r),this._ins}get worldRoot(){return this._worldRoot}_initProperty(){this._worldRoot=null,this._handleQueue=new Set,this._sceneDirty=!1}registerHandleQueue(e){this._handleQueue.has(e)||this._handleQueue.add(e)}unregisterHandleQueue(e){this._handleQueue.delete(e)}getHandleQueue(e){var t;return(null===(t=this._worldRoot)||void 0===t?void 0:t.getHandleQueue(e))||[]}hasNeedUpdate(e){return this._sceneDirty}launchScene(e){if(this._worldRoot){if(this._worldRoot===e)return;this._exitScene(this._worldRoot)}this._worldRoot=e,e.setHandleQueue(Array.from(this._handleQueue))}updateScene(){this._sceneDirty=!!this._worldRoot&&this._worldRoot.update()}_exitScene(e){}}t.SceneManager=r},"./src/core/manager/ShaderManager.ts":function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderManager=void 0;const a=s(r("./src/core/asset/shader/source/Unlit.vs")),n=s(r("./src/core/asset/shader/source/Unlit.fs")),i=s(r("./src/core/asset/shader/source/SkySphere.vs")),o=s(r("./src/core/asset/shader/source/SkySphere.fs")),l=s(r("./src/core/asset/shader/source/SkyBox.vs")),u=s(r("./src/core/asset/shader/source/SkyBox.fs")),_=s(r("./src/core/asset/shader/source/BlinnPhong.vs")),h=s(r("./src/core/asset/shader/source/BlinnPhong.fs")),c=s(r("./src/core/asset/shader/source/PBR.vs")),d=s(r("./src/core/asset/shader/source/PBR.fs")),m=s(r("./src/core/asset/shader/source/MapToCube.vs")),g=s(r("./src/core/asset/shader/source/MapToCube.fs")),p=s(r("./src/core/asset/shader/source/Irradiance.vs")),f=s(r("./src/core/asset/shader/source/Irradiance.fs")),T=s(r("./src/core/asset/shader/source/Prefiltering.vs")),v=s(r("./src/core/asset/shader/source/Prefiltering.fs")),M=s(r("./src/core/asset/shader/source/BRDFLUT.vs")),E=s(r("./src/core/asset/shader/source/BRDFLUT.fs")),R=s(r("./src/core/asset/shader/source/postprocessing/BlitToQuad.vs")),C=s(r("./src/core/asset/shader/source/postprocessing/BlitToQuad.fs")),A=s(r("./src/core/asset/shader/source/postprocessing/ExtBright.fs")),x=s(r("./src/core/asset/shader/source/postprocessing/Blur.fs")),S=s(r("./src/core/asset/shader/source/postprocessing/Combine.fs")),y=s(r("./src/core/asset/shader/source/postprocessing/ToneMapping.fs")),P=r("./src/core/asset/shader/Define.ts"),L=r("./src/core/asset/shader/Shader.ts"),b=r("./src/core/common/BitOp.ts"),U=r("./src/core/common/Const.ts"),F=r("./src/core/asset/shader/UniformBlock.ts"),I=r("./src/core/asset/shader/UniformBlockGroup.ts"),O=r("./src/core/math/Matrix4.ts"),D=r("./src/core/math/Vector4.ts"),B=r("./src/core/math/Color.ts"),w=r("./src/core/asset/shader/blockuniform/BlockItem.ts"),N=r("./src/core/asset/shader/BlockUniform.ts"),G=r("./src/core/asset/shader/blockuniform/ParallelLightStruct.ts"),k=r("./src/core/asset/shader/blockuniform/PointLightStruct.ts"),V=r("./src/core/asset/shader/blockuniform/SpotLightStruct.ts"),X=r("./src/core/asset/shader/blockuniform/BlockGroup.ts");class H{constructor(){this._initProperty()}static ins(){return this._ins||(this._ins=new H),this._ins}get shaderDefineMap(){return this._shaderDefineMap}_initProperty(){this._shaderMap=new Map,this._shaderAttributeMap=new Map,this._shaderUniformMap=new Map,this._shaderUniformBlockMap=new Map,this._shaderDefineMap=new Map,this._shaderAttributeID=0,this._shaderUniformID=0,this._shaderUniformBlockID=0,this._shaderDefineID=0}initShader(){let e=this.addShader("UnlitShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position,U.Const.ATTRIBUTE_MAP.a_Normal,U.Const.ATTRIBUTE_MAP.a_Uv,U.Const.ATTRIBUTE_MAP.a_Color]),new Set([U.Const.UNIFORM_MAP.u_MvpMatrix,"u_MainTexture","u_TilingOffset","u_MainColor"]),[],!1);e.addPass(a.default,n.default),e=this.addShader("BlinnPhongShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position,U.Const.ATTRIBUTE_MAP.a_Normal,U.Const.ATTRIBUTE_MAP.a_Uv,U.Const.ATTRIBUTE_MAP.a_Color]),new Set([U.Const.UNIFORM_MAP.u_MvpMatrix,U.Const.UNIFORM_MAP.u_ModelMatrix,U.Const.UNIFORM_MAP.u_NormalMatrix,"u_MainColor","u_DiffuseTexture","u_SpecularTexture","u_Shininess","u_TilingOffset"]),[U.Const.UBO_MAP.SceneBlock,U.Const.UBO_MAP.CameraBlock,U.Const.UBO_MAP.LightBlock],!1),e.addPass(_.default,h.default),e=this.addShader("PBRShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position,U.Const.ATTRIBUTE_MAP.a_Normal,U.Const.ATTRIBUTE_MAP.a_Uv,U.Const.ATTRIBUTE_MAP.a_Color]),new Set([U.Const.UNIFORM_MAP.u_MvpMatrix,U.Const.UNIFORM_MAP.u_ModelMatrix,U.Const.UNIFORM_MAP.u_NormalMatrix,U.Const.UNIFORM_MAP.u_EnvLightMap,U.Const.UNIFORM_MAP.u_EnvRefMap,U.Const.UNIFORM_MAP.u_EnvBRDFLUTMap,"u_AlbedoTexture","u_NormalTexture","u_MetallicTexture","u_RoughnessTexture","u_AoTexture","u_EmissiveTexture","u_Albedo","u_Metallic","u_Roughness","u_Ao","u_Emissive","u_EmissiveIntensity"]),[U.Const.UBO_MAP.SceneBlock,U.Const.UBO_MAP.CameraBlock,U.Const.UBO_MAP.LightBlock],!1),e.addPass(c.default,d.default),e=this.addShader("SkyBoxShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position]),new Set([U.Const.UNIFORM_MAP.u_MvpMatrix,"u_EquirectangularMap","u_CubeMap","u_Exposure"]),[],!1),e.addPass(l.default,u.default),e=this.addShader("SkySphereShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position]),new Set([U.Const.UNIFORM_MAP.u_MvpMatrix,"u_SumYawPitchRadius","u_SumColor","u_SumHaloAndThickness","u_SkyColor","u_GroundColor","u_SkylineColorAndThickness","u_Exposure"]),[],!1),e.addPass(i.default,o.default),e=this.addShader("MapToCubeShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position]),new Set([U.Const.UNIFORM_MAP.u_MvpMatrix,"u_EquirectangularMap","u_CubeMap"]),[],!1),e.addPass(m.default,g.default),e=this.addShader("IrradianceShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position]),new Set([U.Const.UNIFORM_MAP.u_MvpMatrix,"u_EnvTexture"]),[],!1),e.addPass(p.default,f.default),e=this.addShader("PrefilteringShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position]),new Set([U.Const.UNIFORM_MAP.u_MvpMatrix,"u_EnvTexture","u_Roughness"]),[],!1),e.addPass(T.default,v.default),e=this.addShader("BRDFLUTShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position,U.Const.ATTRIBUTE_MAP.a_Uv]),new Set,[],!1),e.addPass(M.default,E.default),e=this.addShader("BlitToQuadShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position,U.Const.ATTRIBUTE_MAP.a_Uv]),new Set([U.Const.UNIFORM_MAP.u_SourceMap]),[],!1),e.addPass(R.default,C.default),e=this.addShader("ExtBrightShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position,U.Const.ATTRIBUTE_MAP.a_Uv]),new Set([U.Const.UNIFORM_MAP.u_SourceMap,"u_Threshold"]),[],!1),e.addPass(R.default,A.default),e=this.addShader("BlurShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position,U.Const.ATTRIBUTE_MAP.a_Uv]),new Set([U.Const.UNIFORM_MAP.u_SourceMap,"u_TexelOffset"]),[],!1),e.addPass(R.default,x.default),e=this.addShader("CombineShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position,U.Const.ATTRIBUTE_MAP.a_Uv]),new Set([U.Const.UNIFORM_MAP.u_SourceMap,"u_OverlayMap"]),[],!1),e.addPass(R.default,S.default),e=this.addShader("ToneMappingShader",new Set([U.Const.ATTRIBUTE_MAP.a_Position,U.Const.ATTRIBUTE_MAP.a_Uv]),new Set([U.Const.UNIFORM_MAP.u_SourceMap,"u_Exposure","u_Gamma"]),[],!1),e.addPass(R.default,y.default)}initUniformBlock(e){let t=this.registerUniformBlock(U.Const.UBO_MAP.CameraBlock);t.addUniform(new N.BlockUniform("u_ViewMatrix",new w.BlockItem(null,U.Const.GL_TYPE.MATRIX4,new O.Matrix4))),t.addUniform(new N.BlockUniform("u_ProjectMatrix",new w.BlockItem(null,U.Const.GL_TYPE.MATRIX4,new O.Matrix4))),t.addUniform(new N.BlockUniform("u_ViewProjectMatrix",new w.BlockItem(null,U.Const.GL_TYPE.MATRIX4,new O.Matrix4))),t.addUniform(new N.BlockUniform("u_ProjectParams",new w.BlockItem(null,U.Const.GL_TYPE.FLOAT4,new D.Vector4))),t.addUniform(new N.BlockUniform("u_Viewport",new w.BlockItem(null,U.Const.GL_TYPE.FLOAT4,new D.Vector4))),t.addUniform(new N.BlockUniform("u_CameraPosition",new w.BlockItem(null,U.Const.GL_TYPE.FLOAT4,new D.Vector4))),t.addUniform(new N.BlockUniform("u_CameraDirection",new w.BlockItem(null,U.Const.GL_TYPE.FLOAT4,new D.Vector4))),t.addUniform(new N.BlockUniform("u_CameraUp",new w.BlockItem(null,U.Const.GL_TYPE.FLOAT4,new D.Vector4)));let r=this.registerUniformBlock(U.Const.UBO_MAP.SceneBlock);r.addUniform(new N.BlockUniform("u_Time",new w.BlockItem(null,U.Const.GL_TYPE.FLOAT,0))),r.addUniform(new N.BlockUniform("u_FogStart",new w.BlockItem(null,U.Const.GL_TYPE.FLOAT,0))),r.addUniform(new N.BlockUniform("u_FogRange",new w.BlockItem(null,U.Const.GL_TYPE.FLOAT,0))),r.addUniform(new N.BlockUniform("u_FogColor",new w.BlockItem(null,U.Const.GL_TYPE.FLOAT4,new B.Color))),r.addUniform(new N.BlockUniform("u_EnvColorAndIntensity",new w.BlockItem(null,U.Const.GL_TYPE.FLOAT4,new D.Vector4)));let s=this.registerUniformBlock(U.Const.UBO_MAP.LightBlock);s.addUniform(new N.BlockUniform("u_LightCounts",new w.BlockItem(null,U.Const.GL_TYPE.FLOAT4,new D.Vector4))),s.addUniform(new N.BlockUniform("u_ParallelLights",new X.BlockGroup([new G.ParallelLightStruct,new G.ParallelLightStruct]))),s.addUniform(new N.BlockUniform("u_PointLights",new X.BlockGroup([new k.PointLightStruct,new k.PointLightStruct,new k.PointLightStruct,new k.PointLightStruct]))),s.addUniform(new N.BlockUniform("u_SpotLights",new X.BlockGroup([new V.SpotLightStruct,new V.SpotLightStruct,new V.SpotLightStruct,new V.SpotLightStruct])));this.registerUniformBlock(U.Const.UBO_MAP.ShadowBlock);t.setUp(e),r.setUp(e),s.setUp(e)}addShader(e,t,r,s=null,a=!1){if(this._shaderMap.has(e))return console.warn("shader name is already existed!"),null;let n=new I.UniformBlockGroup;if(s&&0!==s.length)for(let e=0,t=s.length;e<t;e++)n.addUniformBlock(this.findUniformBlock(s[e]));let i=new L.Shader(e,t,r,n,a);return this._shaderMap.set(e,i),i}findShader(e){return this._shaderMap.get(e)||null}findAttribute(e){return this._shaderAttributeMap.get(e)}findUniform(e){return this._shaderUniformMap.get(e)}findUniformBlock(e){return this._shaderUniformBlockMap.get(e)||null}registerAttribute(e){if(this._shaderAttributeMap.has(e))return this._shaderAttributeMap.get(e);{let t=this._shaderAttributeID++;return this._shaderAttributeMap.set(e,t),this._shaderAttributeMap.set(t,e),t}}registerUniform(e){if(this._shaderUniformMap.has(e))return this._shaderUniformMap.get(e);{let t=this._shaderUniformID++;return this._shaderUniformMap.set(e,t),this._shaderUniformMap.set(t,e),t}}registerUniformBlock(e){if(this._shaderUniformBlockMap.has(e))return this._shaderUniformBlockMap.get(e);{let t=this._shaderUniformBlockID++,r=new F.UniformBlock(t,e);return this._shaderUniformBlockMap.set(t,r),this._shaderUniformBlockMap.set(e,r),r}}registerDefine(e){if(this._shaderDefineMap.has(e))return this._shaderDefineMap.get(e);{let t=this._shaderDefineID++,r=new P.Define(t,e,new b.BitOp);return r.flag.setBit(t,!0),this._shaderDefineMap.set(t,r),this._shaderDefineMap.set(e,r),r}}}t.ShaderManager=H},"./src/core/manager/TimerManager.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimerManager=void 0;const s=r("./src/core/common/Handler.ts"),a=r("./src/core/common/Timer.ts");class n{constructor(){this._timers=new Array,this._lastTime=0,this._curFrame=0,this._tickFuc=this._tick.bind(this)}static ins(){return this._ins||(this._ins=new n),this._ins}get curTime(){return this._lastTime}start(){this._tickFuc(-1)}stop(){}continue(){}registerTimer(e,t,r,n,i,o=!0,l=!1){let u,_=this.hasTimer(e,t,o);-1===_?(u=new a.Timer(e,t,o),this._timers.push(u)):u=this._timers[_];let h=s.Handler.get(n,r,...i);u.addHandler(h,l)}hasTimer(e,t,r){let s;for(let a=0,n=this._timers.length;a<n;a++)if(s=this._timers[a],s.delay===e&&s.delta===t&&s.baseFrame===r)return a;return-1}_tick(e){requestAnimationFrame(this._tickFuc);let t=.001*(0===this._lastTime?0:e-this._lastTime);for(let e=0,r=this._timers.length;e<r;e++)this._timers[e]._tick(t);this._curFrame++,this._lastTime=e}}t.TimerManager=n},"./src/core/manager/loader/BitMapLoader.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitMapLoader=void 0;const s=r("./src/core/asset/texture/BitMap.ts"),a=r("./src/core/common/container/TBuffer.ts"),n=r("./src/core/manager/loader/Loader.ts"),i=r("./src/core/manager/loader/parser/RGBEParser.ts");new Set([".png",".jpg",".hdr"]);class o extends n.Loader{constructor(e){super(e),this._rgbeParser=new i.RGBEParser}load(e,t){let r=this._manager,a=this._manager.urlCacheMap,n=t.args?t.args:[],i=e+"/bitmap",o=a.get(i);if(o)t.onLoad(o,...n);else{switch(e.match(/.[^.]+$/)[0].toLowerCase()){case".png":case".jpg":let a=new Image;a.onload=e=>{o=new s.BitMap(a,a.width,a.height),r.cacheAsset(i,o),t.onLoad(o,...n),a.onload=null,a.onerror=null},a.onerror=e=>{var r;null===(r=t.onError)||void 0===r||r.call(t,e,...n),a.onload=null,a.onerror=null},a.src=e;break;case".hdr":r.loadFile(e,"arraybuffer",{onLoad:(e,...s)=>{let a=this.parseHDR(e);r.cacheAsset(i,a),t.onLoad(a,...s)},onProgress:t.onProgress,onError:t.onError,args:t.args})}}}parseHDR(e){let t=this._rgbeParser.parse(e),r=new a.TBuffer(t.data,Number.MAX_VALUE,!1);return new s.BitMap(r,t.width,t.height)}}t.BitMapLoader=o},"./src/core/manager/loader/CubeTextureLoader.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CubeTextureLoader=void 0;const s=r("./src/core/asset/texture/CubeTexture.ts"),a=r("./src/core/common/Const.ts"),n=r("./src/core/manager/loader/Loader.ts");class i extends n.Loader{load(e,t){let r=this._manager,n=this._manager.urlCacheMap,i=t.args?t.args:[],o=e.lastIndexOf(".");if(-1===o)return void console.warn(`路径格式出错：${e}`);let l=e.substring(0,o),u=e.substring(o).toLowerCase(),_=l+u+"/cubetexture",h=n.get(_);if(h)t.onLoad(h,...i);else{let e=new Array,n=6,o=0,c=(a,l)=>{if(o++,e[l]=a,o===n){h=new s.CubeTexture(e),this._initTexture(h),r.cacheAsset(_,h);for(let t=0;t<n;t++)h._addRef(e[t].uuid),e[t]._addBeRef(h.uuid);t.onLoad(h,...i)}},d=r=>{var s;e.length=0,null===(s=t.onError)||void 0===s||s.call(t,r,...i)},m=["/px"+u,"/nx"+u,"/py"+u,"/ny"+u,"/pz"+u,"/nz"+u];for(let e=0,t=m.length;e<t;e++)this._manager.load(l+m[e],a.Const.ASSET_TYPE.BITMAP,{onLoad:c,onError:d,args:[e]})}}_initTexture(e){if(e.isDataTexture){let t=e.source[0].source;t.type===a.Const.TYPE_ARRAY.Uint16?(e.useMipmap=!1,e.minFilter=a.Const.TEX_FILTER.LINEAR,e.magFilter=a.Const.TEX_FILTER.LINEAR,e.internalFormat=a.Const.TEX_INTERNAL_FORMAT.RGBA16F,e.format=a.Const.TEX_FORMAT.RGBA,e.dataType=a.Const.TEX_DATA_TYPE.HALF_FLOAT):t.type===a.Const.TYPE_ARRAY.Float32&&(e.useMipmap=!1,e.minFilter=a.Const.TEX_FILTER.LINEAR,e.magFilter=a.Const.TEX_FILTER.LINEAR,e.internalFormat=a.Const.TEX_INTERNAL_FORMAT.RGBA32F,e.format=a.Const.TEX_FORMAT.RGBA,e.dataType=a.Const.TEX_DATA_TYPE.FLOAT)}}}t.CubeTextureLoader=i},"./src/core/manager/loader/FileLoader.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileLoader=void 0;const s=r("./src/core/manager/loader/Loader.ts");class a extends Error{constructor(e,t){super(e),this.response=t}}class n extends s.Loader{load(e,t,r){let s=this._manager,n=s.urlCacheMap,i=r.args?r.args:[],o=e+"/"+t,l=n.get(o);if(l)r.onLoad(l,...i);else{let n,l=new Request(e,{headers:new Headers(s.requestHeader),credentials:s.withCredentials?"include":"same-origin"});fetch(l).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const t=e.body.getReader(),s=e.headers.get("Content-Length"),a=s?parseInt(s):0,n=0!==a;let i=0;const o=new ReadableStream({start(e){!function s(){t.read().then((({done:t,value:o})=>{var l;if(t)e.close();else{i+=o.byteLength;const t=new ProgressEvent("progress",{lengthComputable:n,loaded:i,total:a});null===(l=r.onProgress)||void 0===l||l.call(r,t),e.enqueue(o),s()}}))}()}});return new Response(o)}throw new a(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((e=>{switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,n)));case"json":return e.json();default:if(void 0===n)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(n),r=t&&t[1]?t[1].toLowerCase():void 0,s=new TextDecoder(r);return e.arrayBuffer().then((e=>s.decode(e)))}}})).then((e=>{s.cacheAsset(o,e),r.onLoad(e,...i)})).catch((e=>{var t;null===(t=r.onError)||void 0===t||t.call(r,e,...i)})).finally((()=>{}))}}}t.FileLoader=n},"./src/core/manager/loader/GLTFLoader.ts":function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(a,n){function i(e){try{l(s.next(e))}catch(e){n(e)}}function o(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.GLTFLoader=void 0;const a=r("./src/core/gameobject/Scene.ts"),n=r("./src/core/manager/loader/Loader.ts"),i=r("./src/core/manager/loader/parser/GLBParser.ts"),o=r("./src/core/common/Const.ts"),l=r("./src/core/gameobject/GameObject.ts"),u=r("./src/core/asset/primitive/Mesh.ts"),_=r("./src/core/common/container/TBuffer.ts"),h=r("./src/core/component/MeshFilter.ts"),c=r("./src/core/component/MeshRenderer.ts"),d=r("./src/core/common/container/VertexBuffer.ts"),m=r("./src/core/asset/material/PBRMaterial.ts"),g=r("./src/core/math/Matrix4.ts"),p=new Map([["SCALAR",1],["VEC2",2],["VEC3",3],["VEC4",4],["MAT2",4],["MAT3",9],["MAT4",16]]),f=new Map([[WebGL2RenderingContext.BYTE,Int8Array],[WebGL2RenderingContext.UNSIGNED_BYTE,Uint8Array],[WebGL2RenderingContext.SHORT,Int16Array],[WebGL2RenderingContext.UNSIGNED_SHORT,Uint16Array],[WebGL2RenderingContext.INT,Int32Array],[WebGL2RenderingContext.UNSIGNED_INT,Uint32Array],[WebGL2RenderingContext.FLOAT,Float32Array]]);class T extends n.Loader{constructor(e){super(e),this._glbParser=new i.GLBParser}load(e,t){let r=this._manager,a=".glb"==e.match(/.[^.]+$/)[0].toLowerCase();r.loadFile(e,a?"arraybuffer":"json",{onLoad:(r,...n)=>s(this,void 0,void 0,(function*(){let s,i=new Array,o=new Array;if(a){let e=this._glbParser.parse(r);s=e.jsonObject,i=e.buffers}else s=r;s.basePath=e.substring(0,e.lastIndexOf("/")+1),yield this._parserGLTF(s,i,o),s.realBuffers=i,s.realTextures=o,s.realMeshes=[],s.realMaterial=[];let l=this._parserScenes(s);t.onLoad(l,...n)})),onProgress:t.onProgress,onError:t.onError,args:t.args})}_parserGLTF(e,t,r){return s(this,void 0,void 0,(function*(){let s=void 0!==t&&void 0!==t[0];s||(yield this._loadBufferFromUri(e,t)),s?this._loadTextureFromBufferView(e,r):yield this._loadTextureFromUri(e,r)}))}_loadBufferFromUri(e,t){return s(this,void 0,void 0,(function*(){let r,s,a=this._manager,n=e.buffers,i=new Array;for(let t=0,l=n.length;t<l;t++)r=n[t],s=r.uri,-1!==s.indexOf("base64,")||i.push(a.loadAsync(e.basePath+s,o.Const.ASSET_TYPE.ARRAY_BUFFER));0!==i.length&&(yield Promise.all(i).then((e=>{t.push(...e)})))}))}_loadTextureFromBufferView(e,t){}_loadTextureFromUri(e,t){return s(this,void 0,void 0,(function*(){let r,s,a=this._manager,n=e.images,i=e.textures,l=new Array;for(let t=0,u=i.length;t<u;t++)r=i[t],s=n[r.source].uri,-1!==s.indexOf("base64,")||l.push(a.loadAsync(e.basePath+s,o.Const.ASSET_TYPE.TEXTURE));0!==l.length&&(yield Promise.all(l).then((e=>{t.push(...e)})))}))}_parserScenes(e){let t=new Array;for(let r=0,s=e.scenes.length;r<s;r++)t.push(this._parserScene(e,r));return t}_parserScene(e,t){let r=e.scenes[t],s=new a.Scene(r.name);for(let t=0;t<r.nodes.length;t++){let a=this._parserNode(e,r.nodes[t]);s.addChild(a)}return s}_parserNode(e,t){let r=e.nodes[t],s=new l.GameObject(r.name);if(void 0!==r.matrix)s.transform.setTransformByMatrix(new g.Matrix4(r.matrix));else{if(void 0!==r.translation){let e=s.transform.localPosition.set(r.translation[0],r.translation[1],r.translation[2]);s.transform.localPosition=e}if(void 0!==r.rotation){let e=s.transform.localRotation.set(r.rotation[0],r.rotation[1],r.rotation[2],r.rotation[3]);s.transform.localRotation=e}if(void 0!==r.scale){let e=s.transform.localScale.set(r.scale[0],r.scale[1],r.scale[2]);s.transform.localScale=e}}if(void 0!==r.mesh){let t=this._parserMesh(e,r.mesh),a=this._parserMaterials(e,r.mesh),n=s.addComponent(h.MeshFilter),i=s.addComponent(c.MeshRenderer);n.mesh=t,i.materials=a}if(r.children){let t;for(let a=0,n=r.children.length;a<n;a++)t=this._parserNode(e,r.children[a]),s.addChild(t)}return s}_parserMesh(e,t){if(e.realMeshes[t])return e.realMeshes[t];let r=e.meshes[t].primitives,s=0,a=0,n=new Array;for(let t=0,i=r.length;t<i;t++){let i={};void 0!==r[t].attributes.POSITION&&(i.attribNames=[o.Const.ATTRIBUTE_MAP.a_Position],i.attribSizes=[this._getComponentCount(e.accessors[r[t].attributes.POSITION].type)],i.attribBuffers=[this._parserAccessor(e,r[t].attributes.POSITION)]),void 0!==r[t].attributes.NORMAL&&(i.attribNames.push(o.Const.ATTRIBUTE_MAP.a_Normal),i.attribSizes.push(this._getComponentCount(e.accessors[r[t].attributes.NORMAL].type)),i.attribBuffers.push(this._parserAccessor(e,r[t].attributes.NORMAL))),void 0!==r[t].attributes.TEXCOORD_0&&(i.attribNames.push(o.Const.ATTRIBUTE_MAP.a_Uv),i.attribSizes.push(this._getComponentCount(e.accessors[r[t].attributes.TEXCOORD_0].type)),i.attribBuffers.push(this._parserAccessor(e,r[t].attributes.TEXCOORD_0))),i.indexes=this._parserAccessor(e,r[t].indices),i.vertexCount=i.attribBuffers[0].length/i.attribSizes[0],n.push(i),s+=i.vertexCount,a+=i.indexes.length}if(n.length>1){let e,t=new Array,r=0;for(let i=0,o=n.length;i<o;i++)if(e=n[i],0===i){let n;for(let r=0,a=e.attribBuffers.length;r<a;r++)t[r]=e.attribBuffers[r].length,n=new e.attribBuffers[r].constructor(e.attribSizes[r]*s),n.set(e.attribBuffers[r],0),e.attribBuffers[r]=n;e.drawOffset=0,e.drawCount=e.indexes.length,r=e.indexes.length,n=new e.indexes.constructor(a),n.set(e.indexes,0),e.indexes=n}else{for(let r=0,s=e.attribBuffers.length;r<s;r++)n[0].attribBuffers[r].set(e.attribBuffers[r],t[r]),t[r]+=e.attribBuffers[r].length;e.drawOffset=r,e.drawCount=e.indexes.length,n[0].indexes.set(e.indexes,r),r+=e.indexes.length}}let i=new d.VertexBuffer(n[0].attribNames,n[0].attribSizes,s),l=new _.TBuffer(n[0].indexes,n[0].indexes.length,!1),h=new u.Mesh(i,l);for(let e=0,t=n[0].attribNames.length;e<t;e++)i.setAttribute(n[0].attribNames[e],n[0].attribBuffers[e]);for(let e=0,t=n.length;e<t;e++)h.split(n[e].drawOffset,n[e].drawCount);return e.realMeshes[t]=h,h}_parserAccessor(e,t){let r=e.accessors[t],s=e.bufferViews[r.bufferView],a=e.realBuffers[s.buffer],n=(this._getComponentSize(r.componentType),this._getComponentCount(r.type)),i=r.count*n;return new(f.get(r.componentType)||Uint8Array)(a,s.byteOffset,i)}_getComponentSize(e){switch(e){case WebGL2RenderingContext.BYTE:case WebGL2RenderingContext.UNSIGNED_BYTE:return 1;case WebGL2RenderingContext.SHORT:case WebGL2RenderingContext.UNSIGNED_SHORT:return 2;case WebGL2RenderingContext.UNSIGNED_INT:case WebGL2RenderingContext.FLOAT:return 4;default:return 0}}_getComponentCount(e){return p.get(e)||0}_parserMaterials(e,t){let r=e.meshes[t].primitives,s=new Array;for(let t=0,a=r.length;t<a;t++)s.push(this._parserMaterial(e,r[t].material));return s}_parserMaterial(e,t){if(e.realMaterial[t])return e.realMaterial[t];let r=e.materials[t],s=new m.PBRMaterial;if(void 0!==r.normalTexture&&(s.normalTexture=e.realTextures[r.normalTexture.index],s.normalTexture.wrapS=o.Const.TEX_WRAP.REPEAT,s.normalTexture.wrapT=o.Const.TEX_WRAP.REPEAT,s.normalTexture.flipY=!1),void 0!==r.occlusionTexture&&(s.aoTexture=e.realTextures[r.occlusionTexture.index],s.aoTexture.wrapS=o.Const.TEX_WRAP.REPEAT,s.aoTexture.wrapT=o.Const.TEX_WRAP.REPEAT,s.aoTexture.flipY=!1),void 0!==r.emissiveTexture&&(s.emissiveTexture=e.realTextures[r.emissiveTexture.index],s.emissiveTexture.wrapS=o.Const.TEX_WRAP.REPEAT,s.emissiveTexture.wrapT=o.Const.TEX_WRAP.REPEAT,s.emissiveTexture.flipY=!1),void 0!==r.pbrMetallicRoughness){let t=r.pbrMetallicRoughness;void 0!==t.baseColorFactor&&s.albedo.set(t.baseColorFactor[0],t.baseColorFactor[1],t.baseColorFactor[2],t.baseColorFactor[3]),void 0!==t.metallicFactor&&(s.metallic=t.metallicFactor),void 0!==t.roughnessFactor&&(s.metallic=t.roughnessFactor),void 0!==t.baseColorTexture&&(s.albedoTexture=e.realTextures[t.baseColorTexture.index],s.albedoTexture.wrapS=o.Const.TEX_WRAP.REPEAT,s.albedoTexture.wrapT=o.Const.TEX_WRAP.REPEAT,s.albedoTexture.flipY=!1),void 0!==t.metallicRoughnessTexture&&(s.metallicTexture=e.realTextures[t.metallicRoughnessTexture.index],s.roughnessTexture=e.realTextures[t.metallicRoughnessTexture.index],s.metallicTexture.wrapS=o.Const.TEX_WRAP.REPEAT,s.metallicTexture.wrapT=o.Const.TEX_WRAP.REPEAT,s.metallicTexture.flipY=!1)}return e.realMaterial[t]=s,s}}t.GLTFLoader=T},"./src/core/manager/loader/Loader.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Loader=void 0;t.Loader=class{constructor(e){this._manager=e}}},"./src/core/manager/loader/TextureLoader.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureLoader=void 0;const s=r("./src/core/asset/texture/Texture.ts"),a=r("./src/core/common/Const.ts"),n=r("./src/core/manager/loader/Loader.ts");class i extends n.Loader{load(e,t){let r=this._manager,n=this._manager.urlCacheMap,i=t.args?t.args:[],o=e+"/texture",l=n.get(o);l?t.onLoad(l,...i):this._manager.load(e,a.Const.ASSET_TYPE.BITMAP,{onLoad:(e,...a)=>{l=new s.Texture(e),this._initTexture(l),r.cacheAsset(o,l),l._addRef(e.uuid),e._addBeRef(l.uuid),t.onLoad(l,...a)},onError:t.onError,args:t.args})}_initTexture(e){if(e.isDataTexture){let t=e.source.source;t.type===a.Const.TYPE_ARRAY.Uint16?(e.useMipmap=!1,e.minFilter=a.Const.TEX_FILTER.LINEAR,e.magFilter=a.Const.TEX_FILTER.LINEAR,e.internalFormat=a.Const.TEX_INTERNAL_FORMAT.RGBA16F,e.format=a.Const.TEX_FORMAT.RGBA,e.dataType=a.Const.TEX_DATA_TYPE.HALF_FLOAT):t.type===a.Const.TYPE_ARRAY.Float32&&(e.useMipmap=!1,e.minFilter=a.Const.TEX_FILTER.LINEAR,e.magFilter=a.Const.TEX_FILTER.LINEAR,e.internalFormat=a.Const.TEX_INTERNAL_FORMAT.RGBA32F,e.format=a.Const.TEX_FORMAT.RGBA,e.dataType=a.Const.TEX_DATA_TYPE.FLOAT)}}}t.TextureLoader=i},"./src/core/manager/loader/parser/GLBParser.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLBParser=void 0;t.GLBParser=class{constructor(){this._glbHeaderInts=3,this._glbChunkHeaderInts=2,this._glbMagic=1179937895,this._glbVersion=2,this._jsonChunkType=1313821514,this._binaryChunkType=5130562}parse(e){if(void 0===this._getCheckedGlbInfo(e))return;let t,r=[];const s=this._getAllChunkInfos(e);for(let a of s)a.type!=this._jsonChunkType||t?a.type==this._binaryChunkType&&r.push(this._getBufferFromChunk(e,a)):t=this._getJsonFromChunk(e,a);return{jsonObject:t,buffers:r}}_getCheckedGlbInfo(e){const t=new Uint32Array(e,0,this._glbHeaderInts),r=t[0],s=t[1],a=t[2];if(this._checkEquality(r,this._glbMagic,"glb magic")&&this._checkEquality(s,this._glbVersion,"glb header version")&&this._checkEquality(a,e.byteLength,"glb byte length"))return{magic:r,version:s,length:a}}_getAllChunkInfos(e){let t=[],r=4*this._glbHeaderInts;for(;r<e.byteLength;){const s=this._getChunkInfo(e,r);t.push(s),r+=s.length+4*this._glbChunkHeaderInts}return t}_getChunkInfo(e,t){const r=new Uint32Array(e,t,this._glbChunkHeaderInts);return{start:t+4*this._glbChunkHeaderInts,length:r[0],type:r[1]}}_getJsonFromChunk(e,t){const r=t.length,s=4*(this._glbHeaderInts+this._glbChunkHeaderInts),a=new Uint8Array(e,s,r),n=new TextDecoder("utf-8").decode(a);return JSON.parse(n)}_getBufferFromChunk(e,t){return e.slice(t.start,t.start+t.length)}_checkEquality(e,t,r){return e==t||(console.error("Found invalid/unsupported "+r+", expected: "+t+", but was: "+e),!1)}}},"./src/core/manager/loader/parser/RGBEParser.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RGBEParser=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/util/Utils.ts");t.RGBEParser=class{parse(e,t=s.Const.FLOAT_TYPE.FloatType,r=7){const n=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},i=function(e,t,r){t=t||1024;let s=e.pos,a=-1,n=0,i="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));for(;0>(a=o.indexOf("\n"))&&n<t&&s<e.byteLength;)i+=o,n+=o.length,s+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));return-1<a&&(!1!==r&&(e.pos+=n+a+1),i+o.slice(0,a))},o=function(e,t,r,s){const a=e[t+3],n=Math.pow(2,a-128)/255;r[s+0]=e[t+0]*n,r[s+1]=e[t+1]*n,r[s+2]=e[t+2]*n,r[s+3]=1},l=function(e,t,r,s){const n=e[t+3],i=Math.pow(2,n-128)/255;r[s+0]=a.Utils.Data.toHalfFloat(Math.min(e[t+0]*i,65504)),r[s+1]=a.Utils.Data.toHalfFloat(Math.min(e[t+1]*i,65504)),r[s+2]=a.Utils.Data.toHalfFloat(Math.min(e[t+2]*i,65504)),r[s+3]=a.Utils.Data.toHalfFloat(1)},u=new Uint8Array(e);u.pos=0;const _=function(e){const t=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,u;if(e.pos>=e.byteLength||!(l=i(e)))return n(1,"no header found");if(!(u=l.match(/^#\?(\S+)/)))return n(3,"bad initial token");for(o.valid|=1,o.programtype=u[1],o.string+=l+"\n";l=i(e),!1!==l;)if(o.string+=l+"\n","#"!==l.charAt(0)){if((u=l.match(t))&&(o.gamma=parseFloat(u[1])),(u=l.match(r))&&(o.exposure=parseFloat(u[1])),(u=l.match(s))&&(o.valid|=2,o.format=u[1]),(u=l.match(a))&&(o.valid|=4,o.height=parseInt(u[1],10),o.width=parseInt(u[2],10)),2&o.valid&&4&o.valid)break}else o.comments+=l+"\n";return 2&o.valid?4&o.valid?o:n(3,"missing image size specifier"):n(3,"missing format specifier")}(u);if(-1!==_){const e=_.width,r=_.height,a=function(e,t,r){const s=t;if(s<8||s>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(s!==(e[2]<<8|e[3]))return n(3,"wrong scanline width");const a=new Uint8Array(4*t*r);if(!a.length)return n(4,"unable to allocate buffer space");let i=0,o=0;const l=4*s,u=new Uint8Array(4),_=new Uint8Array(l);let h=r;for(;h>0&&o<e.byteLength;){if(o+4>e.byteLength)return n(1);if(u[0]=e[o++],u[1]=e[o++],u[2]=e[o++],u[3]=e[o++],2!=u[0]||2!=u[1]||(u[2]<<8|u[3])!=s)return n(3,"bad rgbe scanline format");let t,r=0;for(;r<l&&o<e.byteLength;){t=e[o++];const s=t>128;if(s&&(t-=128),0===t||r+t>l)return n(3,"bad scanline data");if(s){const s=e[o++];for(let e=0;e<t;e++)_[r++]=s}else _.set(e.subarray(o,o+t),r),r+=t,o+=t}const c=s;for(let e=0;e<c;e++){let t=0;a[i]=_[e+t],t+=s,a[i+1]=_[e+t],t+=s,a[i+2]=_[e+t],t+=s,a[i+3]=_[e+t],i+=4}h--}return a}(u.subarray(u.pos),e,r);if(-1!==a){let n,i,u;switch(t){case s.Const.FLOAT_TYPE.FloatType:u=a.length/4;const e=new Float32Array(4*u);for(let t=0;t<u;t++)o(a,4*t,e,4*t);n=e,i=s.Const.FLOAT_TYPE.FloatType;break;case s.Const.FLOAT_TYPE.HalfFloatType:u=a.length/4;const r=new Uint16Array(4*u);for(let e=0;e<u;e++)l(a,4*e,r,4*e);n=r,i=s.Const.FLOAT_TYPE.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",t)}return{width:e,height:r,data:n,header:_.string,gamma:_.gamma,exposure:_.exposure,type:i}}}return null}}},"./src/core/manager/pool/Pool.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pool=void 0;t.Pool=class{constructor(e,t,r){this._name=e,this._capacity=(null==r?void 0:r.capacity)?r.capacity:Number.MAX_VALUE,this._list=new Array,this._creator=t,this._init=null==r?void 0:r.init,this._reset=null==r?void 0:r.reset;const s=(null==r?void 0:r.initCount)?r.initCount:10;this._initPool(s)}get name(){return this._name}_initPool(e){let t;for(let r=0;r<e;r++)t=this._creator(),this._list.push(t)}put(e){var t,r;if(!(this._list.length>this._capacity))if(Array.isArray(e)){for(let r=0,s=e.length;r<s&&(null===(t=this._reset)||void 0===t||t.call(this,e[r]),this._list.push(e[r]),!(this._list.length>this._capacity));r++);e.length=0}else null===(r=this._reset)||void 0===r||r.call(this,e),this._list.push(e)}get(...e){var t;let r=this._list.pop();return r||(r=this._creator()),null===(t=this._init)||void 0===t||t.call(this,r,...e),r}setCapacity(e){this._capacity=e,this._list.splice(e)}clear(){this._list.length=0}destroy(){this.clear(),this._list=null,this._creator=null,this._init=null}}},"./src/core/math/Color.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0;class r{constructor(e=1,t=1,r=1,s=1){this._value=new Float32Array([e,t,r,s])}get r(){return this._value[0]}set r(e){this._value[0]=e}get g(){return this._value[1]}set g(e){this._value[1]=e}get b(){return this._value[2]}set b(e){this._value[2]=e}get a(){return this._value[3]}set a(e){this._value[3]=e}get value(){return this._value}set(e,t,r,s){return this._value[0]=e,this._value[1]=t,this._value[2]=r,void 0!==s&&(this._value[3]=s),this}copyFrom(e){return this._value[0]=e._value[0],this._value[1]=e._value[1],this._value[2]=e._value[2],this._value[3]=e._value[3],this}clone(){return new r(this._value[0],this._value[1],this._value[2],this._value[3])}}t.Color=r,r.Linear=0,r.sRGB=1},"./src/core/math/Euler.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Euler=void 0;const s=r("./src/core/manager/PoolManager.ts"),a=r("./src/core/util/Utils.ts");class n{constructor(e=0,t=0,r=0){this._value=new Float32Array([e,t,r])}static get(e=0,t=0,r=0){return s.PoolManager.ins().eulerPool.get(e,t,r)}static put(e){s.PoolManager.ins().eulerPool.put(e)}get x(){return this._value[0]}set x(e){this._value[0]=e}get y(){return this._value[1]}set y(e){this._value[1]=e}get z(){return this._value[2]}set z(e){this._value[2]=e}set(e,t,r){return this._value[0]=e,this._value[1]=t,this._value[2]=r,this}setByMatrix(e){let t,r,s=e.value[9],n=-Math.asin(a.Utils.Math.clamp(s,-1,1));if(Math.abs(s)<.9999999){let s=e.value[8],a=e.value[10],n=e.value[1],i=e.value[5];t=Math.atan2(s,a),r=Math.atan2(n,i)}else{let s=e.value[2],a=e.value[0];t=Math.atan2(-s,a),r=0}return this.set(n,t,r)}setByQuaternion(e){let t,r,s=e.x*e.x,n=e.y*e.y,i=e.z*e.z,o=e.x*e.y,l=e.x*e.z,u=e.x*e.w,_=e.y*e.z,h=e.y*e.w,c=e.z*e.w,d=2*(_-u),m=-Math.asin(a.Utils.Math.clamp(d,-1,1));if(Math.abs(d)<.9999999){let e=2*(l+h),a=1-2*(s+n),u=2*(o+c),_=1-2*(s+i);t=Math.atan2(e,a),r=Math.atan2(u,_)}else{let e=2*(l-h),s=1-2*(n+i);t=Math.atan2(-e,s),r=0}return this.set(m,t,r)}setByVector3(e){return this._value[0]=e.x,this._value[1]=e.y,this._value[2]=e.z,this}copyFrom(e){return this._value[0]=e._value[0],this._value[1]=e._value[1],this._value[2]=e._value[2],this}clone(){return new n(this._value[0],this._value[1],this._value[2])}toString(){return`euler -------------\n${this._value[0].toFixed(4)} | ${this._value[1].toFixed(4)} | ${this._value[2].toFixed(4)}\n`}}t.Euler=n},"./src/core/math/Matrix3.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Matrix3=void 0;const s=r("./src/core/manager/PoolManager.ts");class a{constructor(){this._value=new Float32Array([1,0,0,0,1,0,0,0,1])}static get(){return s.PoolManager.ins().mtx3Pool.get()}static put(e){s.PoolManager.ins().mtx3Pool.put(e)}static multiply(e,t,r){let s=e._value[0],a=e._value[3],n=e._value[6],i=e._value[1],o=e._value[4],l=e._value[7],u=e._value[2],_=e._value[5],h=e._value[8],c=t._value[0],d=t._value[3],m=t._value[6],g=t._value[1],p=t._value[4],f=t._value[7],T=t._value[2],v=t._value[5],M=t._value[8],E=s*c+a*g+n*T,R=s*d+a*p+n*v,C=s*m+a*f+n*M,A=i*c+o*g+l*T,x=i*d+o*p+l*v,S=i*m+o*f+l*M,y=u*c+_*g+h*T,P=u*d+_*p+h*v,L=u*m+_*f+h*M;r.set(E,R,C,A,x,S,y,P,L)}static multiplyScalar(e,t,r){r._value[0]=e._value[0]*t,r._value[3]=e._value[3]*t,r._value[6]=e._value[6]*t,r._value[1]=e._value[1]*t,r._value[4]=e._value[4]*t,r._value[7]=e._value[7]*t,r._value[2]=e._value[2]*t,r._value[5]=e._value[5]*t,r._value[8]=e._value[8]*t}static transpose(e,t){t.set(e._value[0],e._value[1],e._value[2],e._value[3],e._value[4],e._value[5],e._value[6],e._value[7],e._value[8])}static invert(e,t){let r=e._value[0],s=e._value[3],a=e._value[6],n=e._value[1],i=e._value[4],o=e._value[7],l=e._value[2],u=e._value[5],_=e._value[8],h=_*i-u*o,c=u*a-_*s,d=o*s-i*a,m=r*h+n*c+l*d;if(0===m)return void t.set(0,0,0,0,0,0,0,0,0);let g=1/m;t._value[0]=h*g,t._value[1]=(l*o-_*n)*g,t._value[2]=(u*n-l*i)*g,t._value[3]=c*g,t._value[4]=(_*r-l*a)*g,t._value[5]=(l*s-u*r)*g,t._value[6]=d*g,t._value[7]=(n*a-o*r)*g,t._value[8]=(i*r-n*s)*g}static determiaant(e){let t=e._value[0],r=e._value[3],s=e._value[6],a=e._value[1],n=e._value[4],i=e._value[7],o=e._value[2],l=e._value[5],u=e._value[8];return t*n*u-t*l*i-a*r*u+a*l*s+o*r*i-o*n*s}get value(){return this._value}get row(){return 3}get column(){return 3}set(e,t,r,s,a,n,i,o,l){return this._value[0]=e,this._value[3]=t,this._value[6]=r,this._value[1]=s,this._value[4]=a,this._value[7]=n,this._value[2]=i,this._value[5]=o,this._value[8]=l,this}setByMatrix4(e){let t=e.value;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10])}setByRS(e,t){}setIdentify(){return this.set(1,0,0,0,1,0,0,0,1)}setBasic(e,t){return this.set(e.x,t.x,0,e.y,t.y,0,0,0,1)}setScale(e){return this.set(e.x,0,0,0,e.y,0,0,0,1)}setRotate(e){let t=Math.sin(e),r=Math.cos(e);return this.set(r,-t,0,t,r,0,0,0,1)}setRotateByEuler(){throw new Error("Method not implemented.")}setRotateByQuaternion(){throw new Error("Method not implemented.")}setTranslation(e){return this.set(1,0,e.x,0,1,e.y,0,0,1)}applyScale(e){return this._value[0]*=e.x,this._value[3]*=e.x,this._value[6]*=e.x,this._value[1]*=e.y,this._value[4]*=e.y,this._value[7]*=e.y,this}applyRotate(e){let t=Math.sin(e),r=Math.cos(e),s=this._value[0],a=this._value[3],n=this._value[6],i=this._value[1],o=this._value[4],l=this._value[7];return this._value[0]=s*r-i*t,this._value[3]=a*r-o*t,this._value[6]=n*r-l*t,this._value[1]=s*t+i*r,this._value[4]=a*t+o*r,this._value[7]=n*t+l*r,this}applyTranslation(e){let t=this._value[2],r=this._value[5],s=this._value[8];return this._value[0]+=t*e.x,this._value[3]+=r*e.x,this._value[6]+=s*e.x,this._value[1]+=t*e.y,this._value[4]+=r*e.y,this._value[7]+=s*e.y,this}multiply(e){return a.multiply(e,this,this),this}multiplyScalar(e){return a.multiplyScalar(this,e,this),this}transformVector(e,t){throw new Error("Method not implemented.")}transformPoint(e,t){throw new Error("Method not implemented.")}determiaant(){return a.determiaant(this)}invert(){return a.invert(this,this),this}transpose(){return a.transpose(this,this),this}getRow(e,t){return t.x=this._value[e],t.y=this._value[e+3],t.z=this._value[e+6],t}setRow(e,t){return this._value[e]=t.x,this._value[e+3]=t.y,this._value[e+6]=t.z,this}getColumn(e,t){return e*=3,t.x=this._value[e++],t.y=this._value[e++],t.z=this._value[e],t}setColumn(e,t){return e*=3,this._value[e++]=t.x,this._value[e++]=t.y,this._value[e]=t.z,this}toRS(e,t){}isEqual(e){for(let t=0,r=this._value.length;t<r;t++)if(this._value[t]!=e._value[t])return!1;return!0}copyFrom(e){return this.set(e._value[0],e._value[3],e._value[6],e._value[1],e._value[4],e._value[7],e._value[2],e._value[5],e._value[8])}clone(){return(new a).set(this._value[0],this._value[3],this._value[6],this._value[1],this._value[4],this._value[7],this._value[2],this._value[5],this._value[8])}}t.Matrix3=a},"./src/core/math/Matrix4.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Matrix4=void 0;const s=r("./src/core/manager/PoolManager.ts"),a=r("./src/core/math/Vector3.ts");class n{constructor(e){this._value=e?new Float32Array(e):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static get(){return s.PoolManager.ins().mtx4Pool.get()}static put(e){s.PoolManager.ins().mtx4Pool.put(e)}static multiply(e,t,r){let s=e._value[0],a=e._value[4],n=e._value[8],i=e._value[12],o=e._value[1],l=e._value[5],u=e._value[9],_=e._value[13],h=e._value[2],c=e._value[6],d=e._value[10],m=e._value[14],g=e._value[3],p=e._value[7],f=e._value[11],T=e._value[15],v=t._value[0],M=t._value[4],E=t._value[8],R=t._value[12],C=t._value[1],A=t._value[5],x=t._value[9],S=t._value[13],y=t._value[2],P=t._value[6],L=t._value[10],b=t._value[14],U=t._value[3],F=t._value[7],I=t._value[11],O=t._value[15],D=s*v+a*C+n*y+i*U,B=s*M+a*A+n*P+i*F,w=s*E+a*x+n*L+i*I,N=s*R+a*S+n*b+i*O,G=o*v+l*C+u*y+_*U,k=o*M+l*A+u*P+_*F,V=o*E+l*x+u*L+_*I,X=o*R+l*S+u*b+_*O,H=h*v+c*C+d*y+m*U,Y=h*M+c*A+d*P+m*F,j=h*E+c*x+d*L+m*I,W=h*R+c*S+d*b+m*O,z=g*v+p*C+f*y+T*U,Q=g*M+p*A+f*P+T*F,K=g*E+p*x+f*L+T*I,q=g*R+p*S+f*b+T*O;r.set(D,B,w,N,G,k,V,X,H,Y,j,W,z,Q,K,q)}static multiplyScalar(e,t,r){r._value[0]=e._value[0]*t,r._value[4]=e._value[4]*t,r._value[8]=e._value[8]*t,r._value[12]=e._value[12]*t,r._value[1]=e._value[1]*t,r._value[5]=e._value[5]*t,r._value[9]=e._value[9]*t,r._value[13]=e._value[13]*t,r._value[2]=e._value[2]*t,r._value[6]=e._value[6]*t,r._value[10]=e._value[10]*t,r._value[14]=e._value[14]*t,r._value[3]=e._value[3]*t,r._value[7]=e._value[7]*t,r._value[11]=e._value[11]*t,r._value[15]=e._value[15]*t}static transpose(e,t){t.set(e._value[0],e._value[1],e._value[2],e._value[3],e._value[4],e._value[5],e._value[6],e._value[7],e._value[8],e._value[9],e._value[10],e._value[11],e._value[12],e._value[13],e._value[14],e._value[15])}static invert(e,t){let r=e._value[0],s=e._value[4],a=e._value[8],n=e._value[12],i=e._value[1],o=e._value[5],l=e._value[9],u=e._value[13],_=e._value[2],h=e._value[6],c=e._value[10],d=e._value[14],m=e._value[3],g=e._value[7],p=e._value[11],f=e._value[15],T=l*d*g-u*c*g+u*h*p-o*d*p-l*h*f+o*c*f,v=n*c*g-a*d*g-n*h*p+s*d*p+a*h*f-s*c*f,M=a*u*g-n*l*g+n*o*p-s*u*p-a*o*f+s*l*f,E=n*l*h-a*u*h-n*o*c+s*u*c+a*o*d-s*l*d,R=r*T+i*v+_*M+m*E;if(0===R)return void t.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let C=1/R;t._value[0]=T*C,t._value[1]=(u*c*m-l*d*m-u*_*p+i*d*p+l*_*f-i*c*f)*C,t._value[2]=(o*d*m-u*h*m+u*_*g-i*d*g-o*_*f+i*h*f)*C,t._value[3]=(l*h*m-o*c*m-l*_*g+i*c*g+o*_*p-i*h*p)*C,t._value[4]=v*C,t._value[5]=(a*d*m-n*c*m+n*_*p-r*d*p-a*_*f+r*c*f)*C,t._value[6]=(n*h*m-s*d*m-n*_*g+r*d*g+s*_*f-r*h*f)*C,t._value[7]=(s*c*m-a*h*m+a*_*g-r*c*g-s*_*p+r*h*p)*C,t._value[8]=M*C,t._value[9]=(n*l*m-a*u*m-n*i*p+r*u*p+a*i*f-r*l*f)*C,t._value[10]=(s*u*m-n*o*m+n*i*g-r*u*g-s*i*f+r*o*f)*C,t._value[11]=(a*o*m-s*l*m-a*i*g+r*l*g+s*i*p-r*o*p)*C,t._value[12]=E*C,t._value[13]=(a*u*_-n*l*_+n*i*c-r*u*c-a*i*d+r*l*d)*C,t._value[14]=(n*o*_-s*u*_-n*i*h+r*u*h+s*i*d-r*o*d)*C,t._value[15]=(s*l*_-a*o*_+a*i*h-r*l*h-s*i*c+r*o*c)*C}static determiaant(e){let t=e._value[0],r=e._value[4],s=e._value[8],a=e._value[12],n=e._value[1],i=e._value[5],o=e._value[9],l=e._value[13],u=e._value[2],_=e._value[6],h=e._value[10],c=e._value[14];return e._value[3]*(+a*o*_-s*l*_-a*i*h+r*l*h+s*i*c-r*o*c)+e._value[7]*(+t*o*c-t*l*h+a*n*h-s*n*c+s*l*u-a*o*u)+e._value[11]*(+t*l*_-t*i*c-a*n*_+r*n*c+a*i*u-r*l*u)+e._value[15]*(-s*i*u-t*o*_+t*i*h+s*n*_-r*n*h+r*o*u)}static transformVector(e,t,r){let s=e._value;r.x=s[0]*t.x+s[4]*t.y+s[8]*t.z,r.y=s[1]*t.x+s[5]*t.y+s[9]*t.z,r.z=s[2]*t.x+s[6]*t.y+s[10]*t.z}static transformPoint(e,t,r){let s=e._value,a=1/(s[3]*t.x+s[7]*t.y+s[11]*t.z+s[15]);r.x=(s[0]*t.x+s[4]*t.y+s[8]*t.z+s[12])*a,r.y=(s[1]*t.x+s[5]*t.y+s[9]*t.z+s[13])*a,r.z=(s[2]*t.x+s[6]*t.y+s[10]*t.z+s[14])*a}static lookAt(e,t,r,s){let n=a.Vector3.sub(t,e,a.Vector3.get()).negate().normalize(),i=a.Vector3.cross(r,n,a.Vector3.get()).normalize(),o=a.Vector3.cross(n,i,a.Vector3.get());s.setColumn(0,i),s.setColumn(1,o),s.setColumn(2,n),a.Vector3.put([i,o,n])}static perspective(e,t,r,s,a,n,i){let o=2*a/(s-r),l=2*a/(e-t),u=(s+r)/(s-r),_=(e+t)/(e-t),h=-(n+a)/(n-a),c=-2*n*a/(n-a);i.set(o,0,u,0,0,l,_,0,0,0,h,c,0,0,-1,0)}static perspectiveByFov(e,t,r,s,a){let n=r*Math.tan(.5*e),i=n*t;this.perspective(n,-n,-i,i,r,s,a)}static orthographic(e,t,r,s,a,n,i){let o=1/(s-r),l=1/(e-t),u=1/(n-a);i.set(2*o,0,0,-(s+r)*o,0,2*l,0,-(e+t)*l,0,0,-2*u,-(n+a)*u,0,0,0,1)}get value(){return this._value}get row(){return 4}get column(){return 4}set(e,t,r,s,a,n,i,o,l,u,_,h,c,d,m,g){return this._value[0]=e,this._value[4]=t,this._value[8]=r,this._value[12]=s,this._value[1]=a,this._value[5]=n,this._value[9]=i,this._value[13]=o,this._value[2]=l,this._value[6]=u,this._value[10]=_,this._value[14]=h,this._value[3]=c,this._value[7]=d,this._value[11]=m,this._value[15]=g,this}setByMatrix3(e){let t=e.value;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1)}setByTRS(e,t,r){let s=t.x,a=t.y,n=t.z,i=t.w,o=s+s,l=a+a,u=n+n,_=s*o,h=s*l,c=s*u,d=a*l,m=a*u,g=n*u,p=i*o,f=i*l,T=i*u,v=r.x,M=r.y,E=r.z;return this.set((1-(d+g))*v,(h-T)*M,(c+f)*E,e.x,(h+T)*v,(1-(_+g))*M,(m-p)*E,e.y,(c-f)*v,(m+p)*M,(1-(_+d))*E,e.z,0,0,0,1)}setIdentify(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setBasic(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1)}setScale(e){return this.set(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)}setRotateX(e){let t=Math.sin(e),r=Math.cos(e);return this.set(1,0,0,0,0,r,-t,0,0,t,r,0,0,0,0,1)}setRotateY(e){let t=Math.sin(e),r=Math.cos(e);return this.set(r,0,t,0,0,1,0,0,-t,0,r,0,0,0,0,1)}setRotateZ(e){let t=Math.sin(e),r=Math.cos(e);return this.set(r,-t,0,0,t,r,0,0,0,0,1,0,0,0,0,1)}setRotateByAxisAngle(e,t){let r=Math.sin(t),s=Math.cos(t),a=1-s,n=e.x,i=e.y,o=e.z,l=a*n,u=a*i;return this.set(l*n+s,l*i-r*o,l*o+r*i,0,l*i+r*o,u*i+s,u*o-r*n,0,l*o-r*i,u*o+r*n,a*o*o+s,0,0,0,0,1)}setRotateByEuler(e){let t=Math.cos(e.x),r=Math.sin(e.x),s=Math.cos(e.y),a=Math.sin(e.y),n=Math.cos(e.z),i=Math.sin(e.z);return this.set(s*n+a*r*i,-s*i+a*r*n,a*t,0,t*i,t*n,-r,0,-a*n+s*r*i,a*i+s*r*n,s*t,0,0,0,0,1)}setRotateByQuaternion(e){return this.setByTRS(a.Vector3.ZERO,e,a.Vector3.ONE)}setTranslation(e){return this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1)}setPerspective(e,t,r,s){return n.perspectiveByFov(e,t,r,s,this),this}setOrthographic(e,t,r,s,a,i){return n.orthographic(e,t,r,s,a,i,this),this}setByLookAt(e,t,r){return n.lookAt(e,t,r,this),this}applyScale(e){return this._value[0]*=e.x,this._value[4]*=e.y,this._value[8]*=e.z,this._value[1]*=e.x,this._value[5]*=e.y,this._value[9]*=e.z,this._value[2]*=e.x,this._value[6]*=e.y,this._value[10]*=e.z,this._value[3]*=e.x,this._value[7]*=e.y,this._value[11]*=e.z,this}applyRotateByAxisAngle(e,t){let r=n.get().setRotateByAxisAngle(e,t);return this.multiply(r),n.put(r),this}applyTranslation(e){let t=this._value[3],r=this._value[7],s=this._value[11],a=this._value[15];return this._value[0]+=t*e.x,this._value[4]+=r*e.x,this._value[8]+=s*e.x,this._value[12]+=a*e.x,this._value[1]+=t*e.y,this._value[5]+=r*e.y,this._value[9]+=s*e.y,this._value[13]+=a*e.y,this._value[2]+=t*e.z,this._value[6]+=r*e.z,this._value[10]+=s*e.z,this._value[14]+=a*e.z,this}multiply(e){return n.multiply(e,this,this),this}multiplyScalar(e){return n.multiplyScalar(this,e,this),this}transformVector(e,t){return n.transformVector(this,e,t),t}transformPoint(e,t){return n.transformVector(this,e,t),t}determiaant(){return n.determiaant(this)}invert(){return n.invert(this,this),this}transpose(){return n.transpose(this,this),this}getRow(e,t){return t.x=this._value[e],t.y=this._value[e+4],t.z=this._value[e+8],t.w=this._value[e+12],t}setRow(e,t){return this._value[e]=t.x,this._value[e+4]=t.y,this._value[e+8]=t.z,this._value[e+12]=t.w,this}getColumn(e,t){return e*=4,t.x=this._value[e++],t.y=this._value[e++],t.z=this._value[e++],t.w=this._value[e],t}setColumn(e,t){return e*=4,this._value[e++]=t.x,this._value[e++]=t.y,this._value[e++]=t.z,this._value[e]=t.w,this}toTRS(e,t,r){if(t||r){let e=this.getColumn(0,a.Vector3.get()),s=this.getColumn(1,a.Vector3.get()),i=this.getColumn(2,a.Vector3.get()),o=e.length(),l=s.length(),u=i.length();if(a.Vector3.put([e,s,i]),this.determiaant()<0&&(o=-o),t){let e=1/o,r=1/l,s=1/u,a=n.get().copyFrom(this);a._value[0]*=e,a._value[1]*=e,a._value[2]*=e,a._value[4]*=r,a._value[5]*=r,a._value[6]*=r,a._value[8]*=s,a._value[9]*=s,a._value[10]*=s,t.setByMatrix(a),n.put(a)}r&&r.set(o,l,u)}e&&this.getColumn(3,e)}isEqual(e){for(let t=0,r=this._value.length;t<r;t++)if(this._value[t]!=e._value[t])return!1;return!0}copyFrom(e){return this.set(e._value[0],e._value[4],e._value[8],e._value[12],e._value[1],e._value[5],e._value[9],e._value[13],e._value[2],e._value[6],e._value[10],e._value[14],e._value[3],e._value[7],e._value[11],e._value[15])}clone(){return(new n).set(this._value[0],this._value[4],this._value[8],this._value[12],this._value[1],this._value[5],this._value[9],this._value[13],this._value[2],this._value[6],this._value[10],this._value[14],this._value[3],this._value[7],this._value[11],this._value[15])}toString(){let e="matrix -------------\n";for(let t=0;t<4;t++)e+=`row ${this._value[t].toFixed(4)} | ${this._value[t+4].toFixed(4)} | ${this._value[t+8].toFixed(4)} | ${this._value[t+12].toFixed(4)}\n`;return e}}t.Matrix4=n},"./src/core/math/Quaternion.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Quaternion=void 0;const s=r("./src/core/manager/PoolManager.ts"),a=r("./src/core/util/Utils.ts");class n{constructor(e=0,t=0,r=0,s=1){this._value=new Float32Array([e,t,r,s])}static get(e=0,t=0,r=0,a=1){return s.PoolManager.ins().quatPool.get(e,t,r,a)}static put(e){s.PoolManager.ins().quatPool.put(e)}static multiply(e,t,r){let s=e._value[0],a=e._value[1],n=e._value[2],i=e._value[3],o=t._value[0],l=t._value[1],u=t._value[2],_=t._value[3];r._value[0]=s*_+i*o+a*u-n*l,r._value[1]=a*_+i*l+n*o-s*u,r._value[2]=n*_+i*u+s*l-a*o,r._value[3]=i*_-s*o-a*l-n*u}static conjugate(e,t){t._value[0]=-e._value[0],t._value[1]=-e._value[1],t._value[2]=-e._value[2]}static invert(e,t){let r=e.lengthSquare();0===r?t.setIdentify():(r=1/r,t._value[0]=-e._value[0]*r,t._value[1]=-e._value[1]*r,t._value[2]=-e._value[2]*r,t._value[3]=e._value[3]*r)}static transformVector(e,t,r){let s=e._value[0],a=e._value[1],n=e._value[2],i=e._value[3],o=i*t.x+a*t.z-n*t.y,l=i*t.y+n*t.x-s*t.z,u=i*t.z+s*t.y-a*t.x,_=-s*t.x-a*t.y-n*t.z;r.x=o*i+_*-s+l*-n-u*-a,r.y=l*i+_*-a+u*-s-o*-n,r.z=u*i+_*-n+o*-a-l*-s}static slerp(e,t,r,s){if(0===r)return void s.copyFrom(e);if(1===r)return void s.copyFrom(t);let a=e.dot(t);a<0&&(e.negate(),a=-a)}static nlerp(e,t,r,s){}static rotateTowards(e,t,r,s){}static angle(e,t){return 2*Math.acos(Math.abs(a.Utils.Math.clamp(e.dot(t),-1,1)))}get x(){return this._value[0]}set x(e){this._value[0]=e}get y(){return this._value[1]}set y(e){this._value[1]=e}get z(){return this._value[2]}set z(e){this._value[2]=e}get w(){return this._value[3]}set w(e){this._value[3]=e}set(e,t,r,s){return this._value[0]=e,this._value[1]=t,this._value[2]=r,this._value[3]=s,this}setIdentify(){return this.set(0,0,0,1)}setByAxisAngle(e,t){let r=Math.sin(.5*t),s=Math.cos(.5*t);return this.set(e.x*r,e.y*r,e.z*r,s)}setByMatrix(e){let t=e.value[0],r=e.value[4],s=e.value[8],a=e.value[1],n=e.value[5],i=e.value[9],o=e.value[2],l=e.value[6],u=e.value[10],_=t+n+u;if(_>0){let e=.5/Math.sqrt(_+1);this._value[3]=.25/e,this._value[0]=(l-i)*e,this._value[1]=(s-o)*e,this._value[2]=(a-r)*e}else if(t>n&&t>u){let e=2*Math.sqrt(1+t-n-u);this._value[3]=(l-i)/e,this._value[0]=.25*e,this._value[1]=(r+a)/e,this._value[2]=(s+o)/e}else if(n>u){let e=2*Math.sqrt(1+n-t-u);this._value[3]=(s-o)/e,this._value[0]=(r+a)/e,this._value[1]=.25*e,this._value[2]=(i+l)/e}else{let e=2*Math.sqrt(1+u-t-n);this._value[3]=(a-r)/e,this._value[0]=(s+o)/e,this._value[1]=(i+l)/e,this._value[2]=.25*e}return this}setByEuler(e){let t=.5*e.x,r=.5*e.y,s=.5*e.z,a=Math.cos(t),i=Math.sin(t),o=Math.cos(r),l=Math.sin(r),u=Math.cos(s),_=Math.sin(s),h=n.get(i,0,0,a),c=n.get(0,l,0,o),d=n.get(0,0,_,u);return this.copyFrom(d).multiply(h).multiply(c).normalize(),n.put([h,c,d]),this}setByLookAt(e,t){throw new Error("Method not implemented.")}setByVectors(e,t){throw new Error("Method not implemented.")}multiply(e){return n.multiply(e,this,this),this}slerp(e,t){return n.slerp(this,e,t,this),this}rotateTowards(e,t){return n.rotateTowards(this,e,t,this),this}dot(e){return this._value[0]*e._value[0]+this._value[1]*e._value[1]+this._value[2]*e._value[2]+this._value[3]*e._value[3]}length(){return Math.sqrt(this._value[0]*this._value[0]+this._value[1]*this._value[1]+this._value[2]*this._value[2]+this._value[3]*this._value[3])}lengthSquare(){return this._value[0]*this._value[0]+this._value[1]*this._value[1]+this._value[2]*this._value[2]+this._value[3]*this._value[3]}normalize(){let e=this.length();return 0===e?this.setIdentify():(e=1/e,this._value[0]*=e,this._value[1]*=e,this._value[2]*=e,this._value[3]*=e,this)}negate(){return this._value[0]=-this._value[0],this._value[1]=-this._value[1],this._value[2]=-this._value[2],this._value[3]=-this._value[3],this}conjugate(){return n.conjugate(this,this),this}invert(){return n.invert(this,this),this}angleTo(e){return n.angle(this,e)}transformVector(e,t){return n.transformVector(this,e,t),t}copyFrom(e){return this._value[0]=e._value[0],this._value[1]=e._value[1],this._value[2]=e._value[2],this._value[3]=e._value[3],this}clone(){return new n(this._value[0],this._value[1],this._value[2],this._value[3])}toString(){return`quat -------------\n${this._value[0].toFixed(4)} | ${this._value[1].toFixed(4)} | ${this._value[2].toFixed(4)} | ${this._value[3].toFixed(4)}\n`}}t.Quaternion=n},"./src/core/math/Rect.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Rect=void 0;class r{constructor(e=0,t=0,r=1,s=1){this._value=new Float32Array([e,t,r,s])}get x(){return this._value[0]}set x(e){this._value[0]=e}get y(){return this._value[1]}set y(e){this._value[1]=e}get width(){return this._value[2]}set width(e){this._value[2]=e}get height(){return this._value[3]}set height(e){this._value[3]=e}get top(){return this._value[1]+this._value[3]}get bottom(){return this._value[1]}get left(){return this._value[0]}get right(){return this._value[0]+this._value[2]}set(e,t,r,s){return this._value[0]=e,this._value[1]=t,this._value[2]=r,this._value[3]=s,this}copyFrom(e){return this._value[0]=e._value[0],this._value[1]=e._value[1],this._value[2]=e._value[2],this._value[3]=e._value[3],this}clone(){return new r(this._value[0],this._value[1],this._value[2],this._value[3])}}t.Rect=r},"./src/core/math/Vector2.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector2=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/PoolManager.ts"),n=r("./src/core/util/Utils.ts");class i{constructor(e=0,t=0){this._value=new Float32Array([e,t])}static get(e=0,t=0){return a.PoolManager.ins().vec2Pool.get(e,t)}static put(e){a.PoolManager.ins().vec2Pool.put(e)}static add(e,t,r){return r._value[0]=e._value[0]+t._value[0],r._value[1]=e._value[1]+t._value[1],r}static sub(e,t,r){return r._value[0]=e._value[0]-t._value[0],r._value[1]=e._value[1]-t._value[1],r}static lerp(e,t,r,s){return s._value[0]+=(t._value[0]-e._value[0])*r,s._value[1]+=(t._value[1]-e._value[1])*r,s}get x(){return this._value[0]}set x(e){this._value[0]=e}get y(){return this._value[1]}set y(e){this._value[1]=e}get value(){return this._value}set(e,t){return this._value[0]=e,this._value[1]=t,this}setLength(e){return this.normalize().mulScalar(e)}add(e){return this._value[0]+=e._value[0],this._value[1]+=e._value[1],this}sub(e){return this._value[0]-=e._value[0],this._value[1]-=e._value[1],this}addScalar(e){return this._value[0]+=e,this._value[1]+=e,this}mulScalar(e){return this._value[0]*=e,this._value[1]*=e,this}lerp(e,t){return this._value[0]+=(e._value[0]-this._value[0])*t,this._value[1]+=(e._value[1]-this._value[1])*t,this}dot(e){return this._value[0]*e._value[0]+this._value[1]*e._value[1]}cross(e){return this._value[0]*e._value[1]-this._value[1]*e._value[0]}length(){return Math.sqrt(this._value[0]*this._value[0]+this._value[1]*this._value[1])}lengthSquare(){return this._value[0]*this._value[0]+this._value[1]*this._value[1]}distanceTo(e){let t=this._value[0]-e._value[0],r=this._value[1]-e._value[1];return Math.sqrt(t*t+r*r)}distanceSquareTo(e){let t=this._value[0]-e._value[0],r=this._value[1]-e._value[1];return t*t+r*r}normalize(){let e=this.length();return this.mulScalar(1/(e||1))}negate(){return this._value[0]=-this._value[0],this._value[1]=-this._value[1],this}isEqual(e,t=s.Const.PRECISION.LV2){return!(!n.Utils.Math.isEqual(this._value[0],e._value[0],t)||!n.Utils.Math.isEqual(this._value[1],e._value[1],t))}rotate(e){let t=Math.cos(e),r=Math.sin(e),s=this._value[0],a=this._value[1];return this._value[0]=s*t-a*r,this._value[1]=s*r+a*t,this}angleTo(e){let t=this.length()*e.length();return 0==t?0:Math.acos(this.dot(e)/t)}copyFrom(e){return this._value[0]=e._value[0],this._value[1]=e._value[1],this}clone(){return new i(this._value[0],this._value[1])}}t.Vector2=i,i.BASE_X=new i(1,0),i.BASE_Y=new i(0,1),i.ZERO=new i},"./src/core/math/Vector3.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector3=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/PoolManager.ts"),n=r("./src/core/util/Utils.ts");class i{constructor(e=0,t=0,r=0,s=1){this._value=new Float32Array([e,t,r,s])}static get(e=0,t=0,r=0,s=1){return a.PoolManager.ins().vec3Pool.get(e,t,r,s)}static put(e){a.PoolManager.ins().vec3Pool.put(e)}static add(e,t,r){return r._value[0]=e._value[0]+t._value[0],r._value[1]=e._value[1]+t._value[1],r._value[2]=e._value[2]+t._value[2],r}static sub(e,t,r){return r._value[0]=e._value[0]-t._value[0],r._value[1]=e._value[1]-t._value[1],r._value[2]=e._value[2]-t._value[2],r}static lerp(e,t,r,s){return s._value[0]+=(t._value[0]-e._value[0])*r,s._value[1]+=(t._value[1]-e._value[1])*r,s._value[2]+=(t._value[2]-e._value[2])*r,s}static cross(e,t,r){let s=e.x,a=e.y,n=e.z,i=t.x,o=t.y,l=t.z;return r._value[0]=a*l-n*o,r._value[1]=n*i-s*l,r._value[2]=s*o-a*i,r}get x(){return this._value[0]}set x(e){this._value[0]=e}get y(){return this._value[1]}set y(e){this._value[1]=e}get z(){return this._value[2]}set z(e){this._value[2]=e}get w(){return this._value[3]}set w(e){this._value[3]=e}get value(){return this._value}set(e,t,r,s){return this._value[0]=e,this._value[1]=t,this._value[2]=r,null!=s&&(this._value[3]=s),this}setLength(e){return this.normalize().mulScalar(e)}add(e){return this._value[0]+=e._value[0],this._value[1]+=e._value[1],this._value[2]+=e._value[2],this}sub(e){return this._value[0]-=e._value[0],this._value[1]-=e._value[1],this._value[2]-=e._value[2],this}addScalar(e){return this._value[0]+=e,this._value[1]+=e,this._value[2]+=e,this}mulScalar(e){return this._value[0]*=e,this._value[1]*=e,this._value[2]*=e,this}lerp(e,t){return this._value[0]+=(e._value[0]-this._value[0])*t,this._value[1]+=(e._value[1]-this._value[1])*t,this._value[2]+=(e._value[2]-this._value[2])*t,this}dot(e){return this._value[0]*e._value[0]+this._value[1]*e._value[1]+this._value[2]*e._value[2]}cross(e){return i.cross(this,e,this)}length(){return Math.sqrt(this._value[0]*this._value[0]+this._value[1]*this._value[1]+this._value[2]*this._value[2])}lengthSquare(){return this._value[0]*this._value[0]+this._value[1]*this._value[1]+this._value[2]*this._value[2]}distanceTo(e){let t=this._value[0]-e._value[0],r=this._value[1]-e._value[1],s=this._value[2]-e._value[2];return Math.sqrt(t*t+r*r+s*s)}distanceSquareTo(e){let t=this._value[0]-e._value[0],r=this._value[1]-e._value[1],s=this._value[2]-e._value[2];return t*t+r*r+s*s}normalize(){let e=this.length();return this.mulScalar(1/(e||1))}negate(){return this._value[0]=-this._value[0],this._value[1]=-this._value[1],this._value[2]=-this._value[2],this}isEqual(e,t=s.Const.PRECISION.LV2){return!!(n.Utils.Math.isEqual(this._value[0],e._value[0],t)&&n.Utils.Math.isEqual(this._value[1],e._value[1],t)&&n.Utils.Math.isEqual(this._value[2],e._value[2],t))}angleTo(e){let t=this.length()*e.length();return 0==t?0:Math.acos(this.dot(e)/t)}copyFrom(e){return this._value[0]=e._value[0],this._value[1]=e._value[1],this._value[2]=e._value[2],this._value[3]=e._value[3],this}clone(){return new i(this._value[0],this._value[1],this._value[2],this._value[3])}}t.Vector3=i,i.BASE_X=new i(1,0,0),i.BASE_Y=new i(0,1,0),i.BASE_Z=new i(0,0,1),i.ZERO=new i,i.ONE=new i(1,1,1)},"./src/core/math/Vector4.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vector4=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/manager/PoolManager.ts"),n=r("./src/core/util/Utils.ts");class i{constructor(e=0,t=0,r=0,s=1){this._value=new Float32Array([e,t,r,s])}static get(){return a.PoolManager.ins().vec4Pool.get()}static put(e){a.PoolManager.ins().vec4Pool.put(e)}get x(){return this._value[0]}set x(e){this._value[0]=e}get y(){return this._value[1]}set y(e){this._value[1]=e}get z(){return this._value[2]}set z(e){this._value[2]=e}get w(){return this._value[3]}set w(e){this._value[3]=e}get value(){return this._value}set(e,t,r,s){return this._value[0]=e,this._value[1]=t,this._value[2]=r,null!=s&&(this._value[3]=s),this}isEqual(e,t=s.Const.PRECISION.LV2){return!!(n.Utils.Math.isEqual(this._value[0],e._value[0],t)&&n.Utils.Math.isEqual(this._value[1],e._value[1],t)&&n.Utils.Math.isEqual(this._value[2],e._value[2],t)&&n.Utils.Math.isEqual(this._value[3],e._value[3],t))}copyFrom(e){return this._value[0]=e._value[0],this._value[1]=e._value[1],this._value[2]=e._value[2],this._value[3]=e._value[3],this}clone(){return new i(this._value[0],this._value[1],this._value[2],this._value[3])}}t.Vector4=i},"./src/core/renderer/webgl/GLEnum.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLEnum=void 0,function(e){let t;!function(e){e[e.V_SHADER=0]="V_SHADER",e[e.F_SHADER=1]="F_SHADER"}(t=e.ShaderType||(e.ShaderType={}))}(t.GLEnum||(t.GLEnum={}))},"./src/core/renderer/webgl/GLProgram.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLProgram=void 0;const s=r("./src/core/renderer/webgl/GLUtil.ts");t.GLProgram=class{constructor(e){this._gl=e,this._init()}get source(){return this._source}get invalid(){return this._invalid}_init(){this._source=(0,s.createProgram)(this._gl),this._invalid=!0}attachShaders(e,t){this._vShader=e,this._fShader=t,(0,s.attachShader)(this._gl,this._source,e.source,t.source)}linkProgram(){if(!this._invalid)return!0;let e=!0;return e=!(!this._vShader||!this._fShader)&&(!this._vShader.invalid&&!this._fShader.invalid&&(!!this._source&&(0,s.linkProgram)(this._gl,this._source,this._vShader.source,this._fShader.source))),this._invalid=!e,e||this._deleteProgram(),e}use(){this._gl.useProgram(this._source)}getAttribLocation(e){return this._gl.getAttribLocation(this._source,e)}bindAttribLocation(e,t){this._gl.bindAttribLocation(this._source,t,e)}getUniformLocation(e){return this._gl.getUniformLocation(this._source,e)}getUniformBlockIndex(e){return this._gl.getUniformBlockIndex(this._source,e)}uniformBlockBinding(e){e.forEach(((e,t)=>{this._gl.uniformBlockBinding(this._source,e,t)}))}setBool(e,t){this.setInt(e,Number(t))}setInt(e,t){this._gl.uniform1i(e,t)}setFloat(e,t){this._gl.uniform1f(e,t)}setVec2(e,t){this._gl.uniform2fv(e,t.value)}setVec3(e,t){this._gl.uniform3fv(e,t.value)}setVec4(e,t){this._gl.uniform4fv(e,t.value)}setMtx2(e,t){}setMtx3(e,t){this._gl.uniformMatrix3fv(e,!1,t.value)}setMtx4(e,t){this._gl.uniformMatrix3fv(e,!1,t.value)}destroy(){this._invalid||(this._deleteProgram(),this._invalid=!0),this._gl=null,this._source=null,this._vShader=null,this._fShader=null}_deleteProgram(){var e,t;null===(e=this._vShader)||void 0===e||e.destroy(),null===(t=this._fShader)||void 0===t||t.destroy(),this._gl.deleteProgram(this._source)}}},"./src/core/renderer/webgl/GLRenderer.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLRenderer=void 0;const s=r("./src/core/renderer/webgl/GLUtil.ts");t.GLRenderer=class{constructor(e=800,t=600,r){this._canvas=(0,s.createCanvas)(e,t),this._onEvent(),this._gl=(0,s.create3DContext)(this._canvas,r);this._gl.getExtension("EXT_color_buffer_float"),this._gl.getExtension("OES_texture_float_linear");this._width=e,this._height=t,this._glAttributes=r}get gl(){return this._gl}get canvas(){return this._canvas}get width(){return this._width}get height(){return this._height}render(){}clear(e){this._gl.clearColor(e.r,e.g,e.b,e.a),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT|this._gl.STENCIL_BUFFER_BIT)}_onEvent(){this._canvas.addEventListener("webglcontextlost",this._onWebGLContextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._onWebGLContextRestore,!1),this._canvas.addEventListener("webglcontextcreationerror",this._onWebGLContextCreationError,!1)}_offEvent(){this._canvas.removeEventListener("webglcontextlost",this._onWebGLContextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._onWebGLContextRestore,!1),this._canvas.removeEventListener("webglcontextcreationerror",this._onWebGLContextCreationError,!1)}_onWebGLContextLost(){}_onWebGLContextRestore(){}_onWebGLContextCreationError(){}destroy(){this._offEvent()}}},"./src/core/renderer/webgl/GLShader.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GLShader=void 0;const s=r("./src/core/renderer/webgl/GLUtil.ts");t.GLShader=class{constructor(e,t,r){this._gl=e,this._type=r,this._code=t,this._init()}get type(){return this._type}get source(){return this._source}get invalid(){return this._invalid}_init(){this._source=(0,s.createShader)(this._gl,this._type),this._invalid=!this._source||!(0,s.compileShader)(this._gl,this._code,this._source)}destroy(){this._invalid||(this._gl.deleteShader(this._source),this._invalid=!0),this._gl=null,this._type=null,this._source=null,this._code=null}}},"./src/core/renderer/webgl/GLUtil.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compileShader=t.createShader=t.linkProgram=t.attachShader=t.createProgram=t.create3DContext=t.createCanvas=void 0;const s=r("./src/core/util/Utils.ts"),a=r("./src/core/renderer/webgl/GLEnum.ts");t.createCanvas=function(e,t){let r=s.Utils.Document.createElementNS("canvas");return(e||0!==e)&&(r.width=e),(t||0!==t)&&(r.height=t),r},t.create3DContext=function(e,t){let r,s=["webgl2","webgl","experimental-webgl"];for(let a=0;a<s.length;a++)if(r=e.getContext(s[a],t),r)return r;return r},t.createProgram=function(e){let t=e.createProgram();if(!t)throw new Error("create program failed!");return t},t.attachShader=function(e,t,r,s){e.attachShader(t,r),e.attachShader(t,s)},t.linkProgram=function(e,t,r,s){e.linkProgram(t),e.validateProgram(t);let a=!0;if(!e.getProgramParameter(t,e.LINK_STATUS)){let r=e.getProgramInfoLog(t);console.warn("program link failed!",r),a=!1}if(!e.getProgramParameter(t,e.VALIDATE_STATUS)){let r=e.getProgramInfoLog(t);console.warn("program link failed!",r),a=!1}return a},t.createShader=function(e,t){let r;if(t===a.GLEnum.ShaderType.V_SHADER?r=e.createShader(e.VERTEX_SHADER):t===a.GLEnum.ShaderType.F_SHADER&&(r=e.createShader(e.FRAGMENT_SHADER)),!r)throw new Error("create shader failed!");return r},t.compileShader=function(e,t,r){if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){let t=e.getShaderInfoLog(r);return console.warn("compile shader failed!",t),e.deleteShader(r),!1}return!0}},"./src/core/system/InputSystem.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputSystem=void 0;const s=r("./src/core/manager/InputManager.ts"),a=r("./src/core/system/System.ts");class n extends a.System{start(){s.InputManager.ins()}update(e){s.InputManager.ins().swapKeyState()}}t.InputSystem=n},"./src/core/system/PerformanceSystem.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceSystem=void 0;const s=r("./src/core/debug/Stats.ts"),a=r("./src/core/system/System.ts");class n extends a.System{start(){this._initProperty()}_initProperty(){this._stats=new s.Stats,document.body.append(this._stats.dom)}update(e){this._stats.update()}}t.PerformanceSystem=n},"./src/core/system/PhysicsSystem.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicsSystem=void 0;const s=r("./src/core/system/System.ts");class a extends s.System{}t.PhysicsSystem=a},"./src/core/system/RendererSystem.ts":function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RendererSystem=void 0;const a=s(r("./src/config/Config.ts")),n=r("./src/core/asset/material/postprocessing/Postprocessor.ts"),i=r("./src/core/asset/shader/Uniform.ts"),o=r("./src/core/asset/texture/RenderTarget.ts"),l=r("./src/core/common/Const.ts"),u=r("./src/core/component/Camera.ts"),_=r("./src/core/component/CubeCamera.ts"),h=r("./src/core/component/Light.ts"),c=r("./src/core/component/MeshFilter.ts"),d=r("./src/core/component/MeshRenderer.ts"),m=r("./src/core/component/SkinnedMeshRenderer.ts"),g=r("./src/core/component/Transform.ts"),p=r("./src/core/manager/SceneManager.ts"),f=r("./src/core/manager/ShaderManager.ts"),T=r("./src/core/math/Matrix3.ts"),v=r("./src/core/math/Matrix4.ts"),M=r("./src/core/math/Vector3.ts"),E=r("./src/core/renderer/webgl/GLRenderer.ts"),R=r("./src/core/system/renderer/RenderInfo.ts"),C=r("./src/core/system/renderer/RenderQueue.ts"),A=r("./src/core/system/System.ts");class x extends A.System{constructor(){super(...arguments),this._lightCounts=new M.Vector3}get canvas(){return this._renderer.canvas}start(){this._initProperty(),this._initShader(),p.SceneManager.ins().registerHandleQueue(u.Camera.FLAG),p.SceneManager.ins().registerHandleQueue(_.CubeCamera.FLAG),p.SceneManager.ins().registerHandleQueue(h.Light.FLAG),p.SceneManager.ins().registerHandleQueue(g.Transform.FLAG|c.MeshFilter.FLAG|d.MeshRenderer.FLAG),p.SceneManager.ins().registerHandleQueue(g.Transform.FLAG|c.MeshFilter.FLAG|m.SkinnedMeshRenderer.FLAG)}_initProperty(){this._renderer=new E.GLRenderer(a.default.width,a.default.height),this._renderQueue=new C.RenderQueue,this._cameraList=new Array,this._lightList=new Array,this._renderInfo=new R.RenderInfo,this._hdrRT=new o.RenderTarget({width:a.default.width,height:a.default.height,colorFormat:l.Const.TEX_INTERNAL_FORMAT.RGBA32F,autoUpdate:!0}),this._renderInfo.init(this._renderer.gl)}_initShader(){f.ShaderManager.ins().initUniformBlock(this._renderer.gl),f.ShaderManager.ins().initShader()}renderUpdate(e){this._renderInfo.scene=p.SceneManager.ins().worldRoot,this._renderInfo.renderFrame++,this._updateRenderQueue(),this._updateCameraList(),this._updateLightList(),this._globalIllumination(),this._rendering()}_globalIllumination(){if(!this._renderInfo.scene)return;let e=this._renderInfo.scene.env.needUpdateeGI();if(0===e)return;let t=this._renderer.gl,r=this._renderInfo.scene.env.gi;if(r.envCaptureCamera.renderTarget.useMipmap)for(let e=0,s=5;e<s;e++)r.envCaptureCamera.renderTarget.needUpdate=!0,this._renderCubeRT(t,r.envCaptureCamera,e);else this._renderCubeRT(t,r.envCaptureCamera);let s=this._renderQueue.getItem();if(0!=(1&e)&&(r.getEnvLightRenderable(s),this._renderCustomCubeRT(t,r.envLightCamera,[s])),0!=(2&e)){r.getEnvRefRenderable(s);for(let e=0,a=5;e<a;e++)r.envRefCamera.renderTarget.needUpdate=!0,s.material.roughness=e/(a-1),this._renderCustomCubeRT(t,r.envRefCamera,[s],e);r.getLUTRenderable(s),this._renderCustomRT(t,r.brdfLUTCamera,[s])}this._renderQueue.putItem(s),this._fallbackDefaultFBO(t)}_rendering(){let e,t=this._renderer.gl;for(let r=0,s=this._cameraList.length;r<s;r++)e=this._cameraList[r],e.isCubeCamera?this._renderCubeRT(t,e):(this._renderInfo.camera=e,e.renderTarget?this._renderRT(t,e):(e.enabledHDR&&this._hdrRT.setUpRT(t),this._renderCamera(t,e))),this._fallbackDefaultFBO(t)}_renderCubeRT(e,t,r=0){if(t.renderTarget.needUpdate){let s=t.subCameras;for(let a=0,n=s.length;a<n;a++)this._renderInfo.camera=s[a],t.renderTarget.setUpRT(e,a,r),this._renderer.clear(s[a].background),this._renderCamera(e,s[a]);t.renderTarget.needUpdate=!1}}_renderCustomCubeRT(e,t,r,s=0){if(t.renderTarget.needUpdate){let a=t.subCameras;for(let n=0,i=a.length;n<i;n++)this._renderInfo.camera=a[n],t.renderTarget.setUpRT(e,n,s),this._renderer.clear(a[n].background),this._renderOpaque(e,a[n],r);t.renderTarget.needUpdate=!1}}_renderRT(e,t){t.renderTarget.needUpdate&&(t.renderTarget.setUpRT(e),this._renderCamera(e,t),t.renderTarget.needUpdate=!1)}_renderCustomRT(e,t,r){t.renderTarget.needUpdate&&(this._renderInfo.camera=t,t.renderTarget.setUpRT(e),this._renderer.clear(t.background),this._renderOpaque(e,t,r),t.renderTarget.needUpdate=!1)}_fallbackDefaultFBO(e){e.viewport(0,0,a.default.width,a.default.height),e.bindFramebuffer(e.FRAMEBUFFER,null)}_renderCamera(e,t){this._renderer.clear(t.background),this._renderOpaque(e,t,this._renderQueue.opaques),this._renderTransparent(e,t,this._renderQueue.transparents),this._renderSkyBox(e,t,this._renderInfo.scene),this._postprocessing(e,t)}_updateRenderQueue(){if(!p.SceneManager.ins().hasNeedUpdate(g.Transform.FLAG|c.MeshFilter.FLAG|d.MeshRenderer.FLAG))return;let e=g.Transform.FLAG|c.MeshFilter.FLAG|d.MeshRenderer.FLAG,t=this._renderQueue;t.clear();let r,s,a,n,i,o=p.SceneManager.ins().getHandleQueue(e);for(let e=0,l=o.length;e<l;e++){r=o[e],s=r.getComponent(g.Transform),a=r.getComponent(c.MeshFilter),n=r.getComponent(d.MeshRenderer);for(let e=0,o=a.mesh.subMeshs.length;e<o;e++)i=t.getItem(),i.set(r.layer,a.mesh,a.mesh.subMeshs[e].indexInMesh,n.materials[e],s,0,0,0),t.addItemToOpaque(i)}}_updateCameraList(){if(!p.SceneManager.ins().hasNeedUpdate(u.Camera.FLAG)&&!p.SceneManager.ins().hasNeedUpdate(_.CubeCamera.FLAG))return;this._cameraList.length=0;let e=p.SceneManager.ins().getHandleQueue(u.Camera.FLAG);for(let t=0,r=e.length;t<r;t++)this._cameraList.push(e[t].getComponent(u.Camera));e=p.SceneManager.ins().getHandleQueue(_.CubeCamera.FLAG);for(let t=0,r=e.length;t<r;t++)this._cameraList.push(e[t].getComponent(_.CubeCamera));this._cameraList.sort(((e,t)=>e.depth-t.depth))}_updateLightList(){if(!p.SceneManager.ins().hasNeedUpdate(h.Light.FLAG))return;this._lightList.length=0;let e=p.SceneManager.ins().getHandleQueue(h.Light.FLAG);for(let t=0,r=e.length;t<r;t++)this._lightList.push(e[t].getComponent(h.Light));this._lightList.sort(((e,t)=>e.type-t.type))}_updateUniformBlock(e){let t,r;for(let s=0,a=e.length;s<a;s++)t=f.ShaderManager.ins().findUniformBlock(e[s]),t&&t.frame!==this._renderInfo.renderFrame&&(t.name===l.Const.UBO_MAP.SceneBlock?r=this._renderInfo.scene.getSceneUBOData():t.name===l.Const.UBO_MAP.CameraBlock?r=this._renderInfo.camera.getCameraUBOData():t.name===l.Const.UBO_MAP.LightBlock&&(r=this._getLightUBOData()),t.updateData(this._renderer.gl,r),t.frame=this._renderInfo.renderFrame)}_getLightUBOData(){let e=0,t=0,r=0,s=new Map;for(let a=0,n=this._lightList.length;a<n;a++)switch(this._lightList[a].type){case l.Const.LIGHT_TYPE.Parallel:if(e>=2)continue;let n=s.get(l.Const.UBO_ITEM_MAP.u_ParallelLights);n||(n=[],s.set(l.Const.UBO_ITEM_MAP.u_ParallelLights,n)),n[e++]=this._lightList[a].getLightUBOData();break;case l.Const.LIGHT_TYPE.Point:if(t>=4)continue;let i=s.get(l.Const.UBO_ITEM_MAP.u_PointLights);i||(i=[],s.set(l.Const.UBO_ITEM_MAP.u_PointLights,i)),i[t++]=this._lightList[a].getLightUBOData();break;case l.Const.LIGHT_TYPE.Spot:if(r>=4)continue;let o=s.get(l.Const.UBO_ITEM_MAP.u_SpotLights);o||(o=[],s.set(l.Const.UBO_ITEM_MAP.u_SpotLights,o)),o[r++]=this._lightList[a].getLightUBOData()}return this._lightCounts.set(e,t,r),s.set(l.Const.UBO_ITEM_MAP.u_LightCounts,this._lightCounts),s}_renderOpaque(e,t,r){this._renderItems(e,t,r)}_renderTransparent(e,t,r){}_renderSkyBox(e,t,r){if(!r.env.skybox.enabled||0!=(t.cullingLayers&r.env.skybox.layer))return;let s=this._renderQueue.getItem(),a=v.Matrix4.get(),n=t.gameobject.transform.worldMatrix;a.value[12]=n.value[12],a.value[13]=n.value[13],a.value[14]=n.value[14],s.layer=r.env.skybox.layer,s.mesh=r.env.skybox.mesh,s.subMeshIndex=0,s.material=r.env.skybox.material,s.worldMatrix=a,this._renderItems(e,t,[s]),this._renderQueue.putItem(s),v.Matrix4.put(a)}_postprocessing(e,t){t.postprocessor?(t.postprocessor.render(e),t.renderTarget?n.Postprocessor.blitToScreenQuad(e,t.postprocessor.dest,t.renderTarget):t.enabledHDR?n.Postprocessor.toneMapping(e,this._hdrRT,null,t.toneMapping,t.gamma):n.Postprocessor.blitToScreenQuad(e,t.postprocessor.dest,null)):t.enabledHDR&&!t.renderTarget&&n.Postprocessor.toneMapping(e,this._hdrRT,null,t.toneMapping,t.gamma)}_renderItems(e,t,r){var s;let a,n,i,o,u,_,h,c=f.ShaderManager.ins(),d=this._renderInfo.renderState,m=this._renderInfo.textureState,g=v.Matrix4.get(),p=T.Matrix3.get();for(let f=0,T=r.length;f<T;f++)a=r[f],0==(a.layer&t.cullingLayers)&&(h=(null===(s=a.transform)||void 0===s?void 0:s.worldMatrix)||a.worldMatrix,n=a.material.shaderData,this._shaderImport(a.material),i=a.material.shader.pass[0].compile(e,n.defineGroup),o=i.uniformMap,u=n.uniformGroup.uniformMap,i.use(),this._updateUniformBlock(i.uniformBlockIDs),m.releaseAllUnits(e),o.forEach(((r,s)=>{if(_=u.get(c.findUniform(s)),_)_.type===l.Const.GL_TYPE.TEXTURE||_.type===l.Const.GL_TYPE.CUBE_TEXTURE?m.uploadTexture(e,_,r):_.upload(e,r);else switch(s){case l.Const.UNIFORM_MAP.u_MvpMatrix:v.Matrix4.multiply(t.viewProjectMatrix,h,g),e.uniformMatrix4fv(r,!1,g.value);break;case l.Const.UNIFORM_MAP.u_ModelMatrix:e.uniformMatrix4fv(r,!1,h.value);break;case l.Const.UNIFORM_MAP.u_NormalMatrix:a.transform.getWorldMatrixInv(g),p.setByMatrix4(g),p.transpose(),e.uniformMatrix3fv(r,!1,p.value)}})),d.setRenderState(e,a.material),a.mesh.setup(e),a.mesh.subMeshs[a.subMeshIndex].draw(e,e.TRIANGLES));v.Matrix4.put(g),T.Matrix3.put(p)}_shaderImport(e){let t=this._renderInfo.scene,r=t.env.envLight.envLightMap,s=t.env.envReflection.envRefMap,a=t.env.envReflection.brdfLUTMap,n=e.shader,o=e.shaderData;if(n.uniforms.has(l.Const.UNIFORM_MAP.u_EnvLightMap)){let e=f.ShaderManager.ins().registerDefine(l.Const.EnvLightMapDefineName),t=f.ShaderManager.ins().registerUniform(l.Const.UNIFORM_MAP.u_EnvLightMap);if(r){if(!o.hasDefine(e.id)){let s=o.getCubeTexture(t);s?s.data=r:o.addUniform(new i.Uniform(l.Const.GL_TYPE.CUBE_TEXTURE,t,r)),o.addDefine(e)}}else if(o.hasDefine(e.id)){o.getCubeTexture(t).data=null,o.removeDefine(e.id)}}if(n.uniforms.has(l.Const.UNIFORM_MAP.u_EnvRefMap)){let e=f.ShaderManager.ins().registerDefine(l.Const.EnvRefMapDefineName),t=f.ShaderManager.ins().registerUniform(l.Const.UNIFORM_MAP.u_EnvRefMap);if(s){if(!o.hasDefine(e.id)){let r=o.getCubeTexture(t);r?r.data=s:o.addUniform(new i.Uniform(l.Const.GL_TYPE.CUBE_TEXTURE,t,s)),o.addDefine(e)}}else if(o.hasDefine(e.id)){o.getCubeTexture(t).data=null,o.removeDefine(e.id)}}if(n.uniforms.has(l.Const.UNIFORM_MAP.u_EnvBRDFLUTMap)){let e=f.ShaderManager.ins().registerDefine(l.Const.EnvBRDFLUTDefineName),t=f.ShaderManager.ins().registerUniform(l.Const.UNIFORM_MAP.u_EnvBRDFLUTMap);if(a){if(!o.hasDefine(e.id)){let r=o.getTexture(t);r?r.data=a:o.addUniform(new i.Uniform(l.Const.GL_TYPE.TEXTURE,t,a)),o.addDefine(e)}}else if(o.hasDefine(e.id)){o.getTexture(t).data=null,o.removeDefine(e.id)}}}}t.RendererSystem=x},"./src/core/system/ScriptSystem.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScriptSystem=void 0;const s=r("./src/core/manager/ComponentManager.ts"),a=r("./src/core/system/System.ts");class n extends a.System{scriptEnable(){s.ComponentManager.ins().behaviourMap.forEach((e=>{for(let t=0,r=e.length;t<r;t++)e[t]._callEnable||(e[t].gameobject.activeInHierarchy&&e[t].onEnable(),e[t]._callEnable=!0)}))}scriptStart(){s.ComponentManager.ins().behaviourMap.forEach((e=>{for(let t=0,r=e.length;t<r;t++)e[t]._callStart||(e[t].gameobject.activeInHierarchy&&e[t].onStart(),e[t]._callStart=!0)}))}fixedUpdate(e){s.ComponentManager.ins().behaviourMap.forEach((t=>{var r,s;for(let a=0,n=t.length;a<n;a++)t[a].activeInHierarchy&&(null===(s=(r=t[a]).onFixedUpdate)||void 0===s||s.call(r,e))}))}update(e){s.ComponentManager.ins().behaviourMap.forEach((t=>{var r,s;for(let a=0,n=t.length;a<n;a++)t[a].activeInHierarchy&&(null===(s=(r=t[a]).onUpdate)||void 0===s||s.call(r,e))}))}lateUpdate(e){s.ComponentManager.ins().behaviourMap.forEach((t=>{var r,s;for(let a=0,n=t.length;a<n;a++)t[a].activeInHierarchy&&(null===(s=(r=t[a]).onLateUpdate)||void 0===s||s.call(r,e))}))}renderBefore(e){s.ComponentManager.ins().behaviourMap.forEach((t=>{var r,s;for(let a=0,n=t.length;a<n;a++)t[a].activeInHierarchy&&(null===(s=(r=t[a]).onRenderBefore)||void 0===s||s.call(r,e))}))}renderAfter(e){s.ComponentManager.ins().behaviourMap.forEach((t=>{var r,s;for(let a=0,n=t.length;a<n;a++)t[a].activeInHierarchy&&(null===(s=(r=t[a]).onRenderAfter)||void 0===s||s.call(r,e))}))}}t.ScriptSystem=n},"./src/core/system/System.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.System=void 0;t.System=class{get enabled(){return this._enabled}set enabled(e){this._enabled=e}start(){}stop(){}continue(){}destroy(){}fixedUpdate(e){}update(e){}lateUpdate(e){}renderBefore(e){}renderUpdate(e){}renderAfter(e){}}},"./src/core/system/renderer/RenderInfo.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderInfo=void 0;const s=r("./src/core/system/renderer/state/RenderState.ts"),a=r("./src/core/system/renderer/state/TextureState.ts");t.RenderInfo=class{constructor(){this.renderFrame=0,this._renderState=new s.RenderState,this._textureState=new a.TextureState}get renderState(){return this._renderState}get textureState(){return this._textureState}init(e){this._renderState.init(e),this._textureState.init(e)}}},"./src/core/system/renderer/RenderItem.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderItem=void 0;t.RenderItem=class{set(e,t,r,s,a,n,i,o){this.layer=e,this.mesh=t,this.subMeshIndex=r,this.material=s,this.transform=a,this.depth=n,this.renderBatch=i,this.renderQueue=o}destroy(){this.layer=null,this.mesh=null,this.subMeshIndex=null,this.material=null,this.transform=null,this.worldMatrix=null,this.depth=null,this.renderBatch=null,this.renderQueue=null}}},"./src/core/system/renderer/RenderQueue.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderQueue=void 0;const s=r("./src/core/manager/pool/Pool.ts"),a=r("./src/core/system/renderer/RenderItem.ts");t.RenderQueue=class{constructor(){this.opaques=new Array,this.transparents=new Array,this._riPool=new s.Pool("RenderItem",(()=>new a.RenderItem),{reset:e=>{e.destroy()}})}getItem(){return this._riPool.get()}putItem(e){this._riPool.put(e)}addItemToOpaque(e){this.opaques.push(e)}addItemToTransparent(e){this.transparents.push(e)}sort(){this.opaques.sort(this._opaqueCompareFn),this.transparents.sort(this._transparentCompareFn)}_opaqueCompareFn(e,t){return e.renderQueue-t.renderQueue||e.material.shader.id-t.material.shader.id}_transparentCompareFn(e,t){return e.renderQueue-t.renderQueue||t.depth-e.depth||e.material.shader.id-t.material.shader.id}clear(){this._riPool.put(this.opaques),this._riPool.put(this.transparents)}}},"./src/core/system/renderer/state/RenderState.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderState=void 0;const s=r("./src/core/common/Const.ts");t.RenderState=class{init(e){}setRenderState(e,t){t.cullFace===s.Const.GL_CULL_FACE.BACK?(e.enable(e.CULL_FACE),e.frontFace(e.CCW)):t.cullFace===s.Const.GL_CULL_FACE.FRONT?(e.enable(e.CULL_FACE),e.frontFace(e.CW)):e.disable(e.CULL_FACE),t.depthTest===s.Const.GL_DEPTH.TEST_LESS?(e.enable(e.DEPTH_TEST),e.depthFunc(e.LESS)):t.depthTest===s.Const.GL_DEPTH.TEST_LEQUAL&&(e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL))}}},"./src/core/system/renderer/state/TextureState.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureState=void 0;t.TextureState=class{constructor(){this._maxSamples=WebGL2RenderingContext.MAX_SAMPLES,this._texture0=WebGL2RenderingContext.TEXTURE0,this._curUseUnit=this._texture0}init(e){}releaseAllUnits(e){for(let t=this._curUseUnit;t>=this._texture0;t--)e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null);this._curUseUnit=this._texture0}allocateUnit(){return this._curUseUnit>=this._maxSamples&&console.warn("allocate unit failed!"),this._curUseUnit++}uploadTexture(e,t,r){let s=this.allocateUnit();e.activeTexture(s),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.data.flipY),t.upload(e,r,s-this._texture0)}}},"./src/core/util/ArrayUtil.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArrayUtil=void 0;t.ArrayUtil=class{sum(e,t=0,r=-1){let s=0;const a=e.length;if(!(t>=0&&t<=a-1))return s;-1==r&&(r=Number.POSITIVE_INFINITY);for(let n=0,i=t;n<r&&i<a;n++,i++)s+=e[i];return s}max(e){let t=Number.NEGATIVE_INFINITY;for(let r=0,s=e.length;r<s;r++)e[r]>t&&(t=e[r]);return t}copy(e,t,r,s,a){for(let n=0;n<a;n++)t[s+n]=e[r+n]}}},"./src/core/util/DataUtil.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataUtil=void 0;const s=r("./src/core/util/Utils.ts");t.DataUtil=class{constructor(){this._init()}_init(){let e=new ArrayBuffer(4),t=(this._floatView=new Float32Array(e),this._uInt32View=new Uint32Array(e),this._baseTable=new Uint32Array(512)),r=this._shiftTable=new Uint32Array(512);for(let e=0;e<256;++e){let s=e-127;s<-27?(t[e]=0,t[256|e]=32768,r[e]=24,r[256|e]=24):s<-14?(t[e]=1024>>-s-14,t[256|e]=1024>>-s-14|32768,r[e]=-s-1,r[256|e]=-s-1):s<=15?(t[e]=s+15<<10,t[256|e]=s+15<<10|32768,r[e]=13,r[256|e]=13):s<128?(t[e]=31744,t[256|e]=64512,r[e]=24,r[256|e]=24):(t[e]=31744,t[256|e]=64512,r[e]=13,r[256|e]=13)}let s=this._mantissaTable=new Uint32Array(2048),a=this._exponentTable=new Uint32Array(64),n=this._offsetTable=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;0==(8388608&t);)t<<=1,r-=8388608;t&=-8388609,r+=947912704,s[e]=t|r}for(let e=1024;e<2048;++e)s[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)a[e]=e<<23;a[31]=1199570944,a[32]=2147483648;for(let e=33;e<63;++e)a[e]=2147483648+(e-32<<23);a[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(n[e]=1024)}toHalfFloat(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=s.Utils.Math.clamp(e,-65504,65504),this._floatView[0]=e;let t=this._uInt32View[0],r=t>>23&511;return this._baseTable[r]+((8388607&t)>>this._shiftTable[r])}fromHalfFloat(e){let t=e>>10;return this._uInt32View[0]=this._mantissaTable[this._offsetTable[t]+(1023&e)]+this._exponentTable[t],this._floatView[0]}}},"./src/core/util/DocumentUtil.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentUtil=void 0;t.DocumentUtil=class{createElementNS(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}}},"./src/core/util/MathUtil.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MathUtil=void 0;const s=r("./src/core/common/Const.ts");t.MathUtil=class{constructor(){this.DEG2RAD=Math.PI/180,this.RAD2DEG=180/Math.PI}clamp(e,t,r){return Math.max(t,Math.min(r,e))}isEqual(e,t,r=s.Const.PRECISION.LV2){return this.isSection(e-t,-r,r)}isSection(e,t,r){return e>=t&&e<=r}isPowerOfTwo(e){return 0!==e&&0==(e&e-1)}}},"./src/core/util/MeshUtil.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MeshUtil=void 0;const s=r("./src/core/common/Const.ts"),a=r("./src/core/common/container/VertexBuffer.ts"),n=r("./src/core/common/container/TBuffer.ts"),i=r("./src/core/asset/primitive/Mesh.ts"),o=r("./src/core/math/Vector3.ts"),l=r("./src/core/util/Utils.ts");t.MeshUtil=class{createCube(e=1,t=1,r=1,s=1,a=1,n=1){let i=.5*e,o=.5*t,l=.5*r,u=this._createQuad("X",1,i,t,r,a,n),_=this._createQuad("X",-1,-i,t,r,a,n),h=this._createQuad("Y",1,l,e,t,s,a),c=this._createQuad("Y",-1,-l,e,t,s,a),d=this._createQuad("Z",1,o,e,r,s,n),m=this._createQuad("Z",-1,-o,e,r,s,n),g=this._merge([u,_,h,c,d,m]),p=this._createMesh(g);return u.destroy(),_.destroy(),d.destroy(),m.destroy(),h.destroy(),c.destroy(),g.destroy(),p}createUVSphere(e=.5,t=32,r=32){let s=this._createUVSphere(e,t,r),a=this._createMesh(s);return s.destroy(),a}createPlane(e=10,t=10,r=1,s=1){let a=this._createQuad("Y",1,0,e,t,r,s),n=this._createMesh(a);return a.destroy(),n}createCone(e=.5,t=1,r=32,s=1){let a=this._createCylinder(0,e,t,r,s),n=this._createMesh(a);return a.destroy(),n}createCylinder(e=.5,t=2,r=32,s=1){let a=this._createCylinder(e,e,t,r,s),n=this._createMesh(a);return a.destroy(),n}createCapsule(e=.5,t=1,r=32,s=8){let a=this._createCapsule(e,t,r,s),n=this._createMesh(a);return a.destroy(),n}createTorus(e=.5,t=.2,r=32,s=16){let a=this._createTorus(e,t,r,s),n=this._createMesh(a);return a.destroy(),n}createTorusKnot(e=.5,t=.2,r=100,s=16,a=2,n=3){let i=this._createTorusKnot(e,t,r,s,a,n),o=this._createMesh(i);return i.destroy(),o}createQuad(e,t=1,r=0,s=1,a=1,n=1,i=1){let o=this._createQuad(e,t,r,s,a,n,i),l=this._createMesh(o);return o.destroy(),l}_createMesh(e){let t,r=new a.VertexBuffer([s.Const.ATTRIBUTE_MAP.a_Position,s.Const.ATTRIBUTE_MAP.a_Normal,s.Const.ATTRIBUTE_MAP.a_Uv],[3,3,2],e.vertexCount);r.setAttribute(s.Const.ATTRIBUTE_MAP.a_Position,e.positions),r.setAttribute(s.Const.ATTRIBUTE_MAP.a_Normal,e.normals),r.setAttribute(s.Const.ATTRIBUTE_MAP.a_Uv,e.uvs),t=l.Utils.Array.max(e.indexes)>255?new n.TBuffer(new Uint16Array(e.indexes),e.indexes.length,!1):new n.TBuffer(new Uint8Array(e.indexes),e.indexes.length,!1);let o=new i.Mesh(r,t);return o.split(),o}_createQuad(e,t,r=.5,s=1,a=1,n=1,i=1){let o=.5*s,l=-o,_=-(.5*a),h=0,c=0,d=s/n,m=a/i,g=1/n,p=1/i,f=(n+1)*(i+1),T=new Array,v=new Array;for(let e=0;e<=i;e++){l=-o,h=0;for(let e=0;e<=n;e++)T.push(l,_),v.push(h,c),l+=d,h+=g;_+=m,c+=p}let M=new Array,E=new Array;if("X"===e){let e=-t;for(let s=0,a=T.length;s<a;s+=2)M.push(r,T[s+1],T[s]*e),E.push(t,0,0)}else if("Y"===e){let e=-t;for(let s=0,a=T.length;s<a;s+=2)M.push(T[s],r,T[s+1]*e),E.push(0,t,0)}else if("Z"===e)for(let e=0,s=T.length;e<s;e+=2)M.push(T[e]*t,T[e+1],r),E.push(0,0,t);let R,C,A,x,S,y,P=new Array,L=n+1;for(let e=0;e<i;e++)for(let t=0;t<n;t++)S=e+1,y=t+1,R=e*L+t,C=e*L+y,A=S*L+t,x=S*L+y,P.push(R,C,x,R,x,A);T.length=0;let b=new u;return b.vertexCount=f,b.positions=M,b.normals=E,b.uvs=v,b.indexes=P,b}_createUVSphere(e,t,r){t=Math.max(3,t),r=Math.max(2,r);let s,a,n,i,o,l=new Array,_=new Array,h=new Array,c=new Array,d=0,m=0,g=.5*-Math.PI,p=0,f=.5*-Math.PI,T=0,v=0,M=1/t,E=0,R=0,C=0;T=.5*M;for(let r=0;r<t;r++)l.push(0,-e,0),_.push(0,-1,0),h.push(T,0),c.push(r,r+t+1,r+t),T+=M;d=t;for(let u=0,M=r-2;u<=M;u++){v=(u+1)/r,m=v*Math.PI+g;for(let r=0;r<=t;r++)T=r/t,p=-T*Math.PI*2+f,n=Math.sin(p),a=Math.cos(p),o=Math.sin(m),i=Math.cos(m),s=i*e,E=a*s,R=o*e,C=n*s,l.push(E,R,C),_.push(i*a,o,i*n),h.push(T,v),r!==t&&u!==M&&(c.push(d,d+1+t+1,d+t+1),c.push(d,d+1,d+1+t+1)),d++}T=.5*M;for(let r=0;r<t;r++)l.push(0,e,0),_.push(0,1,0),h.push(T,1),c.push(d,d-t-1,d-t),T+=M,d++;let A=new u;return A.vertexCount=.5*h.length,A.positions=l,A.normals=_,A.uvs=h,A.indexes=c,A}_createLcoSphere(){}_createQuadSphere(){}_createGoldbergPolyhedra(){}_createCylinder(e,t,r,s,a){let n,i,l,_,h,c=new Array,d=new Array,m=new Array,g=new Array,p=0,f=.5*r,T=(t-e)/r,v=0,M=0,E=0,R=0,C=.5*-Math.PI,A=o.Vector3.get();for(let o=0;o<=a;o++){E=o/a,v=t+(e-t)*E;for(let e=0;e<=s;e++)M=e/s,R=2*-M*Math.PI+C,i=Math.sin(R),n=Math.cos(R),l=v*n,_=E*r-f,h=v*i,c.push(l,_,h),A.set(n,T,i).normalize(),d.push(A.x,A.y,A.z),m.push(M,E),o!==a&&e!==s&&(g.push(p,p+1+s+1,p+s+1),g.push(p,p+1,p+1+s+1)),p++}if(o.Vector3.put(A),0!==e){c.push(0,f,0),d.push(0,1,0),m.push(.5,.5),p++;for(let t=0;t<s;t++)R=t/s*2*Math.PI,i=Math.sin(R),n=Math.cos(R),l=e*n,_=f,h=e*i,c.push(l,_,h),d.push(0,1,0),m.push(.5*(n+1),.5*(i+1)),t===s-1?g.push(p,p-t-1,p-t):g.push(p,p-t-1,p+1),p++}if(0!==t){c.push(0,-f,0),d.push(0,-1,0),m.push(.5,.5),p++;for(let e=0;e<s;e++)R=e/s*2*Math.PI,i=Math.sin(R),n=Math.cos(R),l=t*n,_=-f,h=t*i,c.push(l,_,h),d.push(0,-1,0),m.push(.5*(n+1),.5*(i+1)),e===s-1?g.push(p,p-e,p-e-1):g.push(p,p+1,p-e-1),p++}let x=new u;return x.vertexCount=.5*m.length,x.positions=c,x.normals=d,x.uvs=m,x.indexes=g,x}_createCapsule(e,t,r,s){r=Math.max(3,r),s=Math.max(1,s);let a,n,i,o,l,_,h=new Array,c=new Array,d=new Array,m=new Array,g=0,p=t+2*e,f=.5*p,T=0,v=e/p,M=0,E=.5*-Math.PI;for(let s=0;s<2;s++){v+=s*(t/p);for(let u=0;u<=r;u++)T=u/r,M=2*-T*Math.PI+E,n=Math.sin(M),a=Math.cos(M),i=e*a,o=-f+e+s*t,l=e*n,h.push(i,o,l),c.push(i,0,l),d.push(T,v),1!==s&&u!==r&&(m.push(g,g+1+r+1,g+r+1),m.push(g,g+1,g+1+r+1)),g++}let R,C,A=0;for(let u=0;u<s;u++){v=(t+e)/p+u*e/(s*p),A=u/s*Math.PI*.5;for(let p=0;p<=r;p++)T=p/r,M=2*-T*Math.PI+E,n=Math.sin(M),a=Math.cos(M),R=Math.sin(A),C=Math.cos(A),_=e*C,i=_*a,o=e*R+.5*t,l=_*n,h.push(i,o,l),c.push(C*a,R,C*n),d.push(T,v),u!==s-1&&p!==r&&(m.push(g,g+1+r+1,g+r+1),m.push(g,g+1,g+1+r+1)),g++}let x=1/r;T=.5*x;for(let e=0;e<r;e++)h.push(0,f,0),c.push(0,1,0),d.push(T,1),m.push(g,g-r-1,g-r),T+=x,g++;v=e/p;for(let u=0;u<s;u++){v=e/p-u*e/(s*p),A=-u/s*Math.PI*.5;for(let p=0;p<=r;p++)T=p/r,M=2*-T*Math.PI+E,n=Math.sin(M),a=Math.cos(M),R=Math.sin(A),C=Math.cos(A),_=e*C,i=_*a,o=e*R-.5*t,l=_*n,h.push(i,o,l),c.push(C*a,R,C*n),d.push(T,v),u!==s-1&&p!==r&&(m.push(g,g+r+1,g+1+r+1),m.push(g,g+1+r+1,g+1)),g++}T=.5*x;for(let e=0;e<r;e++)h.push(0,-f,0),c.push(0,-1,0),d.push(T,0),m.push(g,g-r,g-r-1),T+=x,g++;let S=new u;return S.vertexCount=.5*d.length,S.positions=h,S.normals=c,S.uvs=d,S.indexes=m,S}_createTorus(e,t,r,s){t=Math.min(t,e),r=Math.max(3,r),s=Math.max(3,s);let a,n,i,o,l,_,h,c=new Array,d=new Array,m=new Array,g=new Array,p=0,f=0,T=1,v=0,M=0,E=.5*-Math.PI,R=-Math.PI;for(let u=0;u<=r;u++){f=u/r,v=2*-f*Math.PI+E,n=Math.sin(v),a=Math.cos(v);for(let v=0;v<=s;v++)T=v/s,M=v/s*Math.PI*2+R,o=Math.sin(M),i=Math.cos(M),l=(e+t*i)*a,_=t*o,h=(e+t*i)*n,c.push(l,_,h),d.push(i*a,o,i*n),m.push(f,T),u!==r&&v!==s&&(g.push(p,p+1+s+1,p+1),g.push(p,p+s+1,p+1+s+1)),p++}let C=new u;return C.vertexCount=.5*m.length,C.positions=c,C.normals=d,C.uvs=m,C.indexes=g,C}_createTorusKnot(e,t,r,s,a,n){r=Math.max(3,r),s=Math.max(3,s),a=Math.max(1,a),n=Math.max(1,n);let i,l,_,h,c=new Array,d=new Array,m=new Array,g=new Array,p=0,f=o.Vector3.get(),T=o.Vector3.get(),v=o.Vector3.get(),M=o.Vector3.get(),E=o.Vector3.get(),R=o.Vector3.get(),C=o.Vector3.get();for(let u=0;u<=r;u++){i=u/r*a*Math.PI*2,A(i,a,n,e,f),A(i+.01,a,n,e,T),o.Vector3.sub(T,f,R),o.Vector3.add(T,f,C),o.Vector3.cross(R,C,E),o.Vector3.cross(E,R,C),E.normalize(),C.normalize();for(let e=0;e<=s;e++)l=e/s*Math.PI*2,_=-t*Math.cos(l),h=t*Math.sin(l),v.set(f.x+(_*C.x+h*E.x),f.y+(_*C.y+h*E.y),f.z+(_*C.z+h*E.z)),c.push(v.x,v.y,v.z),o.Vector3.sub(v,f,M).normalize(),d.push(M.x,M.y,M.z),m.push(u/r,e/s),u!==r&&e!==s&&(g.push(p,p+s+1,p+1+s+1),g.push(p,p+1+s+1,p+1)),p++}function A(e,t,r,s,a){let n=Math.cos(e),i=Math.sin(e),o=r/t*e,l=Math.cos(o);a.x=s*(2+l)*.5*n,a.y=s*(2+l)*i*.5,a.z=s*Math.sin(o)*.5}o.Vector3.put([f,T,v,M,E,R,C]);let x=new u;return x.vertexCount=.5*m.length,x.positions=c,x.normals=d,x.uvs=m,x.indexes=g,x}_merge(e){let t=new u,r=e[0].vertexCount,s=e[0].positions,a=e[0].normals,n=e[0].uvs;for(let t=1;t<e.length;t++)r+=e[t].vertexCount,s=s.concat(e[t].positions),a=a.concat(e[t].normals),n=n.concat(e[t].uvs);let i=e[0].indexes.concat(),o=e[0].vertexCount;for(let t=1,r=e.length;t<r;t++){for(let r=0,s=e[t].indexes.length;r<s;r++)i.push(o+e[t].indexes[r]);o+=e[t].vertexCount}return t.vertexCount=r,t.positions=s,t.normals=a,t.uvs=n,t.indexes=i,t}};class u{destroy(){this.positions&&(this.positions.length=0,this.positions=null),this.normals&&(this.normals.length=0,this.normals=null),this.uvs&&(this.uvs.length=0,this.uvs=null),this.indexes&&(this.indexes.length=0,this.indexes=null)}}},"./src/core/util/ShaderUtil.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderUtil=void 0;const s=r("./src/core/common/Const.ts");t.ShaderUtil=class{buildDefineGroupCode(e,t){let r=new Array,s=0,a=0,n=32*e.flags.length,i=0,o=0;for(let l=0;l<n;l++)e.flags.getBitByIndexPos(i,o)&&r.push(t.get(s).name),s++,a++,o=s%32,32===a&&(a=0,i++);let l="";for(let e=0,t=r.length;e<t;e++)l+=`#define ${r[e]}\n`;return l}buildUniformBlockGroupCode(e){let t="",r=e.uniformBlocks;for(let e=0,s=r.length;e<s;e++)t+=this.encodeUniformBlock(r[e]);return t}encodeUniformBlock(e){let t,r,a="",n=new Set,i=`uniform ${e.name} {\n`,o=e.uniforms;for(let e=0,l=o.length;e<l;e++)if(t=o[e],t.type===s.Const.GL_TYPE.STRUCT)t.data.isArray?(r=t.data.data[0],i+=`${r.name} ${t.name}[${t.data.data.length}];\n`):(r=t.data.data,i+=`${r.name} ${t.name};\n`),n.has(r.name)||(a+=this.encodeStruct(r));else i+=this._encodeBlockItem(t.data,t.name);return i+="};\n",a+i}encodeStruct(e){let t=`struct ${e.name} {\n`,r=e.items;for(let e=0,s=r.length;e<s;e++)t+=this._encodeBlockItem(r[e]);return t+="};\n",t}_encodeBlockItem(e,t){t=t||e.name;let r="";switch(e.type){case s.Const.GL_TYPE.BOOL:r=`bool ${t}`;break;case s.Const.GL_TYPE.INT:r=`int ${t}`;break;case s.Const.GL_TYPE.INT2:r=`ivec2 ${t}`;break;case s.Const.GL_TYPE.INT3:r=`ivec3 ${t}`;break;case s.Const.GL_TYPE.INT4:r=`ivec4 ${t}`;break;case s.Const.GL_TYPE.FLOAT:r=`float ${t}`;break;case s.Const.GL_TYPE.FLOAT2:r=`vec2 ${t}`;break;case s.Const.GL_TYPE.FLOAT3:r=`vec3 ${t}`;break;case s.Const.GL_TYPE.FLOAT4:r=`vec4 ${t}`;break;case s.Const.GL_TYPE.MATRIX3:r=`mat3 ${t}`;break;case s.Const.GL_TYPE.MATRIX4:r=`mat4 ${t}`}return e.isArray?r+=`[${e.length}];\n`:r+=";\n",r}}},"./src/core/util/StringUtil.ts":(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StringUtil=void 0;t.StringUtil=class{constructor(){this._init()}_init(){this._lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]}generateUUID(){let e=this._lut;const t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,s=4294967295*Math.random()|0,a=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&r]+e[r>>8&255]+"-"+e[r>>16&15|64]+e[r>>24&255]+"-"+e[63&s|128]+e[s>>8&255]+"-"+e[s>>16&255]+e[s>>24&255]+e[255&a]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255]).toLowerCase()}}},"./src/core/util/Utils.ts":(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;const s=r("./src/core/util/ArrayUtil.ts"),a=r("./src/core/util/DataUtil.ts"),n=r("./src/core/util/DocumentUtil.ts"),i=r("./src/core/util/MathUtil.ts"),o=r("./src/core/util/MeshUtil.ts"),l=r("./src/core/util/ShaderUtil.ts"),u=r("./src/core/util/StringUtil.ts");!function(e){e.Math=new i.MathUtil,e.Array=new s.ArrayUtil,e.String=new u.StringUtil,e.Document=new n.DocumentUtil,e.Shader=new l.ShaderUtil,e.Mesh=new o.MeshUtil,e.Data=new a.DataUtil}(t.Utils||(t.Utils={}))},"./src/core/asset/shader/source/BRDFLUT.fs":e=>{e.exports="in vec2 v_Uv;\r\n\r\nout vec2 fragColor;\r\n\r\n#define PI 3.14159265359\r\n\r\nfloat radicalInverseVDC(uint bits) {\r\n\r\n    bits = (bits << 16u) | (bits >> 16u);\r\n    bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\r\n    bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\r\n    bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\r\n    bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\r\n\r\n    return float(bits) * 2.3283064365386963e-10; // / 0x100000000\r\n\r\n}\r\n\r\nvec2 hammersley(uint i, uint N) {\r\n\r\n    return vec2(float(i) / float(N), radicalInverseVDC(i));\r\n\r\n}\r\n\r\nvec3 importanceSampleGGX(vec2 Xi, vec3 N, float roughness) {\r\n\r\n    float a = roughness * roughness;\r\n    float a2 = a * a;\r\n\r\n    float phi = 2.0 * PI * Xi.x;\r\n    float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a2 - 1.0) * Xi.y));\r\n    float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\r\n\r\n    // from spherical coordinates to cartesian coordinates - halfway vector\r\n    vec3 H;\r\n    H.x = cos(phi) * sinTheta;\r\n    H.y = sin(phi) * sinTheta;\r\n    H.z = cosTheta;\r\n\r\n    // from tangent-space H vector to world-space sample vector\r\n    vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\r\n    vec3 tangent = normalize(cross(up, N));\r\n    vec3 bitangent = cross(N, tangent);\r\n\r\n    vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\r\n\r\n    return normalize(sampleVec);\r\n\r\n}\r\n\r\nfloat geometrySchlickGGX(float NdotV, float roughness) {\r\n\r\n    // note that we use a different k for IBL\r\n    float a = roughness;\r\n    float k = (a * a) / 2.0;\r\n\r\n    float denom = NdotV * (1.0 - k) + k;\r\n\r\n    return NdotV / denom;\r\n\r\n}\r\n\r\nfloat geometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\r\n\r\n    float NdotV = max(dot(N, V), 0.0);\r\n    float NdotL = max(dot(N, L), 0.0);\r\n    float ggx2 = geometrySchlickGGX(NdotV, roughness);\r\n    float ggx1 = geometrySchlickGGX(NdotL, roughness);\r\n\r\n    return ggx1 * ggx2;\r\n\r\n}\r\n\r\nvec2 integrateBRDF(float NdotV, float roughness) {\r\n\r\n    vec3 V;\r\n    V.x = sqrt(1.0 - NdotV * NdotV);\r\n    V.y = 0.0;\r\n    V.z = NdotV;\r\n\r\n    float A = 0.0;\r\n    float B = 0.0;\r\n\r\n    vec3 N = vec3(0.0, 0.0, 1.0);\r\n\r\n    const uint SAMPLE_COUNT = 1024u;\r\n    for(uint i = 0u; i < SAMPLE_COUNT; i++) {\r\n\r\n        // generates a sample vector that's biased toward the preferred alignment direction (importance sampling).\r\n        vec2 Xi = hammersley(i, SAMPLE_COUNT);\r\n        vec3 H = importanceSampleGGX(Xi, N, roughness);\r\n        vec3 L = normalize(2.0 * dot(V, H) * H - V);\r\n\r\n        float NdotL = max(L.z, 0.0);\r\n        float NdotH = max(H.z, 0.0);\r\n        float VdotH = max(dot(V, H), 0.0);\r\n\r\n        if(NdotL > 0.0) {\r\n\r\n            float G = geometrySmith(N, V, L, roughness);\r\n            float G_Vis = (G * VdotH) / (NdotH * NdotV);\r\n            float Fc = pow(1.0 - VdotH, 5.0);\r\n\r\n            A += (1.0 - Fc) * G_Vis;\r\n            B += Fc * G_Vis;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    A /= float(SAMPLE_COUNT);\r\n    B /= float(SAMPLE_COUNT);\r\n\r\n    return vec2(A, B);\r\n\r\n}\r\n\r\nvoid main(){\r\n    \r\n    fragColor = integrateBRDF(v_Uv.x, v_Uv.y);\r\n\r\n}"},"./src/core/asset/shader/source/BRDFLUT.vs":e=>{e.exports="in vec4 a_Position;\r\nin vec2 a_Uv;\r\n\r\nout vec2 v_Uv;\r\n\r\nvoid main(){\r\n    \r\n    gl_Position = vec4(a_Position.xyz, 1.0);\r\n\r\n    v_Uv = a_Uv;\r\n\r\n}"},"./src/core/asset/shader/source/BlinnPhong.fs":e=>{e.exports="in vec4 v_FragPos;\r\nin vec3 v_Normal;\r\nin vec2 v_Uv;\r\n\r\nuniform vec4 u_MainColor;\r\nuniform float u_Shininess;\r\n#ifdef USE_DIFFUSE_TEXTURE\r\nuniform sampler2D u_DiffuseTexture;\r\n#endif\r\n#ifdef USE_SPECULAR_TEXTURE\r\nuniform sampler2D u_SpecularTexture;\r\n#endif\r\n\r\nout vec4 fragColor;\r\n\r\n//计算漫环境光\r\nvec3 calAmbient();\r\n//计算平行光\r\nvec3 calParallelLight(in vec3 normal, in vec3 viewDir, in vec3 mtlDiffuse, in vec3 mtlSpecular);\r\n// //计算点光源\r\nvec3 calPointLight(in vec3 normal, in vec3 viewDir, in vec3 mtlDiffuse, in vec3 mtlSpecular);\r\n// //计算聚光灯\r\nvec3 calSpotLight(in vec3 normal, in vec3 viewDir, in vec3 mtlDiffuse, in vec3 mtlSpecular);\r\n\r\nvoid main(){\r\n    \r\n    vec3 normal = normalize(v_Normal);\r\n    vec3 viewDir = normalize(u_CameraPosition.xyz - v_FragPos.xyz);\r\n\r\n    vec3 mtlDiffuse = u_MainColor.rbg;\r\n    vec3 mtlSpecular = u_MainColor.rgb;\r\n    #ifdef USE_DIFFUSE_TEXTURE\r\n        mtlDiffuse = texture(u_DiffuseTexture, v_Uv).rgb;\r\n    #endif\r\n\r\n    #ifdef USE_SPECULAR_TEXTURE\r\n        mtlSpecular = texture(u_SpecularTexture, v_Uv).rgb;\r\n    #endif\r\n\r\n    vec3 finalColor = \r\n        calAmbient() * mtlDiffuse + \r\n        calParallelLight(normal, viewDir, mtlDiffuse, mtlSpecular) + \r\n        calPointLight(normal, viewDir, mtlDiffuse, mtlSpecular) + \r\n        calSpotLight(normal, viewDir, mtlDiffuse, mtlSpecular);\r\n\r\n    fragColor = vec4(finalColor, 1.0);\r\n\r\n}\r\n\r\nvec3 calAmbient() {\r\n\r\n    return u_EnvColorAndIntensity.rgb * u_EnvColorAndIntensity.w;\r\n\r\n}\r\n\r\nvec3 calParallelLight(in vec3 normal, in vec3 viewDir, in vec3 mtlDiffuse, in vec3 mtlSpecular) {\r\n\r\n    vec3 result = vec3(0.0);\r\n\r\n    int parallelLightCount = int(u_LightCounts.x);\r\n    for(int i = 0; i < parallelLightCount; i++) {\r\n\r\n        ParallelLight parallelLight = u_ParallelLights[i];\r\n        vec3 lightDir = parallelLight.direction.xyz;\r\n        vec3 reflectDir = reflect(lightDir, normal);\r\n        //diffuse\r\n        float diffuseFactor = max(dot(normal, -lightDir), 0.0);\r\n        //specular\r\n        float specularFactor = pow(max(dot(viewDir, reflectDir), 0.0), u_Shininess);\r\n\r\n        result += \r\n            parallelLight.colorAndIntensity.rgb * diffuseFactor * mtlDiffuse * parallelLight.colorAndIntensity.w + \r\n            parallelLight.colorAndIntensity.rgb * specularFactor * mtlSpecular * parallelLight.colorAndIntensity.w;\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n}\r\n\r\nvec3 calPointLight(in vec3 normal, in vec3 viewDir, in vec3 mtlDiffuse, in vec3 mtlSpecular) {\r\n\r\n    vec3 result = vec3(0.0);\r\n\r\n    int pointLightCount = int(u_LightCounts.y);\r\n    for(int i = 0; i < pointLightCount; i++) {\r\n\r\n        PointLight pointLight = u_PointLights[i];\r\n        vec3 lightDir = normalize(v_FragPos.xyz - pointLight.position.xyz);\r\n        vec3 reflectDir = reflect(lightDir, normal);\r\n        //diffuse\r\n        float diffuseFactor = max(dot(normal, -lightDir), 0.0);\r\n        //specular\r\n        float specularFactor = pow(max(dot(viewDir, reflectDir), 0.0), u_Shininess);\r\n        //attenuation\r\n        float distance = length(pointLight.position.xyz - v_FragPos.xyz);\r\n        float attenuation = 1.0 / (pointLight.constLinearQuad.x + pointLight.constLinearQuad.y * distance + pointLight.constLinearQuad.z * (distance * distance));\r\n\r\n        result += \r\n            pointLight.colorAndIntensity.rgb * diffuseFactor * mtlDiffuse * pointLight.colorAndIntensity.w * attenuation + \r\n            pointLight.colorAndIntensity.rgb * specularFactor * mtlSpecular * pointLight.colorAndIntensity.w * attenuation;\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n}\r\n\r\nvec3 calSpotLight(in vec3 normal, in vec3 viewDir, in vec3 mtlDiffuse, in vec3 mtlSpecular) {\r\n\r\n    vec3 result = vec3(0.0);\r\n\r\n    int spotLightCount = int(u_LightCounts.z);\r\n    for(int i = 0; i < spotLightCount; i++) {\r\n\r\n        SpotLight spotLight = u_SpotLights[i];\r\n        vec3 lightDir = normalize(v_FragPos.xyz - spotLight.positionAndCutOff.xyz);\r\n        vec3 reflectDir = reflect(lightDir, normal);\r\n        //diffuse\r\n        float diffuseFactor = max(dot(normal, -lightDir), 0.0);\r\n        //specular\r\n        float specularFactor = pow(max(dot(viewDir, reflectDir), 0.0), u_Shininess);\r\n        //attenuation\r\n        float distance = length(spotLight.positionAndCutOff.xyz - v_FragPos.xyz);\r\n        float attenuation = 1.0 / (spotLight.constLinearQuad.x + spotLight.constLinearQuad.y * distance + spotLight.constLinearQuad.z * (distance * distance));\r\n        //spotlight intensity\r\n        float theta = dot(lightDir, spotLight.directionAndOuterCutOff.xyz);\r\n        float epsilon = spotLight.positionAndCutOff.w - spotLight.directionAndOuterCutOff.w;\r\n        float intensity = clamp((theta - spotLight.directionAndOuterCutOff.w) / epsilon, 0.0, 1.0);\r\n\r\n        result +=\r\n            spotLight.colorAndIntensity.rgb * diffuseFactor * mtlDiffuse * spotLight.colorAndIntensity.w * attenuation * intensity + \r\n            spotLight.colorAndIntensity.rgb * specularFactor * mtlSpecular * spotLight.colorAndIntensity.w * attenuation * intensity;\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n}"},"./src/core/asset/shader/source/BlinnPhong.vs":e=>{e.exports="in vec4 a_Position;\r\nin vec4 a_Normal;\r\nin vec2 a_Uv;\r\n\r\nuniform mat4 u_MvpMatrix;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat3 u_NormalMatrix;\r\nuniform vec4 u_TilingOffset;\r\n\r\nout vec4 v_FragPos;\r\nout vec3 v_Normal;\r\nout vec2 v_Uv;\r\n\r\nvec2 transformUV(in vec2 uv, in vec4 tilingOffset);\r\n\r\nvoid main(){\r\n\r\n    gl_Position = u_MvpMatrix * a_Position;\r\n\r\n    v_FragPos = u_ModelMatrix * a_Position;\r\n    v_Normal = u_NormalMatrix * a_Normal.xyz;\r\n    v_Uv = transformUV(a_Uv, u_TilingOffset);\r\n\r\n}\r\n\r\nvec2 transformUV(in vec2 uv, in vec4 tilingOffset) {\r\n\r\n    return uv * tilingOffset.xy + tilingOffset.zw;\r\n\r\n}"},"./src/core/asset/shader/source/FSHead.glsl":e=>{e.exports="#version 300 es\r\n#if defined(GL_FRAGMENT_PRECISION_HIGH)\r\nprecision highp float;\r\nprecision highp int;\r\n#else\r\nprecision mediump float;\r\nprecision mediump int;\r\n#endif\r\nlayout(std140, column_major) uniform;"},"./src/core/asset/shader/source/Irradiance.fs":e=>{e.exports="in vec3 v_TexCoord;\r\n\r\n#ifdef ENV_TEXTURE\r\nuniform samplerCube u_EnvTexture;\r\n#endif\r\n\r\nout vec4 fragColor;\r\n\r\n#define PI 3.14159265359\r\n\r\nvoid main(){\r\n\r\n    #ifdef ENV_TEXTURE\r\n    vec3 normal = normalize(v_TexCoord);\r\n    vec3 irradiance = vec3(0.0);\r\n\r\n    //计算半球积分（卷积）\r\n    vec3 py = vec3(0.0, 1.0, 0.0);\r\n    vec3 px = normalize(cross(py, normal));\r\n    py = cross(normal, px);\r\n\r\n    float sampleDelta = 0.005;\r\n    float nrSamples = 0.0;\r\n    for(float phi = 0.0; phi < 2.0 * PI; phi += sampleDelta) {\r\n\r\n        for(float theta = 0.0; theta < 0.5 * PI; theta += sampleDelta) {\r\n\r\n            //spherical to cartesian (in tangent space)\r\n            vec3 tangentSample = vec3(sin(theta) * cos(phi), sin(theta) * sin(phi), cos(theta));\r\n            //tangent space to world\r\n            vec3 sampleVec = tangentSample.x * px + tangentSample.y * py + tangentSample.z * normal;\r\n\r\n            irradiance += textureLod(u_EnvTexture, sampleVec, 0.0).rgb * cos(theta) * sin(theta);\r\n            nrSamples++;\r\n\r\n        }\r\n\r\n    }\r\n    \r\n    irradiance = PI * irradiance * (1.0 / nrSamples);\r\n    fragColor = vec4(irradiance, 1.0);\r\n    #else\r\n    fragColor = vec4(1.0);\r\n    #endif\r\n\r\n}"},"./src/core/asset/shader/source/Irradiance.vs":e=>{e.exports="in vec4 a_Position;\r\nuniform mat4 u_MvpMatrix;\r\n\r\nout vec3 v_TexCoord;\r\n\r\nvoid main() {\r\n\r\n    gl_Position = u_MvpMatrix * a_Position;\r\n\r\n    v_TexCoord = a_Position.xyz;\r\n\r\n}"},"./src/core/asset/shader/source/MapToCube.fs":e=>{e.exports="in vec3 v_TexCoord;\r\n\r\n#ifdef USE_EQ_RECT_MAP\r\nuniform sampler2D u_EquirectangularMap;\r\n#define InvAtan vec2(0.1591, 0.3183)\r\nvec2 sampleSphericalMap(vec3 v) {\r\n\r\n    vec2 uv = vec2(atan(v.z, v.x), asin(v.y));\r\n    uv *= InvAtan;\r\n    uv += 0.5;\r\n\r\n    return uv;\r\n\r\n}\r\n#endif\r\n#ifdef USE_CUBE_MAP\r\nuniform samplerCube u_CubeMap;\r\n#endif\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main(){\r\n\r\n    vec3 color = vec3(1.0);\r\n    #ifdef USE_EQ_RECT_MAP\r\n    vec2 uv = sampleSphericalMap(normalize(v_TexCoord));\r\n    color = texture(u_EquirectangularMap, uv).rgb;\r\n    #endif\r\n    #ifdef USE_CUBE_MAP\r\n    color = texture(u_CubeMap, v_TexCoord).rgb;\r\n    #endif\r\n\r\n    fragColor = vec4(color, 1.);\r\n\r\n}"},"./src/core/asset/shader/source/MapToCube.vs":e=>{e.exports="in vec4 a_Position;\r\nuniform mat4 u_MvpMatrix;\r\n\r\nout vec3 v_TexCoord;\r\n\r\nvoid main() {\r\n\r\n    gl_Position = u_MvpMatrix * a_Position;\r\n\r\n    v_TexCoord = a_Position.xyz;\r\n\r\n}"},"./src/core/asset/shader/source/PBR.fs":e=>{e.exports="in vec4 v_FragPos;\r\nin vec3 v_Normal;\r\nin vec2 v_Uv;\r\n\r\n#ifdef ALBEDO_TEXTURE\r\nuniform sampler2D u_AlbedoTexture;\r\n#endif\r\n\r\n#ifdef NORMAL_TEXTURE\r\nuniform sampler2D u_NormalTexture;\r\n#endif\r\n\r\n#ifdef METALLIC_TEXTURE\r\nuniform sampler2D u_MetallicTexture;\r\n#else\r\nuniform float u_Metallic;\r\n#endif\r\n\r\n#ifdef ROUGHNESS_TEXTURE\r\nuniform sampler2D u_RoughnessTexture;\r\n#else\r\nuniform float u_Roughness;\r\n#endif\r\n\r\n#ifdef AO_TEXTURE\r\nuniform sampler2D u_AoTexture;\r\n#else\r\nuniform float u_Ao;\r\n#endif\r\n\r\n#ifdef EMISSIVE_TEXTURE\r\nuniform sampler2D u_EmissiveTexture;\r\n#else\r\nuniform vec4 u_Emissive;\r\n#endif\r\nuniform float u_EmissiveIntensity;\r\n\r\n#ifdef ENV_LIGHT_MAP\r\n//使用环境关照IBL\r\nuniform samplerCube u_EnvLightMap;\r\n#endif\r\n\r\n#ifdef ENV_REF_MAP\r\n//使用环境反射纹理\r\nuniform samplerCube u_EnvRefMap;\r\n#endif\r\n\r\n#ifdef ENV_BRDF_LUT_MAP\r\nuniform sampler2D u_EnvBRDFLUTMap;\r\n#endif\r\n\r\nuniform vec4  u_Albedo;\r\n\r\nout vec4 fragColor;\r\n\r\n#define PI 3.14159265359\r\n\r\nvec3 getAlbedo();\r\nvec3 getNormal();\r\nfloat getMetallic();\r\nfloat getRoughness();\r\nfloat getAo();\r\nvec3 getEmissive();\r\n\r\n//菲涅尔反射方程\r\nvec3 fresnelSchlick(float cosTheta, vec3 F0);\r\nvec3 fresnelSchlickRoughness(float cosTheta, vec3 F0, float roughness);\r\n//法线分布函数\r\nfloat distributionGGX(vec3 N, vec3 H, float roughness);\r\n//几何函数\r\nfloat geometrySchlickGGX(float NdotV, float roughness);\r\n//史密斯法（结合观察方向Geometry Obstruction和光线方向Geometry Shadowing）\r\nfloat geometrySmith(vec3 N, vec3 V, vec3 L, float roughness);\r\n\r\nvoid main() {\r\n    \r\n    vec3 albedo = getAlbedo();\r\n    float metallic = getMetallic();\r\n    float roughness = getRoughness();\r\n    float ao = getAo();\r\n    vec3 emissive = getEmissive();\r\n\r\n    vec3 N = getNormal();\r\n    vec3 V = normalize(u_CameraPosition.xyz - v_FragPos.xyz);\r\n    vec3 R = reflect(-V, N);\r\n\r\n    vec3 F0 = vec3(0.04);\r\n    F0 = mix(F0, albedo, metallic);\r\n\r\n    vec3 Lo = vec3(0.0);\r\n\r\n    //平行光\r\n    int parallelLightCount = int(u_LightCounts.x);\r\n    for(int i = 0; i < parallelLightCount; i++) {\r\n\r\n        ParallelLight parallelLight = u_ParallelLights[i];\r\n        vec3 L = -parallelLight.direction.xyz;\r\n        vec3 H = normalize(V + L);\r\n\r\n        vec3 radiance = parallelLight.colorAndIntensity.rgb;\r\n\r\n        //Cook - Torrance BRDF\r\n        float NDF = distributionGGX(N, H, roughness);\r\n        float G = geometrySmith(N, V, L, roughness);\r\n        vec3 F = fresnelSchlick(clamp(dot(H, V), 0.0, 1.0), F0);\r\n\r\n        vec3 specular = (NDF * G * F) / ((4.0 * max(dot(N, V), 0.0) * max(dot(N, L), 0.0) + 0.0001));\r\n\r\n        vec3 ks = F;\r\n        vec3 kd = (1.0 - ks) * (1.0 - metallic);\r\n\r\n        float NdotL = max(dot(N, L), 0.0);\r\n\r\n        Lo += (kd * albedo / PI + specular) * radiance * NdotL;\r\n\r\n    }\r\n\r\n    //点光源\r\n    int pointLightCount = int(u_LightCounts.y);\r\n    for(int i = 0; i < pointLightCount; i++) {\r\n\r\n        PointLight pointLight = u_PointLights[i];\r\n        vec3 L = normalize(pointLight.position.xyz - v_FragPos.xyz);\r\n        vec3 H = normalize(V + L);\r\n\r\n        float distance = length(pointLight.position.xyz - v_FragPos.xyz);\r\n        float attenuation = 1.0 / (distance * distance);\r\n        \r\n        vec3 radiance = pointLight.colorAndIntensity.rgb * attenuation;\r\n\r\n        //Cook - Torrance BRDF\r\n        float NDF = distributionGGX(N, H, roughness);\r\n        float G = geometrySmith(N, V, L, roughness);\r\n        vec3 F = fresnelSchlick(clamp(dot(H, V), 0.0, 1.0), F0);\r\n\r\n        vec3 specular = (NDF * G * F) / ((4.0 * max(dot(N, V), 0.0) * max(dot(N, L), 0.0) + 0.0001));\r\n\r\n        vec3 ks = F;\r\n        vec3 kd = (1.0 - ks) * (1.0 - metallic);\r\n\r\n        float NdotL = max(dot(N, L), 0.0);\r\n\r\n        Lo += (kd * albedo / PI + specular) * radiance * NdotL;\r\n\r\n    }\r\n\r\n    //采用环境辐照图计算漫反射部分（间接光源的漫反射）\r\n    vec3 irradiance = vec3(0.03);\r\n    #ifdef ENV_LIGHT_MAP\r\n    irradiance = texture(u_EnvLightMap, N).rgb;\r\n    #endif\r\n    vec3 ks = fresnelSchlickRoughness(max(dot(N, V), 0.0), F0, roughness);\r\n    vec3 kd = (1.0 - ks) * (1.0 - metallic);\r\n    vec3 diffuse = irradiance * albedo;\r\n\r\n    //采样预过滤环境贴图和BRDF-LUT贴图计算镜面反射部分（间接光源的镜面反射）\r\n    vec3 specular = vec3(0.0);\r\n    #ifdef ENV_REF_MAP\r\n    #ifdef ENV_BRDF_LUT_MAP\r\n    const float MAX_REFLECTION_LOD = 4.0;\r\n    vec3 prefilteredColor = textureLod(u_EnvRefMap, R, roughness * MAX_REFLECTION_LOD).rgb;\r\n    vec2 brdf = texture(u_EnvBRDFLUTMap, vec2(max(dot(N, V), 0.0), roughness)).rg;\r\n    specular = prefilteredColor * (ks * brdf.x + brdf.y);\r\n    #endif\r\n    #endif\r\n\r\n    vec3 ambient = (kd * diffuse + specular) * ao;\r\n    vec3 color = emissive + ambient + Lo;\r\n\r\n    // 交由后期处理进行色调映射+伽马校正\r\n    // // HDR tonemapping\r\n    // color = vec3(1.0) - exp(-color * 1.2);\r\n    // // gamma correct\r\n    // color = pow(color, vec3(1.0 / 2.2));\r\n\r\n    fragColor = vec4(color, 1.0);\r\n\r\n}\r\n\r\nvec3 getAlbedo() {\r\n\r\n    //物体的贴图一般是在srgb空间，需要转换到linear（物理线性）空间下做计算（最后输出时再转换到srgb空间）\r\n    //其它specular/normal/light/hdr map都是linear空间下的\r\n    vec3 albedo = u_Albedo.rgb;\r\n    #ifdef ALBEDO_TEXTURE\r\n    albedo *= pow(texture(u_AlbedoTexture, v_Uv).rgb, vec3(2.2));\r\n    #else\r\n    albedo = u_Albedo.rgb;\r\n    #endif\r\n\r\n    return albedo;\r\n\r\n}\r\n\r\nvec3 getNormal() {\r\n\r\n    vec3 N = normalize(v_Normal);\r\n    #ifdef NORMAL_TEXTURE\r\n    vec3 tangent = texture(u_NormalTexture, v_Uv).xyz * 2.0 - 1.0;\r\n\r\n    vec3 q1 = dFdx(v_FragPos.xyz);\r\n    vec3 q2 = dFdy(v_FragPos.xyz);\r\n    vec2 st1 = dFdx(v_Uv);\r\n    vec2 st2 = dFdy(v_Uv);\r\n\r\n    vec3 T = normalize(q1 * st2.t - q2 * st1.t);\r\n    vec3 B = -normalize(cross(N, T));\r\n\r\n    mat3 TBN = mat3(T, B, N);\r\n\r\n    N = normalize(TBN * tangent);\r\n\r\n    #endif\r\n\r\n    return N;\r\n\r\n}\r\n\r\nfloat getMetallic() {\r\n\r\n    float metallic = 0.0;\r\n    #ifdef METALLIC_TEXTURE\r\n    metallic = texture(u_MetallicTexture, v_Uv).b;\r\n    #else\r\n    metallic = u_Metallic;\r\n    #endif\r\n\r\n    return metallic;\r\n\r\n}\r\n\r\nfloat getRoughness() {\r\n\r\n    float roughness = 0.0;\r\n    #ifdef ROUGHNESS_TEXTURE\r\n    roughness = texture(u_RoughnessTexture, v_Uv).g;\r\n    #else\r\n    roughness = u_Roughness;\r\n    #endif\r\n\r\n    return roughness;\r\n\r\n}\r\n\r\nfloat getAo() {\r\n\r\n    float ao = 0.0;\r\n    #ifdef AO_TEXTURE\r\n    ao = texture(u_AoTexture, v_Uv).r;\r\n    #else\r\n    ao = u_Ao;\r\n    #endif\r\n\r\n    return ao;\r\n\r\n}\r\n\r\nvec3 getEmissive() {\r\n\r\n    vec3 emissive = vec3(0.0);\r\n    #ifdef EMISSIVE_TEXTURE\r\n    emissive = texture(u_EmissiveTexture, v_Uv).rgb;\r\n    #else\r\n    emissive = u_Emissive.rgb;\r\n    #endif\r\n\r\n    emissive *= u_EmissiveIntensity;\r\n\r\n    return emissive;\r\n\r\n}\r\n\r\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\r\n\r\n    return F0 + (1.0 - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\r\n\r\n}\r\n\r\nvec3 fresnelSchlickRoughness(float cosTheta, vec3 F0, float roughness)\r\n{\r\n    return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(clamp(1.0 - cosTheta, 0.0, 1.0), 5.0);\r\n}   \r\n\r\nfloat distributionGGX(vec3 N, vec3 H, float roughness) {\r\n\r\n    float a = roughness * roughness;\r\n    float a2 = a * a;\r\n    float NdotH = max(dot(N, H), 0.0);\r\n    float NdotH2 = NdotH * NdotH;\r\n\r\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    denom = PI * denom * denom;\r\n\r\n    return a2 / denom;\r\n\r\n}\r\n\r\nfloat geometrySchlickGGX(float NdotV, float roughness) {\r\n\r\n    float r = (roughness + 1.0);\r\n    float k = (r * r) / 8.0;\r\n\r\n    float denom = NdotV * (1.0 - k) + k;\r\n\r\n    return NdotV / denom;\r\n\r\n}\r\n\r\nfloat geometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\r\n\r\n    float NdotV = max(dot(N, V), 0.0);\r\n    float NdotL = max(dot(N, L), 0.0);\r\n    float ggx2 = geometrySchlickGGX(NdotV, roughness);\r\n    float ggx1 = geometrySchlickGGX(NdotL, roughness);\r\n\r\n    return ggx1 * ggx2;\r\n\r\n}\r\n"},"./src/core/asset/shader/source/PBR.vs":e=>{e.exports="in vec4 a_Position;\r\nin vec4 a_Normal;\r\nin vec2 a_Uv;\r\n\r\nuniform mat4 u_MvpMatrix;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat3 u_NormalMatrix;\r\n\r\nout vec4 v_FragPos;\r\nout vec3 v_Normal;\r\nout vec2 v_Uv;\r\n\r\nvoid main(){\r\n\r\n    gl_Position = u_MvpMatrix * a_Position;\r\n\r\n    v_FragPos = u_ModelMatrix * a_Position;\r\n    v_Normal = u_NormalMatrix * a_Normal.xyz;\r\n    v_Uv = a_Uv;\r\n\r\n}"},"./src/core/asset/shader/source/Prefiltering.fs":e=>{e.exports="in vec3 v_TexCoord;\r\n\r\n#ifdef ENV_TEXTURE\r\nuniform samplerCube u_EnvTexture;\r\n#endif\r\nuniform float u_Roughness;\r\n\r\nout vec4 fragColor;\r\n\r\n#define PI 3.14159265359\r\n\r\nfloat radicalInverseVDC(uint bits) {\r\n\r\n    bits = (bits << 16u) | (bits >> 16u);\r\n    bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\r\n    bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\r\n    bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\r\n    bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\r\n\r\n    return float(bits) * 2.3283064365386963e-10; // / 0x100000000\r\n\r\n}\r\n\r\nvec2 hammersley(uint i, uint N) {\r\n\r\n    return vec2(float(i) / float(N), radicalInverseVDC(i));\r\n\r\n}\r\n\r\nvec3 importanceSampleGGX(vec2 Xi, vec3 N, float roughness) {\r\n\r\n    float a = roughness * roughness;\r\n    float a2 = a * a;\r\n\r\n    float phi = 2.0 * PI * Xi.x;\r\n    float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a2 - 1.0) * Xi.y));\r\n    float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\r\n\r\n    // from spherical coordinates to cartesian coordinates - halfway vector\r\n    vec3 H;\r\n    H.x = cos(phi) * sinTheta;\r\n    H.y = sin(phi) * sinTheta;\r\n    H.z = cosTheta;\r\n\r\n    // from tangent-space H vector to world-space sample vector\r\n    vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\r\n    vec3 tangent = normalize(cross(up, N));\r\n    vec3 bitangent = cross(N, tangent);\r\n\r\n    vec3 sampleVec = tangent * H.x + bitangent * H.y + N * H.z;\r\n\r\n    return normalize(sampleVec);\r\n\r\n}\r\n\r\nfloat distributionGGX(vec3 N, vec3 H, float roughness) {\r\n\r\n    float a = roughness * roughness;\r\n    float a2 = a * a;\r\n    float NdotH = max(dot(N, H), 0.0);\r\n    float NdotH2 = NdotH * NdotH;\r\n\r\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    denom = PI * denom * denom;\r\n\r\n    return a2 / denom;\r\n\r\n}\r\n\r\nvoid main(){\r\n    \r\n    vec3 N = normalize(v_TexCoord);\r\n\r\n    // make the simplifying assumption that V equals R equals the normal \r\n    vec3 R = N;\r\n    vec3 V = R;\r\n\r\n    const uint SAMPLE_COUNT = 2048u;\r\n    vec3 prefilteredColor = vec3(0.0);\r\n    float totalWeight = 0.0;\r\n\r\n    for(uint i = 0u; i < SAMPLE_COUNT; i++) {\r\n\r\n        // generates a sample vector that's biased towards the preferred alignment direction (importance sampling).\r\n        vec2 Xi = hammersley(i, SAMPLE_COUNT);\r\n        vec3 H = importanceSampleGGX(Xi, N, u_Roughness);\r\n        vec3 L = normalize(2.0 * dot(V, H) * H - V);\r\n\r\n        float NdotL = max(dot(N, L), 0.0);\r\n        if(NdotL > 0.0) {\r\n\r\n            // sample from the environment's mip level based on roughness/pdf\r\n            float D = distributionGGX(N, H, u_Roughness);\r\n            float NdotH = max(dot(N, H), 0.0);\r\n            float HdotV = max(dot(H, V), 0.0);\r\n            float pdf = D * NdotH / (4.0 * HdotV) + 0.0001;\r\n\r\n            float resolution = 512.0; // resolution of source cubemap (per face)\r\n            float saTexel = 4.0 * PI / (6.0 * resolution * resolution);\r\n            float saSample = 1.0 / (float(SAMPLE_COUNT) * pdf + 0.0001);\r\n\r\n            float mipLevel = u_Roughness == 0.0 ? 0.0 : 0.5 * log2(saSample / saTexel);\r\n\r\n            prefilteredColor += textureLod(u_EnvTexture, L, mipLevel).rgb * NdotL;\r\n            totalWeight += NdotL;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    prefilteredColor = prefilteredColor / totalWeight;\r\n\r\n    fragColor = vec4(prefilteredColor, 1.0);\r\n\r\n}\r\n"},"./src/core/asset/shader/source/Prefiltering.vs":e=>{e.exports="in vec4 a_Position;\r\nuniform mat4 u_MvpMatrix;\r\n\r\nout vec3 v_TexCoord;\r\n\r\nvoid main() {\r\n\r\n    gl_Position = u_MvpMatrix * a_Position;\r\n\r\n    v_TexCoord = a_Position.xyz;\r\n\r\n}"},"./src/core/asset/shader/source/SkyBox.fs":e=>{e.exports="in vec3 v_TexCoord;\r\n\r\n#ifdef USE_EQ_RECT_MAP\r\nuniform sampler2D u_EquirectangularMap;\r\n#endif\r\n#ifdef USE_CUBE_MAP\r\nuniform samplerCube u_CubeMap;\r\n#endif\r\n\r\nuniform float u_Exposure;\r\n\r\nout vec4 fragColor;\r\n\r\n#ifdef USE_EQ_RECT_MAP\r\nconst vec2 invAtan = vec2(0.1591, 0.3183);\r\nvec2 sampleSphericalMap(vec3 v) {\r\n    vec2 uv = vec2(atan(v.z, v.x), asin(v.y));\r\n    uv *= invAtan;\r\n    uv += 0.5;\r\n    return uv;\r\n}\r\n#endif\r\n\r\nvoid main(){\r\n\r\n    vec3 color = vec3(0.0);\r\n    vec3 texCoord = normalize(v_TexCoord);\r\n    #ifdef USE_EQ_RECT_MAP\r\n    color = texture(u_EquirectangularMap, sampleSphericalMap(texCoord)).rgb;\r\n    #endif\r\n    #ifdef USE_CUBE_MAP\r\n    color = texture(u_CubeMap, texCoord).rgb;\r\n    #endif\r\n\r\n    fragColor = vec4(color * u_Exposure, 1.0);\r\n\r\n}"},"./src/core/asset/shader/source/SkyBox.vs":e=>{e.exports="in vec4 a_Position;\r\nuniform mat4 u_MvpMatrix;\r\n\r\nout vec3 v_TexCoord;\r\n\r\nvoid main() {\r\n\r\n    gl_Position = (u_MvpMatrix * a_Position).xyww;\r\n\r\n    v_TexCoord = a_Position.xyz;\r\n\r\n}"},"./src/core/asset/shader/source/SkySphere.fs":e=>{e.exports="in vec4 v_Position;\r\n\r\nuniform vec4 u_SumYawPitchRadius;\r\nuniform vec4 u_SumColor;\r\nuniform vec4 u_SumHaloAndThickness;\r\nuniform vec4 u_SkyColor;\r\nuniform vec4 u_GroundColor;\r\nuniform vec4 u_SkylineColorAndThickness;\r\n\r\nuniform float u_Exposure;\r\n\r\nout vec4 fragColor;\r\n\r\n/* Easing Expo Out equation */\r\n/* Adapted from Robert Penner easing equations */\r\nfloat easeExpoOut(float t) {\r\n    return (t == 1.0) ? 1.0 : (-pow(2.0, -10.0 * t) + 1.0);\r\n}\r\n\r\nvoid main() {\r\n\r\n    //背景\r\n    vec4 background = step(0., v_Position.y) * u_SkyColor + step(v_Position.y, 0.) * u_GroundColor;\r\n\r\n    //太阳\r\n    float sumH = sin(u_SumYawPitchRadius.y);\r\n    float sumX = cos(u_SumYawPitchRadius.x) * cos(u_SumYawPitchRadius.y);\r\n    float sumY = sin(u_SumYawPitchRadius.x) * cos(u_SumYawPitchRadius.y);\r\n    float d = length(vec3(sumX, sumH, sumY) - v_Position.xyz);\r\n    background = step(u_SumYawPitchRadius.z, d) * background + step(d, u_SumYawPitchRadius.z) * u_SumColor;\r\n\r\n    //太阳光晕\r\n    float mixFactor = clamp(abs(d - u_SumYawPitchRadius.z) / u_SumHaloAndThickness.w, 0., 1.) ;\r\n    mixFactor = easeExpoOut(mixFactor);\r\n    background = mix(vec4(u_SumHaloAndThickness.xyz, 1.), background, mixFactor);\r\n\r\n    //地平线\r\n    float skylineThickness = step(0., v_Position.y) * u_SkylineColorAndThickness.w + step(v_Position.y, 0.) * u_SkylineColorAndThickness.w * 0.1;\r\n    mixFactor = clamp(abs(v_Position.y) / skylineThickness, 0., 1.);\r\n    mixFactor = easeExpoOut(mixFactor);\r\n    background = mix(vec4(u_SkylineColorAndThickness.xyz, 1.), background, mixFactor);\r\n\r\n    vec3 color = background.rgb * u_Exposure;\r\n\r\n    fragColor = vec4(color, 1.0);\r\n\r\n}"},"./src/core/asset/shader/source/SkySphere.vs":e=>{e.exports="in vec4 a_Position;\r\nuniform mat4 u_MvpMatrix;\r\n\r\nout vec4 v_Position;\r\n\r\nvoid main() {\r\n\r\n    gl_Position = (u_MvpMatrix * a_Position).xyww;\r\n\r\n    v_Position = a_Position;\r\n\r\n}"},"./src/core/asset/shader/source/Unlit.fs":e=>{e.exports="uniform vec4 u_MainColor;\r\n\r\n#ifdef USE_MAIN_TEXTURE\r\nuniform sampler2D u_MainTexture;\r\nin vec2 v_Uv;\r\n#endif\r\n\r\n#ifdef USE_VERTEX_COLOR\r\nin vec4 v_Color;\r\n#endif\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main() {\r\n\r\n    vec4 finalColor = u_MainColor;\r\n    #ifdef USE_VERTEX_COLOR\r\n    finalColor = v_Color;\r\n    #endif\r\n\r\n    #ifdef USE_MAIN_TEXTURE\r\n    finalColor *= texture(u_MainTexture, v_Uv);\r\n    #endif\r\n\r\n    fragColor = finalColor;\r\n\r\n}\r\n"},"./src/core/asset/shader/source/Unlit.vs":e=>{e.exports="in vec4 a_Position;\r\n#ifdef USE_MAIN_TEXTURE\r\nin vec2 a_Uv;\r\nuniform vec4 u_TilingOffset;\r\nout vec2 v_Uv;\r\n#endif\r\n\r\n#ifdef USE_VERTEX_COLOR\r\nin vec4 a_Color;\r\nout vec4 v_Color;\r\n#endif\r\n\r\nuniform mat4 u_MvpMatrix;\r\n\r\nvec2 transformUV(in vec2 uv, in vec4 tilingOffset);\r\n\r\nvoid main() {\r\n\r\n    gl_Position = u_MvpMatrix * a_Position;\r\n\r\n    #ifdef USE_MAIN_TEXTURE\r\n    v_Uv = transformUV(a_Uv, u_TilingOffset);\r\n    #endif\r\n\r\n    #ifdef USE_VERTEX_COLOR\r\n    v_Color = a_Color;\r\n    #endif\r\n\r\n}\r\n\r\nvec2 transformUV(in vec2 uv, in vec4 tilingOffset) {\r\n\r\n    return uv * tilingOffset.xy + tilingOffset.zw;\r\n\r\n}"},"./src/core/asset/shader/source/VSHead.glsl":e=>{e.exports="#version 300 es\r\n#if defined(GL_FRAGMENT_PRECISION_HIGH)\r\nprecision highp float;\r\nprecision highp int;\r\n#else\r\nprecision mediump float;\r\nprecision mediump int;\r\n#endif\r\nlayout(std140, column_major) uniform;"},"./src/core/asset/shader/source/postprocessing/BlitToQuad.fs":e=>{e.exports="in vec2 v_Uv;\r\n\r\nuniform sampler2D u_SourceMap;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main(){\r\n\r\n    fragColor = vec4(texture(u_SourceMap, v_Uv).rgb, 1.0);\r\n\r\n}"},"./src/core/asset/shader/source/postprocessing/BlitToQuad.vs":e=>{e.exports="in vec4 a_Position;\r\nin vec2 a_Uv;\r\n\r\nout vec2 v_Uv;\r\n\r\nvoid main(){\r\n    \r\n    gl_Position = vec4(a_Position.xyz, 1.0);\r\n\r\n    v_Uv = a_Uv;\r\n\r\n}"},"./src/core/asset/shader/source/postprocessing/Blur.fs":e=>{e.exports="in vec2 v_Uv;\r\n\r\nuniform sampler2D u_SourceMap;\r\nuniform vec2 u_TexelOffset;\r\n\r\nout vec4 fragColor;\r\n\r\nconst float weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\r\n\r\nvoid main(){\r\n\r\n    vec3 texel = texture(u_SourceMap, v_Uv).rgb * weight[0];\r\n    for(int i = 1; i < 5; i++) {\r\n        \r\n        texel += texture(u_SourceMap, v_Uv + u_TexelOffset.xy * float(i)).rgb * weight[i];\r\n        texel += texture(u_SourceMap, v_Uv - u_TexelOffset.xy * float(i)).rgb * weight[i];\r\n\r\n    }\r\n\r\n    fragColor = vec4(texel, 1.0);\r\n\r\n}"},"./src/core/asset/shader/source/postprocessing/Combine.fs":e=>{e.exports="in vec2 v_Uv;\r\n\r\nuniform sampler2D u_SourceMap;\r\nuniform sampler2D u_OverlayMap;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main(){\r\n\r\n    vec3 finalColor = texture(u_SourceMap, v_Uv).rgb;\r\n    finalColor += texture(u_OverlayMap, v_Uv).rgb;\r\n\r\n    fragColor = vec4(finalColor, 1.0);\r\n\r\n}"},"./src/core/asset/shader/source/postprocessing/ExtBright.fs":e=>{e.exports="in vec2 v_Uv;\r\n\r\nuniform sampler2D u_SourceMap;\r\nuniform float u_Threshold;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main(){\r\n\r\n    vec3 finalColor = texture(u_SourceMap, v_Uv).rgb;\r\n    float brightness = dot(finalColor, vec3(0.2126, 0.7152, 0.0722));\r\n    if(brightness < u_Threshold) {\r\n\r\n        finalColor = vec3(0.0);\r\n\r\n    }\r\n\r\n    fragColor = vec4(finalColor, 1.0);\r\n\r\n}"},"./src/core/asset/shader/source/postprocessing/ToneMapping.fs":e=>{e.exports="in vec2 v_Uv;\r\n\r\nuniform sampler2D u_SourceMap;\r\nuniform float u_Exposure;\r\nuniform float u_Gamma;\r\n\r\n#ifdef LINEAR_TONE_MAPPING\r\nvec3 linearToneMapping(vec3 color) {\r\n\r\n\treturn u_Exposure * color;\r\n\r\n}\r\n#endif\r\n#ifdef REINHARD_TONE_MAPPING\r\nvec3 reinhardToneMapping(vec3 color) {\r\n\r\n\tcolor *= u_Exposure;\r\n\treturn clamp(color / (vec3(1.0) + color), 0.0, 1.0);\r\n\r\n}\r\n#endif\r\n#ifdef OPTIMIZED_CINEON_TONE_MAPPING\r\nvec3 optimizedCineonToneMapping(vec3 color) {\r\n\r\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\r\n\tcolor *= u_Exposure;\r\n\tcolor = max(vec3(0.0), color - 0.004);\r\n\treturn pow((color * (6.2 * color + 0.5)) / (color * (6.2 * color + 1.7) + 0.06), vec3(2.2));\r\n\r\n}\r\n#endif\r\n#ifdef ACES_FILMIC_TONE_MAPPING\r\nvec3 rrtAndODTFit(vec3 v) {\r\n\r\n\tvec3 a = v * (v + 0.0245786) - 0.000090537;\r\n\tvec3 b = v * (0.983729 * v + 0.4329510) + 0.238081;\r\n\treturn a / b;\r\n\r\n}\r\nvec3 acesFilmicToneMapping(vec3 color) {\r\n\r\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\r\n\tconst mat3 ACESInputMat = mat3(\r\n\t\tvec3(0.59719, 0.07600, 0.02840), // transposed from source\r\n\t\tvec3(0.35458, 0.90834, 0.13383),\r\n\t\tvec3(0.04823, 0.01566, 0.83777)\r\n\t);\r\n\r\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\r\n\tconst mat3 ACESOutputMat = mat3(\r\n\t\tvec3( 1.60475, -0.10208, -0.00327), // transposed from source\r\n\t\tvec3(-0.53108,  1.10813, -0.07276),\r\n\t\tvec3(-0.07367, -0.00605,  1.07602)\r\n\t);\r\n\r\n\tcolor *= u_Exposure / 0.6;\r\n\r\n\tcolor = ACESInputMat * color;\r\n\r\n\t// Apply RRT and ODT\r\n\tcolor = rrtAndODTFit(color);\r\n\r\n\tcolor = ACESOutputMat * color;\r\n\r\n\t// Clamp to [0, 1]\r\n\treturn clamp(color, 0.0, 1.0);\r\n\r\n}\r\n#endif\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main(){\r\n\r\n    // tone-mapping\r\n    vec3 color = texture(u_SourceMap, v_Uv).rgb;\r\n    #ifdef LINEAR_TONE_MAPPING\r\n    color = linearToneMapping(color);\r\n    #endif\r\n    #ifdef REINHARD_TONE_MAPPING\r\n    color = reinhardToneMapping(color);\r\n    #endif\r\n    #ifdef OPTIMIZED_CINEON_TONE_MAPPING\r\n    color = optimizedCineonToneMapping(color);\r\n    #endif\r\n    #ifdef ACES_FILMIC_TONE_MAPPING\r\n    color = acesFilmicToneMapping(color);\r\n    #endif\r\n\r\n    // gamma-correct\r\n    color = pow(color, vec3(u_Gamma));\r\n\r\n    fragColor = vec4(color, 1.0);\r\n\r\n}"}},t={};var r=function r(s){var a=t[s];if(void 0!==a)return a.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,r),n.exports}("./src/core/Apex.ts");Apex=r})();